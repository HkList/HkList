import{d as K,a as T,s as V,i as l,o as b,e as S,g as s,k as R,p as $,q as Q,b as h,v as W,x as X,M as F,y as Y,z as ee,h as e,l as k,t as M,m as U,B as G,A as te,F as z,n as le}from"./index-oOsh6Yp-.js";import{C as B,S as N,I as se}from"./index-BhO2Ilwz.js";import{f as H,a as ne}from"./format-nPyW6ozd.js";import{A as j,u as oe,_ as ae}from"./Aria2Dialog.vue_vue_type_script_setup_true_lang-Bja4_Xr_.js";import{F as ie,a as re}from"./index-DZkpM1t2.js";import{T as J}from"./index-Cxg5a5ue.js";import{c as E,L as ue,a as ce}from"./copy-BLdbJLLO.js";import{l as I}from"./link-CEnqzPvx.js";import{L as P}from"./index-B4K4XrRJ.js";import{T as de}from"./index-CmdcfFKe.js";import"./useResizeObserver-PaY5eqjE.js";import"./index-BPJ4iUQr.js";import"./dep-1296ed3e-CVicF3e5.js";import"./fake-arrow-eSZcvc17.js";import"./index-DwsXfZcz.js";import"./index-BB1kvMsX.js";import"./add-BqxXqSof.js";import"./useVirtualScrollNew-DHNj1tvi.js";import"./helper-GPcm8NCZ.js";const me=["innerHTML"],_e=K({__name:"Announce",setup(f){const c=T(),{config:d}=V(c);return(_,n)=>{const L=B;return l(d).show_announce?(b(),S(L,{key:0,title:"公告"},{default:s(()=>[R("div",{innerHTML:l(d).announce},null,8,me)]),_:1})):$("",!0)}}}),Z=T(),q=Q("fileListStore",()=>{const f=h({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),c=h(),d=()=>{const a=f.value.dir.split("/");a.pop();const u=a.join("/");return u===""?"/":u},_=async()=>{o.value=[];const a=await W(f.value);c.value=a.data,f.value.dir!=="/"&&c.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:d(),server_filename:"返回上一层",dlink:""})},n=h({token:"guest"}),L=h({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),p=h(""),t=async()=>{var a,u;try{const r=await X(n.value);L.value=r.data,p.value=""}catch(r){const v=(u=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:u.message;v&&(p.value=v)}},o=h([]),m=h([]),A=(a,u)=>{o.value=a,m.value=u.selectedRowData},g=h(!1),i=h([]);return{GetFileListReq:f,GetFileListRes:c,getFileList:_,GetLimitReq:n,GetLimitRes:L,GetLimitError:p,getLimit:t,selectedRowKeys:o,handleSelectChange:A,getDownloadLinks:async(a,u)=>{const{config:r}=Z;a&&typeof a!="number"&&u&&(a.stopPropagation(),m.value=[u]);const v=m.value.filter(y=>y&&!y.is_dir);v.length!==m.value.length&&F.warning("文件夹不会进行解析,已忽略");const C=v.filter(y=>y.size>r.min_single_filesize);C.length!==v.length&&F.warning("文件过小不会被解析");const D=C.filter(y=>y.size<r.max_single_filesize);D.length!==C.length&&F.warning("文件过大不会被解析");const w=D;if(w.length>r.max_once){F.error(`单次最多解析${r.max_once}个文件`);return}if(w.length===0){F.error("满足要求的文件数量为0");return}try{g.value=!0;const y=await Y({randsk:c.value.randsk,uk:c.value.uk,shareid:c.value.shareid,fs_id:typeof a=="number"?[a]:w.map(O=>O.fs_id),surl:f.value.surl,dir:f.value.dir,pwd:f.value.pwd,token:n.value.token,parse_password:f.value.parse_password});if(typeof a=="number")return F.success("重新解析成功"),y.data;F.success("解析成功,下滑查看解析结果"),i.value=y.data}catch(y){console.log(y)}finally{g.value=!1,await t(),await Z.getConfig()}},GetDownLoadLinksRes:i}}),pe={key:1},fe=K({__name:"Form",setup(f){const c=T(),{config:d}=V(c),_=q(),{GetFileListReq:n,GetLimitReq:L,GetLimitRes:p,GetLimitError:t}=V(_),o=()=>{const g=n.value.url,i=g.match(/s\/([a-zA-Z0-9_-]+)/),x=g.match(/surl=([a-zA-Z0-9_-]+)/),a=g.match(/\?pwd=([a-zA-Z0-9_-]+)/),u=g.match(/&pwd=([a-zA-Z0-9_-]+)/),r=g.match(/提取码[:：]\s?([a-zA-Z0-9_-]+)/);if(i)n.value.surl=i[1];else if(x)n.value.surl=`1${x[1]}`;else return n.value.surl="",n.value.pwd="",n.value.dir="",F.error("无法识别的链接");return n.value.url=`https://pan.baidu.com/s/${n.value.surl}`,n.value.pwd=a?a[1]:u?u[1]:r?r[1]:"",F.success("链接识别成功~"),!0},m={url:[{required:!0,message:"链接不能为空"}],parse_password:[{required:!0,message:"解析密码不能为空"}]};ee(()=>{_.getLimit(),c.getConfig()});const A=async({validateResult:g})=>{g===!0&&(n.value.dir="/",await _.getFileList(),F.success("获取成功"))};return(g,i)=>{const x=j,a=N,u=se,r=ie,v=G,C=re,D=B;return b(),S(D,null,{default:s(()=>[e(a,{direction:"vertical",class:"space"},{default:s(()=>[e(x,{theme:l(d).have_account?"success":"error"},{default:s(()=>[k(M(l(d).have_account?"当前中转账号充足":"当前中转账号不足"),1)]),_:1},8,["theme"]),l(d).debug?(b(),S(x,{key:0,theme:"error"},{default:s(()=>i[4]||(i[4]=[k(" 当前网站开启了DEBUG模式,非调试请关闭!!!! ")])),_:1})):$("",!0),e(x,{theme:l(t).length===0?"success":"error"},{default:s(()=>[l(t).length===0?(b(),S(a,{key:0},{default:s(()=>[R("span",null,"剩余可解析文件数: "+M(l(p).count),1),R("span",null,"剩余可解析大小: "+M(l(H)(l(p).size)),1),R("span",null,"到期时间: "+M(l(p).expires_at),1)]),_:1})):(b(),U("span",pe,M(l(t)),1))]),_:1},8,["theme"]),e(C,{data:l(n),rules:m,onSubmit:A},{default:s(()=>[e(r,{name:"url",label:"链接"},{default:s(()=>[e(u,{modelValue:l(n).url,"onUpdate:modelValue":i[0]||(i[0]=w=>l(n).url=w),modelModifiers:{trim:!0},onBlur:o},null,8,["modelValue"])]),_:1}),e(r,{name:"surl",label:"提取到的链接"},{default:s(()=>[e(u,{value:l(n).surl,disabled:""},null,8,["value"])]),_:1}),e(r,{name:"pwd",label:"提取码"},{default:s(()=>[e(u,{modelValue:l(n).pwd,"onUpdate:modelValue":i[1]||(i[1]=w=>l(n).pwd=w),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),l(d).need_password?(b(),S(r,{key:0,name:"parse_password",label:"解析密码"},{default:s(()=>[e(u,{modelValue:l(n).parse_password,"onUpdate:modelValue":i[2]||(i[2]=w=>l(n).parse_password=w),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):$("",!0),e(r,{name:"token",label:"卡密"},{default:s(()=>[e(u,{modelValue:l(L).token,"onUpdate:modelValue":i[3]||(i[3]=w=>l(L).token=w),modelModifiers:{trim:!0},onBlur:l(_).getLimit},null,8,["modelValue","onBlur"])]),_:1}),e(r,null,{default:s(()=>[e(a,{size:"small"},{default:s(()=>[e(v,{type:"submit"},{default:s(()=>i[5]||(i[5]=[k(" 获取文件列表 ")])),_:1}),e(v,{onClick:l(_).getDownloadLinks},{default:s(()=>i[6]||(i[6]=[k(" 批量解析 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})}}}),ge=te(fe,[["__scopeId","data-v-f65f896b"]]),ve=K({__name:"FilesList",setup(f){const c=q(),{GetFileListReq:d,GetFileListRes:_,selectedRowKeys:n}=V(c),L=h([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"server_filename",title:"文件名",cell:(t,{row:o})=>e(z,null,[e("div",{class:"filename"},[e("img",{class:"ico",src:o.is_dir?"/images/folder.png":"/images/file.png"},null),e("span",null,[o.server_filename])])]),ellipsis:!0},{colKey:"server_mtime",title:"修改时间",cell:(t,{row:o})=>e(z,null,[ne(o.server_mtime)]),ellipsis:!0},{colKey:"size",title:"文件大小",cell:(t,{row:o})=>e(z,null,[H(o.size)]),ellipsis:!0},{colKey:"operation",title:"操作",cell:(t,{row:o})=>o.is_dir?e(z,null,[e(G,{theme:"primary",onClick:m=>p(m,o.path)},{default:()=>[k("打开文件夹")]})]):e(z,null,[e(G,{theme:"primary",onClick:m=>c.getDownloadLinks(m,o)},{default:()=>[k("解析")]})]),width:130,align:"center",fixed:"right"}]),p=async(t,o)=>{t.stopPropagation(),d.value.dir=o,await c.getFileList()};return(t,o)=>{const m=J,A=B;return l(_)?(b(),S(A,{key:0},{default:s(()=>[e(m,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:l(_).list,maxHeight:500,columns:L.value,"select-on-row-click":!0,selectedRowKeys:l(n),onSelectChange:l(c).handleSelectChange},null,8,["data","columns","selectedRowKeys","onSelectChange"])]),_:1})):$("",!0)}}}),we=K({__name:"LinksList",setup(f){const c=q(),{GetDownLoadLinksRes:d}=V(c),_=oe(),n=h([{colKey:"message",title:"状态"},{colKey:"filename",title:"文件名"},{colKey:"ua",title:"UA",cell:(p,{row:t})=>e(P,{onClick:()=>E(t.ua)},{default:()=>[e(I,null,null),t.ua]})},{colKey:"fs_id",title:"文件ID"},{colKey:"operation",title:"操作",cell:(p,{row:t,rowIndex:o})=>e(z,null,[e(G,{onClick:()=>L(t,o)},{default:()=>[k("重新解析")]})])}]),L=async(p,t)=>{const o=await c.getDownloadLinks(p.fs_id);o&&(d.value[t].urls=o[0].urls)};return(p,t)=>{const o=P,m=G,A=j,g=de,i=N,x=ce,a=ue,u=J,r=B;return l(d).length>0?(b(),S(r,{key:0},{default:s(()=>[e(i,{direction:"vertical"},{default:s(()=>[e(A,null,{default:s(()=>[t[2]||(t[2]=k(" 下载请推荐使用Aria2下载器,如 ")),e(o,{href:"https://motrix.app/",target:"_blank"},{"prefix-icon":s(()=>[e(l(I))]),default:s(()=>[t[0]||(t[0]=k(" Motrix "))]),_:1}),t[3]||(t[3]=R("p",null,"IDM下载需要手动指定UA,点击即可复制",-1)),t[4]||(t[4]=R("p",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可重新解析该文件",-1)),t[5]||(t[5]=R("br",null,null,-1)),e(m,{onClick:l(_).showAria2Config},{default:s(()=>t[1]||(t[1]=[k(" 修改Aria2配置 ")])),_:1},8,["onClick"])]),_:1}),e(u,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:l(d),columns:n.value},{expandedRow:s(({row:v})=>[e(a,{split:"",size:"large"},{default:s(()=>[(b(!0),U(z,null,le(v.urls,(C,D)=>(b(),S(x,{key:C},{default:s(()=>[e(i,{direction:"vertical"},{default:s(()=>[e(i,null,{default:s(()=>[e(g,{size:"large"},{default:s(()=>[k(" 第 "+M(D+1)+" 条 ",1)]),_:2},1024),e(m,{onClick:w=>l(E)(C)},{default:s(()=>t[6]||(t[6]=[k("复制")])),_:2},1032,["onClick"]),e(m,{onClick:w=>l(_).addAria2Url(C,v.filename,v.ua,16)},{default:s(()=>t[7]||(t[7]=[k("发送到Aria2下载器")])),_:2},1032,["onClick"])]),_:2},1024),R("p",null,M(C),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","columns"])]),_:1})]),_:1})):$("",!0)}}}),Te=K({__name:"index",setup(f){return(c,d)=>(b(),U(z,null,[e(_e),e(ge),e(ve),e(we),e(ae)],64))}});export{Te as default};
