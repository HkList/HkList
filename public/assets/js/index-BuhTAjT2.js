import{d as U,u as q,s as M,f as t,o as F,a as z,b as s,j as K,k as A,l as Y,r as L,m as Z,n as ee,M as x,p as te,q as le,e,g as w,t as $,h as I,F as V,w as se,i as ne}from"./index-C3wxJ-Zt.js";import{C as T,S as J,I as oe}from"./index-D6lIC7tq.js";import{f as O,a as ae}from"./format-CIBOUphW.js";import{g as ie}from"./getUrlId-C6EUnTTr.js";import{A as Q,u as re,_ as ue}from"./Aria2Dialog.vue_vue_type_script_setup_true_lang-C52yWYA9.js";import{F as de,a as ce}from"./index-D4P_06xV.js";import{B}from"./useResizeObserver-BSsH2PXN.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as W}from"./index-B2ZVhCce.js";import{c as E,L as _e,a as pe}from"./copy-CqxIsS0f.js";import{l as N}from"./link-kK0A3rqS.js";import{L as H}from"./index-DPKOFomo.js";import{T as fe}from"./index-CudzI4LV.js";import"./index-DJEb95Wr.js";import"./index-CUg2CudF.js";import"./dep-b315df3e-DTrBxfMW.js";import"./fake-arrow-WYGXrZol.js";import"./dep-0df090f8-CEZpFJqT.js";import"./index-stA1_DWP.js";import"./add-ttRL20ON.js";import"./useVirtualScrollNew-KOwHHpxq.js";import"./helper-DIJhXpUd.js";import"./index-B6dDfRtB.js";const ge=["innerHTML"],ve=U({__name:"Announce",setup(k){const r=q(),{config:m}=M(r);return(p,a)=>{const b=T;return t(m).show_announce?(F(),z(b,{key:0,title:"公告"},{default:s(()=>[K("div",{innerHTML:t(m).announce},null,8,ge)]),_:1})):A("",!0)}}}),j=q(),P=Y("fileList",()=>{const k=L({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),r=L(),m=()=>{const o=k.value.dir.split("/");o.pop();const n=o.join("/");return n===""?"/":n},p=async()=>{i.value=[];const o=await Z(k.value);r.value=o.data,k.value.dir!=="/"&&r.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:m(),server_filename:"返回上一层",dlink:""})},a=L({token:"guest"}),b=L({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),f=L(""),d=async()=>{var o,n;try{const u=await ee(a.value);b.value=u.data,f.value=""}catch(u){const v=(n=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:n.message;v&&(f.value=v)}},i=L([]),g=L([]),y=(o,n)=>{i.value=o,g.value=n.selectedRowData},l=L(!1),_=L([]);return{GetFileListReq:k,GetFileListRes:r,getFileList:p,GetLimitReq:a,GetLimitRes:b,GetLimitError:f,getLimit:d,selectedRowKeys:i,handleSelectChange:y,getDownloadLinks:async(o,n)=>{const{config:u}=j;o&&typeof o!="number"&&n&&(o.stopPropagation(),g.value=[n]);const v=g.value.filter(c=>c&&!c.is_dir);v.length!==g.value.length&&x.warning("文件夹不会进行解析,已忽略");const C=v.filter(c=>c.size>u.min_single_filesize);C.length!==v.length&&x.warning("文件过小不会被解析");const h=C.filter(c=>c.size<u.max_single_filesize);h.length!==C.length&&x.warning("文件过大不会被解析");const S=h;if(S.length>u.max_once){x.error(`单次最多解析${u.max_once}个文件`);return}if(S.length===0){x.error("满足要求的文件数量为0");return}try{l.value=!0;const c=await te({randsk:r.value.randsk,uk:r.value.uk,shareid:r.value.shareid,fs_id:typeof o=="number"?[o]:S.map(D=>D.fs_id),surl:k.value.surl,dir:k.value.dir,pwd:k.value.pwd,token:a.value.token,parse_password:k.value.parse_password});if(typeof o=="number")return x.success("重新解析成功"),c.data;x.success("解析成功,下滑查看解析结果"),_.value=c.data}catch(c){x.error("解析可能失败或超时了,请稍后前往历史记录中尝试查询"),console.log(c)}finally{l.value=!1,await d(),await j.getConfig()}},GetDownLoadLinksRes:_}}),we={key:1},ke=U({__name:"Form",setup(k){const r=q(),{config:m}=M(r),p=P(),{GetFileListReq:a,GetLimitReq:b,GetLimitRes:f,GetLimitError:d,GetFileListRes:i,GetDownLoadLinksRes:g}=M(p),y=()=>{const o=ie(a.value.url);if(!o)return;const{surl:n,pwd:u,url:v}=o;a.value.surl=n,a.value.url=v,a.value.dir="/",u&&(a.value.pwd=u,x.success("已自动填写密码~"))},l=()=>{a.value.dir="",i.value=void 0,g.value=[]},_={url:[{required:!0,message:"链接不能为空"}],parse_password:[{required:!0,message:"解析密码不能为空"}]};le(()=>{p.getLimit(),r.getConfig()});const G=async({validateResult:o})=>{o===!0&&(a.value.dir="/",await p.getFileList(),x.success("获取成功"))};return(o,n)=>{const u=Q,v=J,C=oe,h=de,S=B,c=ce,D=T;return F(),z(D,null,{default:s(()=>[e(v,{direction:"vertical",class:"space"},{default:s(()=>[e(u,{theme:t(m).have_account?"success":"error"},{default:s(()=>[w($(t(m).have_account?"当前中转账号充足":"当前中转账号不足"),1)]),_:1},8,["theme"]),t(m).debug?(F(),z(u,{key:0,theme:"error"},{default:s(()=>n[5]||(n[5]=[w(" 当前网站开启了DEBUG模式,非调试请关闭!!!! ")])),_:1})):A("",!0),e(u,{theme:t(d).length===0?"success":"error"},{default:s(()=>[t(d).length===0?(F(),z(v,{key:0},{default:s(()=>[K("span",null,"剩余可解析文件数: "+$(t(f).count),1),K("span",null,"剩余可解析大小: "+$(t(O)(t(f).size)),1),K("span",null,"到期时间: "+$(t(f).expires_at),1)]),_:1})):(F(),I("span",we,$(t(d)),1))]),_:1},8,["theme"]),e(c,{data:t(a),rules:_,onSubmit:G},{default:s(()=>[e(h,{name:"url",label:"链接"},{default:s(()=>[e(C,{modelValue:t(a).url,"onUpdate:modelValue":n[0]||(n[0]=R=>t(a).url=R),modelModifiers:{trim:!0},onBlur:y,onChange:l},null,8,["modelValue"])]),_:1}),e(h,{name:"surl",label:"提取到的链接"},{default:s(()=>[e(C,{value:t(a).surl,disabled:""},null,8,["value"])]),_:1}),e(h,{name:"pwd",label:"提取码"},{default:s(()=>[e(C,{modelValue:t(a).pwd,"onUpdate:modelValue":n[1]||(n[1]=R=>t(a).pwd=R),modelModifiers:{trim:!0},onChange:l},null,8,["modelValue"])]),_:1}),t(m).need_password?(F(),z(h,{key:0,name:"parse_password",label:"解析密码"},{default:s(()=>[e(C,{modelValue:t(a).parse_password,"onUpdate:modelValue":n[2]||(n[2]=R=>t(a).parse_password=R),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):A("",!0),e(h,{name:"token",label:"卡密"},{default:s(()=>[e(C,{modelValue:t(b).token,"onUpdate:modelValue":n[3]||(n[3]=R=>t(b).token=R),modelModifiers:{trim:!0},onBlur:t(p).getLimit},null,8,["modelValue","onBlur"])]),_:1}),e(h,{name:"dir",label:"路径"},{default:s(()=>[e(C,{modelValue:t(a).dir,"onUpdate:modelValue":n[4]||(n[4]=R=>t(a).dir=R),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),_:1}),e(h,null,{default:s(()=>[e(v,{size:"small"},{default:s(()=>[e(S,{type:"submit"},{default:s(()=>n[6]||(n[6]=[w(" 获取文件列表 ")])),_:1}),e(S,{onClick:t(p).getDownloadLinks},{default:s(()=>n[7]||(n[7]=[w(" 批量解析 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})}}}),Le=me(ke,[["__scopeId","data-v-da6052aa"]]),ye=U({__name:"FilesList",setup(k){const r=P(),{GetFileListReq:m,GetFileListRes:p,selectedRowKeys:a}=M(r),b=L([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"server_filename",title:"文件名",cell:(d,{row:i})=>e(V,null,[e("div",{class:"filename"},[e("img",{class:"ico",src:i.is_dir?"/images/folder.png":"/images/file.png"},null),e("span",null,[i.server_filename])])]),ellipsis:!0},{colKey:"server_mtime",title:"修改时间",cell:(d,{row:i})=>e(V,null,[ae(i.server_mtime)]),ellipsis:!0},{colKey:"size",title:"文件大小",cell:(d,{row:i})=>e(V,null,[O(i.size)]),ellipsis:!0},{colKey:"operation",title:"操作",cell:(d,{row:i})=>i.is_dir?e(V,null,[e(B,{theme:"primary",onClick:g=>f(g,i.path)},{default:()=>[w("打开文件夹")]})]):e(V,null,[e(B,{theme:"primary",onClick:g=>r.getDownloadLinks(g,i)},{default:()=>[w("解析")]})]),width:130,align:"center",fixed:"right"}]),f=async(d,i)=>{d.stopPropagation(),m.value.dir=i,await r.getFileList()};return(d,i)=>{const g=W,y=T;return t(p)?(F(),z(y,{key:0},{default:s(()=>[e(g,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:t(p).list,maxHeight:500,columns:b.value,"select-on-row-click":!0,selectedRowKeys:t(a),onSelectChange:t(r).handleSelectChange},null,8,["data","columns","selectedRowKeys","onSelectChange"])]),_:1})):A("",!0)}}}),Ce=U({__name:"LinksList",setup(k){const r=P(),{GetDownLoadLinksRes:m}=M(r),p=re(),a=L([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"message",title:"状态"},{colKey:"filename",title:"文件名"},{colKey:"ua",title:"UA",cell:(y,{row:l})=>e(H,{onClick:()=>E(l.ua)},{default:()=>[e(N,null,null),l.ua]})},{colKey:"fs_id",title:"文件ID"},{colKey:"operation",title:"操作",cell:(y,{row:l,rowIndex:_})=>e(V,null,[e(B,{onClick:()=>b(l,_)},{default:()=>[w("重新解析")]})])}]),b=async(y,l)=>{const _=await r.getDownloadLinks(y.fs_id);_&&(m.value[l]=_[0])},f=L([]),d=L([]),i=(y,l)=>{f.value=y,d.value=l.selectedRowData.filter(_=>_.urls).map(_=>({filename:_.filename,urls:_.urls,ua:_.ua}))};se(m,()=>{f.value=[],d.value=[]});const g=()=>{f.value=[],d.value=[]};return(y,l)=>{const _=H,G=B,o=J,n=Q,u=fe,v=pe,C=_e,h=W,S=T;return t(m).length>0?(F(),z(S,{key:0},{default:s(()=>[e(o,{direction:"vertical"},{default:s(()=>[e(n,null,{default:s(()=>[l[4]||(l[4]=w(" 下载请推荐使用Aria2下载器,如 ")),e(_,{href:"https://motrix.app/",target:"_blank"},{"prefix-icon":s(()=>[e(t(N))]),default:s(()=>[l[1]||(l[1]=w(" Motrix "))]),_:1}),l[5]||(l[5]=K("p",null,"IDM下载需要手动指定UA,点击即可复制",-1)),l[6]||(l[6]=K("p",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可重新解析该文件",-1)),l[7]||(l[7]=K("br",null,null,-1)),e(o,null,{default:s(()=>[e(G,{onClick:t(p).showAria2Config},{default:s(()=>l[2]||(l[2]=[w(" 修改Aria2配置 ")])),_:1},8,["onClick"]),e(G,{onClick:l[0]||(l[0]=c=>t(p).downloadLinks(d.value))},{default:s(()=>l[3]||(l[3]=[w("批量发送")])),_:1})]),_:1})]),_:1}),e(h,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:t(m),columns:a.value,"select-on-row-click":!0,selectedRowKeys:f.value,onSelectChange:i,onPageChange:g},{expandedRow:s(({row:c})=>[e(C,{split:"",size:"large"},{default:s(()=>[(F(!0),I(V,null,ne(c.urls,(D,R)=>(F(),z(v,{key:D},{default:s(()=>[e(o,{direction:"vertical"},{default:s(()=>[e(o,null,{default:s(()=>[e(u,{size:"large"},{default:s(()=>[w(" 第 "+$(R+1)+" 条 ",1)]),_:2},1024),e(G,{onClick:X=>t(E)(D)},{default:s(()=>l[8]||(l[8]=[w("复制")])),_:2},1032,["onClick"]),e(G,{onClick:X=>t(p).addAria2Url(D,c.filename,c.ua,16)},{default:s(()=>l[9]||(l[9]=[w("发送到Aria2下载器")])),_:2},1032,["onClick"])]),_:2},1024),K("p",null,$(D),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","columns","selectedRowKeys"])]),_:1})]),_:1})):A("",!0)}}}),je=U({__name:"index",setup(k){return(r,m)=>(F(),I(V,null,[e(ve),e(Le),e(ye),e(Ce),e(ue)],64))}});export{je as default};
