import{z as E,d as P,r as _,y as G,k as x,f as e,e as o,F as c,M as J,o as k,g as l,m as n,j as d,n as O,a as Q,t as A}from"./index-DDOnw_dn.js";import{c as w,L as W,a as X}from"./copy-CUtqzkG7.js";import{u as Y}from"./useCommonStore-B2B7cOsd.js";import{f as Z}from"./format-CtkX3nTF.js";import{u as h,_ as tt,A as et}from"./Aria2Dialog.vue_vue_type_script_setup_true_lang-B8g2NY9p.js";import{C as ot,I as lt,B as nt}from"./index-CbAgUJFV.js";import{l as R}from"./link-D9CnXwbf.js";import{L as z}from"./index-cXa1TKRz.js";import{F as at,a as st}from"./index-B_x2fmIg.js";import{S as it}from"./useResizeObserver-qPY2ykBa.js";import{T as rt}from"./index-xzt9fufW.js";import{T as ut}from"./index-Dz63onss.js";import"./dep-b315df3e-C2hVJkwZ.js";import"./useVirtualScrollNew-CeNdADLm.js";import"./index-CsnpQ6z4.js";import"./index-BUF0ViGc.js";import"./index-nUUatxqy.js";import"./fake-arrow-1KGx0yNu.js";import"./dep-0df090f8-WeFDQkDM.js";import"./index-CFwiV1Xc.js";import"./add-DsX-5seJ.js";import"./helper-BIov0_W9.js";const mt=g=>E.request("get","/user/history",{params:g}),Vt=P({__name:"index",setup(g){const f=h(),[a,K,L,B]=Y(mt),I={},F=_([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"file.filename",title:"文件名",ellipsis:!0},{colKey:"ua",title:"下载UA",cell:(s,{row:t})=>e(z,{onClick:()=>w(t.ua)},{default:()=>[e(R,null,null),t.ua]}),ellipsis:!0},{colKey:"created_at",title:"解析时间",ellipsis:!0},{colKey:"size",title:"文件大小",cell:(s,{row:t})=>e(c,null,[Z(t.file.size)]),ellipsis:!0}]),y=async({validateResult:s})=>{s===!0&&(a.value.token||(a.value.token="guest"),await B(),localStorage.setItem("token",a.value.token),J.success("查询成功"))};G(()=>{a.value.token=localStorage.getItem("token")??"guest",y({validateResult:!0})});const C=_([]),v=_([]),V=(s,t)=>{C.value=s,v.value=t.selectedRowData.map(r=>({filename:r.file.filename,urls:r.urls,ua:r.ua}))};return(s,t)=>{const r=lt,b=at,u=nt,m=it,M=st,S=ot,T=z,$=et,U=ut,D=X,N=W,q=rt;return k(),x(c,null,[e(S,null,{default:o(()=>[e(M,{data:l(a),rules:I,onSubmit:y},{default:o(()=>[e(b,{name:"token",label:"卡密"},{default:o(()=>[e(r,{modelValue:l(a).token,"onUpdate:modelValue":t[0]||(t[0]=i=>l(a).token=i)},null,8,["modelValue"])]),_:1}),e(b,null,{default:o(()=>[e(m,{size:"small"},{default:o(()=>[e(u,{type:"submit"},{default:o(()=>t[2]||(t[2]=[n(" 查询 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1}),e(S,null,{default:o(()=>[e(m,{direction:"vertical"},{default:o(()=>[e($,null,{default:o(()=>[t[6]||(t[6]=n(" 下载请推荐使用Aria2下载器,如 ")),e(T,{href:"https://motrix.app/",target:"_blank"},{"prefix-icon":o(()=>[e(l(R))]),default:o(()=>[t[3]||(t[3]=n(" Motrix "))]),_:1}),t[7]||(t[7]=d("p",null,"IDM下载需要手动指定UA,点击即可复制",-1)),t[8]||(t[8]=d("p",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可重新解析该文件",-1)),t[9]||(t[9]=d("br",null,null,-1)),e(m,null,{default:o(()=>[e(u,{onClick:l(f).showAria2Config},{default:o(()=>t[4]||(t[4]=[n(" 修改Aria2配置 ")])),_:1},8,["onClick"]),e(u,{onClick:t[1]||(t[1]=i=>l(f).downloadLinks(v.value))},{default:o(()=>t[5]||(t[5]=[n("批量发送")])),_:1})]),_:1})]),_:1}),e(q,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(L),pagination:l(K),columns:F.value,"select-on-row-click":!0,selectedRowKeys:C.value,onSelectChange:V},{expandedRow:o(({row:i})=>[e(N,{split:"",size:"large"},{default:o(()=>[(k(!0),x(c,null,O(i.urls,(p,H)=>(k(),Q(D,{key:p},{default:o(()=>[e(m,{direction:"vertical"},{default:o(()=>[e(m,null,{default:o(()=>[e(U,{size:"large"},{default:o(()=>[n(" 第 "+A(H+1)+" 条 ",1)]),_:2},1024),e(u,{onClick:j=>l(w)(p)},{default:o(()=>t[10]||(t[10]=[n("复制")])),_:2},1032,["onClick"]),e(u,{onClick:j=>l(f).addAria2Url(p,i.filename,i.ua,16)},{default:o(()=>t[11]||(t[11]=[n("发送到Aria2下载器")])),_:2},1032,["onClick"])]),_:2},1024),d("p",null,A(p),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","pagination","columns","selectedRowKeys"])]),_:1})]),_:1}),e(tt)],64)}}});export{Vt as default};
