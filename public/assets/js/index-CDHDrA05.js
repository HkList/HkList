import{p as A,q as G,b as k,M as C,d as E,s as D,a3 as L,e as R,j as t,S as N,f as l,g as e,h,k as M,F as K,i as x,o as P,l as Q,n as W,m as X}from"./index-eI8R4ss_.js";import{u as Y}from"./useCommonStore-DDqi1bm2.js";import{u as H}from"./accounts-D6L6v4wk.js";import{D as O}from"./index-BY_ui9x3.js";import{F as $,a as j}from"./index-BWGUaD4T.js";import{S as T,O as F}from"./index-iYWNECF4.js";import{I as B,S as z,C as Z}from"./index-x7N4pGD2.js";import{B as U}from"./useResizeObserver-Oiz27DSP.js";import{S as ee}from"./index-BQWKgcHh.js";import{T as te}from"./index-DcCulLGr.js";import"./format-CgiaoUj7.js";import"./fake-arrow-0E_7m6V5.js";import"./debounce-gMOTSbYJ.js";import"./omit-D2ZXgO6s.js";import"./index-BuKhiBcD.js";import"./dep-7dcc7954-CLitiiZ0.js";import"./index-Cr-OlzWr.js";import"./add-BukTeEpj.js";import"./useVirtualScrollNew-CVXKrD3n.js";const oe={http:"HTTP静态代理",api:"API动态代理",proxy:"中转代理"},le=f=>A.request("get","/admin/proxy",{params:f}),ae=f=>A.request("post","/admin/proxy",{data:f}),ne=f=>A.request("patch","/admin/proxy",{data:f}),se=f=>A.request("delete","/admin/proxy",{data:f}),I=G("proxies",()=>{const[f,s,d,a]=Y(le,()=>{c.value=[],v.value=[]},{keyword:""}),c=k([]),v=k([]),S=(w,u)=>{c.value=w,v.value=u.selectedRowData},_=k(!1),n=()=>_.value=!0,r=()=>{_.value=!1,o.value={type:"http",proxy:"",account_id:void 0}},o=k({type:"http",proxy:"",account_id:void 0}),y=async()=>{await ae(o.value),C.success("添加成功"),await a()},p=async()=>{if(c.value.length===0)return C.error("请选择代理");await se({id:c.value}),c.value=[],C.success("删除成功"),await a()},g=k(!1),m=k({id:[],enable:!0,reason:"",type:"http",proxy:""});return{proxyList:d,pagination:s,selectReq:f,getProxies:a,selectedRowKeys:c,handleSelectChange:S,isAddingProxy:_,showAddingProxyDialog:n,hideAddingProxyDialog:r,addProxyReq:o,addProxy:y,isEditDialog:g,updateReq:m,showEditDialog:(w,u)=>{if(w&&u?(w.stopPropagation(),m.value.id=[u]):m.value={id:c.value,enable:!0,reason:""},m.value.id.length===1){const i=d.value.find(J=>J.id===m.value.id[0]);i&&(m.value={id:[i.id],enable:i.enable,reason:i.reason,type:i.type,proxy:i.proxy,account_id:i.account_id})}g.value=!0},hideEditDialog:()=>g.value=!1,updateSelection:async()=>{if(m.value.id.length===0)return C.error("请选择卡密");await ne(m.value),C.success("更新成功~"),await a()},deleteSelection:p}}),ie=E({__name:"AddProxy",setup(f){const s=I(),{isAddingProxy:d,addProxyReq:a}=D(s),c=H(),{accountList:v,selectReq:S}=D(c);S.value.size=9999,c.getAccounts(),L(()=>{v.value=[]});const _={type:[{required:!0,message:"请选择代理类型"}],proxy:[{required:!0,message:"请输入代理信息"}],account_id:[{required:!0,message:"请选择账号"}]},n=async({validateResult:r})=>{r===!0&&(await s.addProxy(),s.hideAddingProxyDialog())};return(r,o)=>{const y=F,p=T,g=j,m=B,V=U,b=z,q=$,w=O;return P(),R(w,{visible:t(d),"onUpdate:visible":o[3]||(o[3]=u=>N(d)?d.value=u:null),header:"添加卡密",footer:!1},{default:l(()=>[e(q,{onSubmit:n,data:t(a),rules:_},{default:l(()=>[e(g,{name:"type",label:"代理类型"},{default:l(()=>[e(p,{modelValue:t(a).type,"onUpdate:modelValue":o[0]||(o[0]=u=>t(a).type=u)},{default:l(()=>[e(y,{label:"HTTP静态代理",value:"http"}),e(y,{label:"API动态代理",value:"api"}),e(y,{label:"中转代理(ip@password)",value:"proxy"})]),_:1},8,["modelValue"])]),_:1}),e(g,{name:"proxy",label:"代理信息"},{default:l(()=>[e(m,{modelValue:t(a).proxy,"onUpdate:modelValue":o[1]||(o[1]=u=>t(a).proxy=u)},null,8,["modelValue"])]),_:1}),e(g,{name:"account_id",label:"账号"},{default:l(()=>[e(p,{modelValue:t(a).account_id,"onUpdate:modelValue":o[2]||(o[2]=u=>t(a).account_id=u)},{default:l(()=>[(P(!0),h(K,null,M(t(v),u=>(P(),R(y,{key:u.id,label:u.baidu_name,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(g,null,{default:l(()=>[e(b,{size:"small"},{default:l(()=>[e(V,{theme:"default",onClick:t(s).hideAddingProxyDialog},{default:l(()=>o[4]||(o[4]=[x(" 取消 ")])),_:1},8,["onClick"]),e(V,{type:"submit"},{default:l(()=>o[5]||(o[5]=[x(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ue=E({__name:"UpdateProxy",setup(f){const s=I(),{isEditDialog:d,updateReq:a}=D(s),c=H(),{accountList:v,selectReq:S}=D(c);S.value.size=9999,c.getAccounts(),L(()=>{v.value=[]});const _={},n=async({validateResult:r})=>{r===!0&&(await s.updateSelection(),s.hideEditDialog())};return(r,o)=>{const y=B,p=j,g=ee,m=F,V=T,b=U,q=z,w=$,u=O;return P(),R(u,{visible:t(d),"onUpdate:visible":o[5]||(o[5]=i=>N(d)?d.value=i:null),header:"更新卡密",footer:!1},{default:l(()=>[e(w,{onSubmit:n,data:t(a),rules:_},{default:l(()=>[e(p,{label:"选中的卡密"},{default:l(()=>[e(y,{value:JSON.stringify(t(a).id),disabled:""},null,8,["value"])]),_:1}),e(p,{name:"enable",label:"启用"},{default:l(()=>[e(g,{modelValue:t(a).enable,"onUpdate:modelValue":o[0]||(o[0]=i=>t(a).enable=i)},null,8,["modelValue"])]),_:1}),e(p,{name:"reason",label:"原因"},{default:l(()=>[e(y,{modelValue:t(a).reason,"onUpdate:modelValue":o[1]||(o[1]=i=>t(a).reason=i)},null,8,["modelValue"])]),_:1}),t(a).id.length===1?(P(),h(K,{key:0},[e(p,{name:"type",label:"代理类型"},{default:l(()=>[e(V,{modelValue:t(a).type,"onUpdate:modelValue":o[2]||(o[2]=i=>t(a).type=i)},{default:l(()=>[e(m,{label:"HTTP静态代理",value:"http"}),e(m,{label:"API获取模式",value:"api"}),e(m,{label:"中转代理(ip@password)",value:"proxy"})]),_:1},8,["modelValue"])]),_:1}),e(p,{name:"proxy",label:"代理信息"},{default:l(()=>[e(y,{modelValue:t(a).proxy,"onUpdate:modelValue":o[3]||(o[3]=i=>t(a).proxy=i)},null,8,["modelValue"])]),_:1}),e(p,{name:"account_id",label:"账号"},{default:l(()=>[e(V,{modelValue:t(a).account_id,"onUpdate:modelValue":o[4]||(o[4]=i=>t(a).account_id=i)},{default:l(()=>[(P(!0),h(K,null,M(t(v),i=>(P(),R(m,{key:i.id,label:i.baidu_name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})],64)):Q("",!0),e(p,null,{default:l(()=>[e(q,{size:"small"},{default:l(()=>[e(b,{theme:"default",onClick:t(s).hideEditDialog},{default:l(()=>o[6]||(o[6]=[x(" 取消 ")])),_:1},8,["onClick"]),e(b,{type:"submit"},{default:l(()=>o[7]||(o[7]=[x(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),de={class:"buttons"},qe=E({__name:"index",setup(f){const s=I(),{selectReq:d,proxyList:a,pagination:c,selectedRowKeys:v}=D(s);W(s.getProxies);const S=k([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID"},{colKey:"type",title:"代理类型",cell:(_,{row:n})=>_("span",oe[n.type])},{colKey:"proxy",title:"代理信息"},{colKey:"status",title:"状态",cell:(_,{row:n})=>_("span",n.enable?"启用":`禁用(${n.reason})`)},{colKey:"created_at",title:"创建时间",width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(_,{row:n})=>e(U,{theme:"primary",onClick:r=>s.showEditDialog(r,n.id)},{default:()=>[x("编辑")]}),width:90,fixed:"right"}]);return(_,n)=>{const r=F,o=T,y=B,p=U,g=z,m=te,V=Z;return P(),R(V,null,{default:l(()=>[X("div",de,[e(g,{size:"small"},{default:l(()=>[e(o,{modelValue:t(d).column,"onUpdate:modelValue":n[0]||(n[0]=b=>t(d).column=b),onChange:t(s).getProxies},{default:l(()=>[e(r,{label:"按 id 排序",value:"id"}),e(r,{label:"按 token 排序",value:"token"}),e(r,{label:"按 count 排序",value:"count"}),e(r,{label:"按 created_at 排序",value:"created_at"}),e(r,{label:"按 updated_at 排序",value:"updated_at"})]),_:1},8,["modelValue","onChange"]),e(o,{modelValue:t(d).direction,"onUpdate:modelValue":n[1]||(n[1]=b=>t(d).direction=b),onChange:t(s).getProxies},{default:l(()=>[e(r,{label:"正序",value:"asc"}),e(r,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(y,{modelValue:t(d).keyword,"onUpdate:modelValue":n[2]||(n[2]=b=>t(d).keyword=b),onBlur:t(s).getProxies,placeholder:"请输入需要查询的代理"},null,8,["modelValue","onBlur"]),e(p,{onClick:t(s).getProxies},{default:l(()=>n[3]||(n[3]=[x(" 刷新列表 ")])),_:1},8,["onClick"]),e(p,{onClick:t(s).showAddingProxyDialog},{default:l(()=>n[4]||(n[4]=[x(" 添加代理 ")])),_:1},8,["onClick"]),e(p,{onClick:t(s).deleteSelection},{default:l(()=>n[5]||(n[5]=[x(" 批量删除 ")])),_:1},8,["onClick"]),e(p,{onClick:t(s).showEditDialog},{default:l(()=>n[6]||(n[6]=[x(" 批量编辑 ")])),_:1},8,["onClick"])]),_:1})]),e(ie),e(ue),e(m,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:t(a),pagination:t(c),columns:S.value,"select-on-row-click":!0,selectedRowKeys:t(v),onSelectChange:t(s).handleSelectChange},null,8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{qe as default};
