import{x as U,l as O,r as w,M as B,d as x,s as q,o as L,a as I,b as o,e as t,f as l,h as $,F as j,k as E,g as _,T as F,v as J,j as W}from"./index-BJhcKZeD.js";import{u as G}from"./useCommonStore-ClbFzjBy.js";import{D as H,V as P}from"./validates-Cd4PPHjR.js";import{O as h,S as R}from"./index-PG3XRsWF.js";import{F as N,a as z}from"./index-Jl42w06N.js";import{I as M,S as D,C as Q}from"./index-0g5QdBBD.js";import{B as S}from"./useResizeObserver-CrahsTvI.js";import{D as T}from"./index-DBytTMNS.js";import{I as X}from"./index-BPhO86LL.js";import{T as Z}from"./index-DQlRfgjG.js";import"./dep-b315df3e-w72xg2Kb.js";import"./fake-arrow-BrDZk_aI.js";import"./index-CN5NUBdd.js";import"./add-BV_6eahh.js";import"./dep-0df090f8-D8dxZAAR.js";import"./useVirtualScrollNew-9Ci0_5un.js";import"./helper-D9Yh0fxx.js";const ee=u=>U.request("get","/admin/black_list",{params:u}),te=u=>U.request("post","/admin/black_list",{data:u}),le=u=>U.request("patch","/admin/black_list",{data:u}),ae=u=>U.request("delete","/admin/black_list",{data:u}),K=O("blackList",()=>{const[u,i,m,a]=G(ee,()=>{r.value=[]}),r=w([]),y=g=>{r.value=g},V=async()=>{if(r.value.length===0)return B.error("请选择黑名单");await ae({id:r.value}),r.value=[],B.success("删除成功"),await a()},c=w(!1),e=w({id:[],type:void 0,identifier:void 0,reason:"",expires_at:""}),s=(g,n)=>{if(g&&n?(g.stopPropagation(),e.value.id=[n]):e.value={id:r.value,type:void 0,identifier:void 0,reason:"",expires_at:""},e.value.id.length===1){const A=m.value.find(Y=>Y.id===e.value.id[0]);A&&(e.value={...A,id:e.value.id})}c.value=!0},f=()=>c.value=!1,d=async()=>{if(e.value.id.length===0)return B.error("请选择黑名单");await le({...e.value,id:r.value}),B.success("更新成功"),await a()},p=w(!1),b=w({type:"fingerprint",identifier:"",reason:"",ban_days:10});return{pagination:i,selectReq:u,blackList:m,getBlackLists:a,selectedRowKeys:r,handleSelectChange:y,deleteSelection:V,isUpdate:c,updateReq:e,showUpdateDialog:s,hideUpdateDialog:f,updateSelection:d,isAddBlackList:p,addBlackListReq:b,showAddBlackList:()=>p.value=!0,hideAddBlackList:()=>p.value=!1,addBlackList:async()=>{await te(b.value),B.success("插入成功~"),await a()}}}),oe=x({__name:"UpdateBlackList",setup(u){const i=K(),{isUpdate:m,updateReq:a}=q(i),y={identifier:[{required:!0,message:"请输入识别码"},{validator:()=>a.value.type==="ip"&&a.value.identifier&&!P(a.value.identifier)?{result:!1,message:"请输入正确的IP地址",type:"error"}:!0}],reason:[{required:!0,message:"请输入原因"}],expires_at:[{required:!0,message:"请选择到期时间"}]},V=async({validateResult:c})=>{c===!0&&(await i.updateSelection(),i.hideUpdateDialog())};return(c,e)=>{const s=h,f=R,d=N,p=M,b=H,v=S,k=D,C=z,g=T;return L(),I(g,{visible:l(m),"onUpdate:visible":e[4]||(e[4]=n=>F(m)?m.value=n:null),header:"更新黑名单",footer:!1},{default:o(()=>[t(C,{onSubmit:V,data:l(a),rules:y},{default:o(()=>[l(a).id.length===1?(L(),$(j,{key:0},[t(d,{label:"类型",name:"type"},{default:o(()=>[t(f,{modelValue:l(a).type,"onUpdate:modelValue":e[0]||(e[0]=n=>l(a).type=n)},{default:o(()=>[t(s,{label:"指纹",value:"fingerprint"}),t(s,{label:"IP",value:"ip"})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"识别码",name:"identifier"},{default:o(()=>[t(p,{modelValue:l(a).identifier,"onUpdate:modelValue":e[1]||(e[1]=n=>l(a).identifier=n)},null,8,["modelValue"])]),_:1})],64)):E("",!0),t(d,{label:"原因",name:"reason"},{default:o(()=>[t(p,{modelValue:l(a).reason,"onUpdate:modelValue":e[2]||(e[2]=n=>l(a).reason=n)},null,8,["modelValue"])]),_:1}),t(d,{label:"到期时间",name:"expires_at"},{default:o(()=>[t(b,{modelValue:l(a).expires_at,"onUpdate:modelValue":e[3]||(e[3]=n=>l(a).expires_at=n),"enable-time-picker":"","allow-input":"",clearable:"",format:"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue"])]),_:1}),t(d,{label:"选中的黑名单"},{default:o(()=>[t(p,{value:JSON.stringify(l(a).id),disabled:""},null,8,["value"])]),_:1}),t(d,null,{default:o(()=>[t(k,{size:"small"},{default:o(()=>[t(v,{theme:"default",onClick:l(i).hideUpdateDialog},{default:o(()=>e[5]||(e[5]=[_(" 取消 ")])),_:1},8,["onClick"]),t(v,{type:"submit"},{default:o(()=>e[6]||(e[6]=[_(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ne=x({__name:"AddBlackList",setup(u){const i=K(),{isAddBlackList:m,addBlackListReq:a}=q(i),y={identifier:[{required:!0,message:"请输入识别码"},{validator:()=>a.value.type==="ip"&&a.value.identifier&&!P(a.value.identifier)?{result:!1,message:"请输入正确的IP地址",type:"error"}:!0}],reason:[{required:!0,message:"请输入原因"}],ban_days:[{required:!0,message:"请输入封禁天数"}]},V=async({validateResult:c})=>{c===!0&&await i.addBlackList()};return(c,e)=>{const s=h,f=R,d=N,p=M,b=X,v=S,k=D,C=z,g=T;return L(),I(g,{visible:l(m),"onUpdate:visible":e[4]||(e[4]=n=>F(m)?m.value=n:null),header:"添加黑名单",footer:!1},{default:o(()=>[t(C,{data:l(a),rules:y,onSubmit:V,labelWidth:130},{default:o(()=>[t(d,{label:"类型",name:"type"},{default:o(()=>[t(f,{modelValue:l(a).type,"onUpdate:modelValue":e[0]||(e[0]=n=>l(a).type=n)},{default:o(()=>[t(s,{label:"指纹",value:"fingerprint"}),t(s,{label:"IP",value:"ip"})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"识别码",name:"identifier"},{default:o(()=>[t(p,{modelValue:l(a).identifier,"onUpdate:modelValue":e[1]||(e[1]=n=>l(a).identifier=n)},null,8,["modelValue"])]),_:1}),t(d,{label:"原因",name:"reason"},{default:o(()=>[t(p,{modelValue:l(a).reason,"onUpdate:modelValue":e[2]||(e[2]=n=>l(a).reason=n)},null,8,["modelValue"])]),_:1}),t(d,{label:"封禁天数",name:"ban_days"},{default:o(()=>[t(b,{min:0,modelValue:l(a).ban_days,"onUpdate:modelValue":e[3]||(e[3]=n=>l(a).ban_days=n)},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(k,{size:"small"},{default:o(()=>[t(v,{theme:"default",onClick:l(i).hideAddBlackList},{default:o(()=>e[5]||(e[5]=[_(" 取消 ")])),_:1},8,["onClick"]),t(v,{type:"submit"},{default:o(()=>e[6]||(e[6]=[_(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ie={class:"buttons"},Ce=x({__name:"index",setup(u){const i=K(),{blackList:m,pagination:a,selectReq:r,selectedRowKeys:y}=q(i);J(i.getBlackLists);const V=w([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID",ellipsis:!0},{colKey:"type",title:"类型",ellipsis:!0},{colKey:"identifier",title:"识别码",ellipsis:!0},{colKey:"reason",title:"原因",ellipsis:!0},{colKey:"expires_at",title:"到期时间",width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(c,{row:e})=>t(S,{theme:"primary",onClick:s=>i.showUpdateDialog(s,e.id)},{default:()=>[_("编辑")]}),width:90,fixed:"right"}]);return(c,e)=>{const s=h,f=R,d=S,p=D,b=Z,v=Q;return L(),I(v,null,{default:o(()=>[W("div",ie,[t(p,{size:"small"},{default:o(()=>[t(f,{modelValue:l(r).column,"onUpdate:modelValue":e[0]||(e[0]=k=>l(r).column=k),onChange:l(i).getBlackLists},{default:o(()=>[t(s,{label:"按 id 排序",value:"id"}),t(s,{label:"按 type 排序",value:"type"}),t(s,{label:"按 identifier 排序",value:"identifier"}),t(s,{label:"按 reason 排序",value:"reason"}),t(s,{label:"按 expires_at 排序",value:"expires_at"}),t(s,{label:"按 created_at 排序",value:"created_at"}),t(s,{label:"按 updated_at 排序",value:"updated_at"})]),_:1},8,["modelValue","onChange"]),t(f,{modelValue:l(r).direction,"onUpdate:modelValue":e[1]||(e[1]=k=>l(r).direction=k),onChange:l(i).getBlackLists},{default:o(()=>[t(s,{label:"正序",value:"asc"}),t(s,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),t(d,{onClick:l(i).getBlackLists},{default:o(()=>e[2]||(e[2]=[_(" 刷新列表 ")])),_:1},8,["onClick"]),t(d,{onClick:l(i).showAddBlackList},{default:o(()=>e[3]||(e[3]=[_(" 添加黑名单 ")])),_:1},8,["onClick"]),t(d,{theme:"danger",onClick:l(i).deleteSelection},{default:o(()=>e[4]||(e[4]=[_(" 删除选中黑名单 ")])),_:1},8,["onClick"]),t(d,{onClick:l(i).showUpdateDialog},{default:o(()=>e[5]||(e[5]=[_(" 更新黑名单 ")])),_:1},8,["onClick"])]),_:1})]),t(ne),t(oe),t(b,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(m),pagination:l(a),columns:V.value,"select-on-row-click":!0,selectedRowKeys:l(y),onSelectChange:l(i).handleSelectChange},null,8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{Ce as default};
