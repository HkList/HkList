import{h as P,Y as le,j as U,M as _,d as I,s as z,o as D,a as R,w as o,b as e,e as a,i as $,Z as O,$ as A,a0 as ae,g as p,l as oe,f as T,a1 as ne,t as G}from"./index-D_e8F7w3.js";import{f as H,a as Q,b as E}from"./format-BfWQo8TN.js";import{u as ue,T as se}from"./useCommonStore-yXH10JG6.js";import{O as L,S as M}from"./index-BOGHR9gk.js";import{F as J,a as W}from"./index-Bo65_XdH.js";import{I as j,B as x,S as F}from"./form-model-B5UeREqF.js";import{T as ie}from"./index-CF-edOr6.js";import{D as Y}from"./index-B2QByeB2.js";import{S as de}from"./index-CdbolhUg.js";import{C as re}from"./index-D2qLX_da.js";import"./fake-arrow-B67j7q7r.js";import"./useResizeObserver-DpG4jxLQ.js";import"./dep-0df090f8-Cb_6GBHN.js";import"./index-D8YBBlIp.js";import"./add-CMcXD9Sx.js";import"./helper-Csse-oO9.js";const ce=m=>P.request("get","/admin/account",{params:m}),me=m=>P.request("post","/admin/account",{data:m}),pe=m=>P.request("post","/admin/account/update_info",{data:m}),X=m=>P.request("patch","/admin/account",{data:m}),_e=m=>P.request("delete","/admin/account",{data:m}),ve=m=>P.request("post","/admin/account/check_ban_status",{data:m}),N=le("accounts",()=>{const[m,u,c,s]=ue(ce),n=U([]),S=(V,Z)=>{n.value=V},C=async()=>{if(n.value.length===0)return _.error("请选择账号");await pe({id:n.value}),_.success("更新成功"),await s()},r=async()=>{if(n.value.length===0)return _.error("请选择账号");await _e({id:n.value}),_.success("删除成功"),await s()},t=U(!1),l=U({id:[],switch:!1}),k=()=>t.value=!0,i=()=>t.value=!1,v=async()=>{if(n.value.length===0)return _.error("请选择账号");await X({...l.value,id:n.value}),_.success("更新成功"),await s()},f=U(!1),g=()=>f.value=!0,b=()=>f.value=!1,w=U({id:[],prov:null}),h=async()=>{if(n.value.length===0)return _.error("请选择账号");await X({...w.value,id:n.value}),_.success("更新省份成功"),await s()},d=U(!1),ee=()=>d.value=!0,te=async()=>d.value=!1,K=U("cookie"),y=U({cookie:"",refresh_token:"",surl:"",pwd:"",dir:"",save_cookie:"",download_cookie:""});return{pagination:u,selectReq:m,accountList:c,getAccounts:s,selectedRowKeys:n,handleSelectChange:S,updateInfoSelection:C,deleteSelection:r,isUpdateSwitch:t,updateSwitchReq:l,showUpdateSwitchDialog:k,hideUpdateSwitchDialog:i,updateSwitch:v,isUpdateProvDialog:f,updateProvReq:w,showUpdateProvDialog:g,hideUpdateProvDialog:b,updateProvSelection:h,isAddAccount:d,addAccountType:K,addAccountInput:y,showAddAccountDialog:ee,hideAddAccountDialog:te,addAccount:async()=>{const V={account_type:K.value,account_data:[]};K.value==="cookie"?V.account_data=[{cookie:y.value.cookie}]:K.value==="enterprise_cokie"?V.account_data=[{cookie:y.value.cookie}]:K.value==="open_platform"?V.account_data=[{refresh_token:y.value.refresh_token}]:K.value==="download_ticket"&&(V.account_data=[{surl:y.value.surl,pwd:y.value.pwd,dir:y.value.dir,save_cookie:y.value.save_cookie,download_cookie:y.value.download_cookie}]),await me(V),_.success("插入成功~"),y.value={cookie:"",refresh_token:"",surl:"",pwd:"",dir:"",save_cookie:"",download_cookie:""},await s()},checkAccountBanStatus:async(V,Z)=>{V.stopPropagation(),(await ve({id:[Z]})).data.forEach(B=>{B.status.forEach(q=>{if(q.code!==200)return _.error(`账号(${B.id})状态请求失败`);if(!q.data.ban_status)return _.success(`账号(${B.id})未被封禁`);_.warning(`账号(${B.id})已被封禁`),_.warning(`原因: ${q.data.ban_reason}`),_.warning(`消息: ${q.data.ban_msg}`),_.warning(`开始时间: ${H(q.data.start_time)}`),_.warning(`结束时间: ${H(q.data.end_time)}`)})})}}}),fe=I({__name:"AddAccount",setup(m){const u=N(),{isAddAccount:c,addAccountType:s,addAccountInput:n}=z(u),S={cookie:[{required:!0,message:"Cookie不能为空"}],refresh_token:[{required:!0,message:"RefreshToken不能为空"}],surl:[{required:!0,message:"分享链接不能为空"}],pwd:[{required:!0,message:"链接密码不能为空"}],dir:[{required:!0,message:"盘内路径不能为空"}],save_cookie:[{required:!0,message:"企业号CK不能为空"}],download_cookie:[{required:!0,message:"普通号CK不能为空"}]},C=async({validateResult:r})=>{r===!0&&await u.addAccount()};return(r,t)=>{const l=L,k=M,i=J,v=j,f=ie,g=x,b=F,w=W,h=Y;return D(),R(h,{visible:a(c),"onUpdate:visible":t[8]||(t[8]=d=>$(c)?c.value=d:null),header:"添加账号",footer:!1},{default:o(()=>[e(w,{data:a(n),rules:S,onSubmit:C,labelWidth:130},{default:o(()=>[e(i,{label:"账号类型"},{default:o(()=>[e(k,{modelValue:a(s),"onUpdate:modelValue":t[0]||(t[0]=d=>$(s)?s.value=d:null)},{default:o(()=>[e(l,{label:"Cookie",value:"cookie"}),e(l,{label:"企业",value:"enterprise_cokie"}),e(l,{label:"开放平台",value:"open_platform"}),e(l,{label:"下载卷",value:"download_ticket"})]),_:1},8,["modelValue"])]),_:1}),a(s)==="cookie"||a(s)==="enterprise_cokie"?(D(),R(i,{key:0,label:"Cookie",name:"cookie"},{default:o(()=>[e(v,{modelValue:a(n).cookie,"onUpdate:modelValue":t[1]||(t[1]=d=>a(n).cookie=d)},null,8,["modelValue"])]),_:1})):a(s)==="open_platform"?(D(),R(i,{key:1,label:"RefreshToken",name:"refresh_token"},{default:o(()=>[e(v,{modelValue:a(n).refresh_token,"onUpdate:modelValue":t[2]||(t[2]=d=>a(n).refresh_token=d)},null,8,["modelValue"])]),_:1})):a(s)==="download_ticket"?(D(),O(A,{key:2},[e(i,{label:"Surl",name:"surl",help:"分享链接"},{default:o(()=>[e(v,{modelValue:a(n).surl,"onUpdate:modelValue":t[3]||(t[3]=d=>a(n).surl=d)},null,8,["modelValue"])]),_:1}),e(i,{label:"Pwd",name:"pwd",help:"链接密码"},{default:o(()=>[e(v,{modelValue:a(n).pwd,"onUpdate:modelValue":t[4]||(t[4]=d=>a(n).pwd=d)},null,8,["modelValue"])]),_:1}),e(i,{label:"Dir",name:"dir",help:"盘内路径"},{default:o(()=>[e(v,{modelValue:a(n).dir,"onUpdate:modelValue":t[5]||(t[5]=d=>a(n).dir=d)},null,8,["modelValue"])]),_:1}),e(i,{label:"SaveCookie",name:"save_cookie",help:"企业号CK"},{default:o(()=>[e(f,{modelValue:a(n).save_cookie,"onUpdate:modelValue":t[6]||(t[6]=d=>a(n).save_cookie=d)},null,8,["modelValue"])]),_:1}),e(i,{label:"DownloadCookie",name:"download_cookie",help:"普通号CK"},{default:o(()=>[e(f,{modelValue:a(n).download_cookie,"onUpdate:modelValue":t[7]||(t[7]=d=>a(n).download_cookie=d)},null,8,["modelValue"])]),_:1})],64)):ae("",!0),e(i,null,{default:o(()=>[e(b,{size:"small"},{default:o(()=>[e(g,{theme:"default",onClick:a(u).hideAddAccountDialog},{default:o(()=>t[9]||(t[9]=[p(" 取消 ")])),_:1},8,["onClick"]),e(g,{theme:"primary",type:"submit"},{default:o(()=>t[10]||(t[10]=[p(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),be=I({__name:"UpdateProv",setup(m){const u=N(),{isUpdateProvDialog:c,updateProvReq:s,selectedRowKeys:n}=z(u),S={},C=async({validateResult:r})=>{r===!0&&(await u.updateProvSelection(),u.hideUpdateProvDialog())};return(r,t)=>{const l=L,k=M,i=J,v=j,f=x,g=F,b=W,w=Y;return D(),R(w,{visible:a(c),"onUpdate:visible":t[1]||(t[1]=h=>$(c)?c.value=h:null),header:"更新账号省份",footer:!1},{default:o(()=>[e(b,{onSubmit:C,data:a(s),rules:S,labelWidth:130},{default:o(()=>[e(i,{label:"省份",name:"prov"},{default:o(()=>[e(k,{modelValue:a(s).prov,"onUpdate:modelValue":t[0]||(t[0]=h=>a(s).prov=h)},{default:o(()=>[e(l,{label:"未分配",value:null}),e(l,{label:"北京市",value:"北京市"}),e(l,{label:"天津市",value:"天津市"}),e(l,{label:"上海市",value:"上海市"}),e(l,{label:"重庆市",value:"重庆市"}),e(l,{label:"河北省",value:"河北省"}),e(l,{label:"山西省",value:"山西省"}),e(l,{label:"内蒙古自治区",value:"内蒙古自治区"}),e(l,{label:"辽宁省",value:"辽宁省"}),e(l,{label:"吉林省",value:"吉林省"}),e(l,{label:"黑龙江省",value:"黑龙江省"}),e(l,{label:"江苏省",value:"江苏省"}),e(l,{label:"浙江省",value:"浙江省"}),e(l,{label:"安徽省",value:"安徽省"}),e(l,{label:"福建省",value:"福建省"}),e(l,{label:"江西省",value:"江西省"}),e(l,{label:"山东省",value:"山东省"}),e(l,{label:"河南省",value:"河南省"}),e(l,{label:"湖北省",value:"湖北省"}),e(l,{label:"湖南省",value:"湖南省"}),e(l,{label:"广东省",value:"广东省"}),e(l,{label:"广西壮族自治区",value:"广西壮族自治区"}),e(l,{label:"海南省",value:"海南省"}),e(l,{label:"四川省",value:"四川省"}),e(l,{label:"贵州省",value:"贵州省"}),e(l,{label:"云南省",value:"云南省"}),e(l,{label:"西藏自治区",value:"西藏自治区"}),e(l,{label:"陕西省",value:"陕西省"}),e(l,{label:"甘肃省",value:"甘肃省"}),e(l,{label:"青海省",value:"青海省"}),e(l,{label:"宁夏回族自治区",value:"宁夏回族自治区"}),e(l,{label:"新疆维吾尔自治区",value:"新疆维吾尔自治区"}),e(l,{label:"香港特别行政区",value:"香港特别行政区"}),e(l,{label:"澳门特别行政区",value:"澳门特别行政区"}),e(l,{label:"台湾省",value:"台湾省"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"选中的账号"},{default:o(()=>[e(v,{value:JSON.stringify(a(n)),disabled:""},null,8,["value"])]),_:1}),e(i,null,{default:o(()=>[e(g,{size:"small"},{default:o(()=>[e(f,{theme:"default",onClick:a(u).hideUpdateProvDialog},{default:o(()=>t[2]||(t[2]=[p(" 取消 ")])),_:1},8,["onClick"]),e(f,{theme:"primary",type:"submit"},{default:o(()=>t[3]||(t[3]=[p(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ke=I({__name:"UpdateSwitch",setup(m){const u=N(),{isUpdateSwitch:c,updateSwitchReq:s,selectedRowKeys:n}=z(u),S={},C=async({validateResult:r})=>{r===!0&&(await u.updateSwitch(),u.hideUpdateSwitchDialog())};return(r,t)=>{const l=de,k=J,i=j,v=x,f=F,g=W,b=Y;return D(),R(b,{visible:a(c),"onUpdate:visible":t[1]||(t[1]=w=>$(c)?c.value=w:null),header:"更新账号",footer:!1},{default:o(()=>[e(g,{onSubmit:C,data:a(s),rules:S},{default:o(()=>[e(k,{label:"启用",name:"switch"},{default:o(()=>[e(l,{modelValue:a(s).switch,"onUpdate:modelValue":t[0]||(t[0]=w=>a(s).switch=w)},null,8,["modelValue"])]),_:1}),e(k,{label:"选中的账号"},{default:o(()=>[e(i,{value:JSON.stringify(a(n)),disabled:""},null,8,["value"])]),_:1}),e(k,null,{default:o(()=>[e(f,{size:"small"},{default:o(()=>[e(v,{theme:"default",onClick:a(u).hideUpdateSwitchDialog},{default:o(()=>t[2]||(t[2]=[p(" 取消 ")])),_:1},8,["onClick"]),e(v,{theme:"primary",type:"submit"},{default:o(()=>t[3]||(t[3]=[p(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),we={class:"buttons"},ge={class:"more-detail"},Ne=I({__name:"index",setup(m){const u=N(),{selectReq:c,accountList:s,pagination:n,selectedRowKeys:S}=z(u);oe(u.getAccounts);const C=U([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID",ellipsis:!0},{colKey:"baidu_name",title:"用户名",ellipsis:!0},{colKey:"uk",title:"用户标识",ellipsis:!0},{colKey:"account_type",title:"账号类型",ellipsis:!0},{colKey:"today_count",title:"今日解析",cell:(r,{row:t})=>e(A,null,[t.today_count,p(" ("),Q(t.today_size??0),p(")")]),width:150,ellipsis:!0},{colKey:"total_count",title:"总计解析",cell:(r,{row:t})=>e(A,null,[t.total_count,p(" ("),Q(t.total_size??0),p(")")]),width:150,ellipsis:!0},{colKey:"prov",title:"省份",cell:(r,{row:t})=>e(A,null,[t.prov===null?"未分配":t.prov]),ellipsis:!0},{colKey:"switch",title:"账号状态",cell:(r,{row:t})=>e(A,null,[t.switch?"启用":`禁用 (${t.reason})`]),ellipsis:!0},{colKey:"used_at",title:"上次使用时间",cell:(r,{row:t})=>e(A,null,[E(t.used_at)]),width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",cell:(r,{row:t})=>e(A,null,[E(t.created_at)]),width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",cell:(r,{row:t})=>e(A,null,[E(t.updated_at)]),width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(r,{row:t})=>e(x,{theme:"primary",onClick:l=>u.checkAccountBanStatus(l,t.id)},{default:()=>[p("检查封禁状态")]}),width:150,fixed:"right"}]);return(r,t)=>{const l=L,k=M,i=x,v=F,f=se,g=re;return D(),R(g,null,{default:o(()=>[T("div",we,[e(v,{size:"small"},{default:o(()=>[e(k,{modelValue:a(c).column,"onUpdate:modelValue":t[0]||(t[0]=b=>a(c).column=b),onChange:a(u).getAccounts},{default:o(()=>[e(l,{label:"按 id 排序",value:"id"}),e(l,{label:"按 baidu_name 排序",value:"baidu_name"}),e(l,{label:"按 uk 排序",value:"uk"}),e(l,{label:"按 account_type 排序",value:"account_type"}),e(l,{label:"按 account_data 排序",value:"account_data"}),e(l,{label:"按 switch 排序",value:"switch"}),e(l,{label:"按 reason 排序",value:"reason"}),e(l,{label:"按 prov 排序",value:"prov"}),e(l,{label:"按 used_at 排序",value:"used_at"}),e(l,{label:"按 created_at 排序",value:"created_at"}),e(l,{label:"按 updated_at 排序",value:"updated_at"})]),_:1},8,["modelValue","onChange"]),e(k,{modelValue:a(c).direction,"onUpdate:modelValue":t[1]||(t[1]=b=>a(c).direction=b),onChange:a(u).getAccounts},{default:o(()=>[e(l,{label:"正序",value:"asc"}),e(l,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(i,{theme:"primary",onClick:a(u).getAccounts},{default:o(()=>t[2]||(t[2]=[p(" 刷新列表 ")])),_:1},8,["onClick"]),e(i,{theme:"primary",onClick:a(u).showAddAccountDialog},{default:o(()=>t[3]||(t[3]=[p(" 添加账号 ")])),_:1},8,["onClick"]),e(i,{theme:"danger",onClick:a(u).deleteSelection},{default:o(()=>t[4]||(t[4]=[p(" 批量删除 ")])),_:1},8,["onClick"]),e(i,{theme:"primary",onClick:a(u).updateInfoSelection},{default:o(()=>t[5]||(t[5]=[p(" 批量更新账户信息 ")])),_:1},8,["onClick"]),e(i,{theme:"primary",onClick:a(u).showUpdateSwitchDialog},{default:o(()=>t[6]||(t[6]=[p(" 批量启用/禁用 ")])),_:1},8,["onClick"]),e(i,{theme:"primary",onClick:a(u).showUpdateProvDialog},{default:o(()=>t[7]||(t[7]=[p(" 批量更新省份 ")])),_:1},8,["onClick"])]),_:1})]),e(fe),e(ke),e(be),e(f,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:a(s),pagination:a(n),columns:C.value,"select-on-row-click":!0,selectedRowKeys:a(S),onSelectChange:a(u).handleSelectChange},{expandedRow:o(({row:b})=>[T("div",ge,[(D(!0),O(A,null,ne(b.account_data,(w,h)=>(D(),O("ul",{key:h},[T("li",null,G(h)+":",1),T("li",null,G(w),1)]))),128))])]),_:1},8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{Ne as default};
