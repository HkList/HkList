import{d as B,u as U,s as $,f as l,o as R,a as z,b as s,j as S,k as V,l as X,r as y,m as Y,n as ee,M as F,p as te,q as le,e,g,t as K,h as q,F as x,i as se}from"./index-BXtOGv6Q.js";import{C as T,S as H,I as ne}from"./index-CGO3Jvk9.js";import{f as j,a as oe}from"./format-BdR9u1hy.js";import{A as J,u as ae,_ as ie}from"./Aria2Dialog.vue_vue_type_script_setup_true_lang-C_VYiCNf.js";import{F as re,a as ue}from"./index-GHIRlKwr.js";import{B as G}from"./useResizeObserver-BFihYt-r.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as O}from"./index-Blo8uw3G.js";import{c as E,L as de,a as me}from"./copy-CzdQA9L2.js";import{l as I}from"./link-DnAcWoem.js";import{L as Z}from"./index-BCgCs9jE.js";import{T as _e}from"./index-YWjaZBAu.js";import"./index-B2s6Pqa4.js";import"./index-C-FZf90I.js";import"./dep-b315df3e-D1p_saOo.js";import"./fake-arrow-B3Zre1Jk.js";import"./dep-0df090f8-CGFj1a8w.js";import"./index-CFJOgvGk.js";import"./add-BMvvYsGZ.js";import"./useVirtualScrollNew-vpDyZbsk.js";import"./helper-DiIXodi3.js";import"./index-DgibZqP6.js";const pe=["innerHTML"],fe=B({__name:"Announce",setup(v){const c=U(),{config:m}=$(c);return(p,a)=>{const C=T;return l(m).show_announce?(R(),z(C,{key:0,title:"公告"},{default:s(()=>[S("div",{innerHTML:l(m).announce},null,8,pe)]),_:1})):V("",!0)}}}),N=U(),P=X("fileList",()=>{const v=y({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),c=y(),m=()=>{const o=v.value.dir.split("/");o.pop();const u=o.join("/");return u===""?"/":u},p=async()=>{r.value=[];const o=await Y(v.value);c.value=o.data,v.value.dir!=="/"&&c.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:m(),server_filename:"返回上一层",dlink:""})},a=y({token:"guest"}),C=y({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),w=y(""),d=async()=>{var o,u;try{const i=await ee(a.value);C.value=i.data,w.value=""}catch(i){const b=(u=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:u.message;b&&(w.value=b)}},r=y([]),f=y([]),L=(o,u)=>{r.value=o,f.value=u.selectedRowData},t=y(!1),n=y([]);return{GetFileListReq:v,GetFileListRes:c,getFileList:p,GetLimitReq:a,GetLimitRes:C,GetLimitError:w,getLimit:d,selectedRowKeys:r,handleSelectChange:L,getDownloadLinks:async(o,u)=>{const{config:i}=N;o&&typeof o!="number"&&u&&(o.stopPropagation(),f.value=[u]);const b=f.value.filter(_=>_&&!_.is_dir);b.length!==f.value.length&&F.warning("文件夹不会进行解析,已忽略");const D=b.filter(_=>_.size>i.min_single_filesize);D.length!==b.length&&F.warning("文件过小不会被解析");const M=D.filter(_=>_.size<i.max_single_filesize);M.length!==D.length&&F.warning("文件过大不会被解析");const k=M;if(k.length>i.max_once){F.error(`单次最多解析${i.max_once}个文件`);return}if(k.length===0){F.error("满足要求的文件数量为0");return}try{t.value=!0;const _=await te({randsk:c.value.randsk,uk:c.value.uk,shareid:c.value.shareid,fs_id:typeof o=="number"?[o]:k.map(A=>A.fs_id),surl:v.value.surl,dir:v.value.dir,pwd:v.value.pwd,token:a.value.token,parse_password:v.value.parse_password});if(typeof o=="number")return F.success("重新解析成功"),_.data;F.success("解析成功,下滑查看解析结果"),n.value=_.data}catch(_){F.error("解析可能失败或超时了,请稍后前往历史记录中尝试查询"),console.log(_)}finally{t.value=!1,await d(),await N.getConfig()}},GetDownLoadLinksRes:n}}),ge={key:1},ve=B({__name:"Form",setup(v){const c=U(),{config:m}=$(c),p=P(),{GetFileListReq:a,GetLimitReq:C,GetLimitRes:w,GetLimitError:d}=$(p),r=()=>{const t=a.value.url,n=t.match(/s\/([a-zA-Z0-9_-]+)/),h=t.match(/surl=([a-zA-Z0-9_-]+)/),o=t.match(/\?pwd=([a-zA-Z0-9_-]+)/),u=t.match(/&pwd=([a-zA-Z0-9_-]+)/),i=t.match(/提取码[:：]\s?([a-zA-Z0-9_-]+)/);if(n)a.value.surl=n[1];else if(h)a.value.surl=`1${h[1]}`;else return a.value.surl="",a.value.pwd="",a.value.dir="",F.error("无法识别的链接");return a.value.url=`https://pan.baidu.com/s/${a.value.surl}`,a.value.pwd=o?o[1]:u?u[1]:i?i[1]:"",F.success("链接识别成功~"),!0},f={url:[{required:!0,message:"链接不能为空"}],parse_password:[{required:!0,message:"解析密码不能为空"}]};le(()=>{p.getLimit(),c.getConfig()});const L=async({validateResult:t})=>{t===!0&&(a.value.dir="/",await p.getFileList(),F.success("获取成功"))};return(t,n)=>{const h=J,o=H,u=ne,i=re,b=G,D=ue,M=T;return R(),z(M,null,{default:s(()=>[e(o,{direction:"vertical",class:"space"},{default:s(()=>[e(h,{theme:l(m).have_account?"success":"error"},{default:s(()=>[g(K(l(m).have_account?"当前中转账号充足":"当前中转账号不足"),1)]),_:1},8,["theme"]),l(m).debug?(R(),z(h,{key:0,theme:"error"},{default:s(()=>n[4]||(n[4]=[g(" 当前网站开启了DEBUG模式,非调试请关闭!!!! ")])),_:1})):V("",!0),e(h,{theme:l(d).length===0?"success":"error"},{default:s(()=>[l(d).length===0?(R(),z(o,{key:0},{default:s(()=>[S("span",null,"剩余可解析文件数: "+K(l(w).count),1),S("span",null,"剩余可解析大小: "+K(l(j)(l(w).size)),1),S("span",null,"到期时间: "+K(l(w).expires_at),1)]),_:1})):(R(),q("span",ge,K(l(d)),1))]),_:1},8,["theme"]),e(D,{data:l(a),rules:f,onSubmit:L},{default:s(()=>[e(i,{name:"url",label:"链接"},{default:s(()=>[e(u,{modelValue:l(a).url,"onUpdate:modelValue":n[0]||(n[0]=k=>l(a).url=k),modelModifiers:{trim:!0},onBlur:r},null,8,["modelValue"])]),_:1}),e(i,{name:"surl",label:"提取到的链接"},{default:s(()=>[e(u,{value:l(a).surl,disabled:""},null,8,["value"])]),_:1}),e(i,{name:"pwd",label:"提取码"},{default:s(()=>[e(u,{modelValue:l(a).pwd,"onUpdate:modelValue":n[1]||(n[1]=k=>l(a).pwd=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),l(m).need_password?(R(),z(i,{key:0,name:"parse_password",label:"解析密码"},{default:s(()=>[e(u,{modelValue:l(a).parse_password,"onUpdate:modelValue":n[2]||(n[2]=k=>l(a).parse_password=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):V("",!0),e(i,{name:"token",label:"卡密"},{default:s(()=>[e(u,{modelValue:l(C).token,"onUpdate:modelValue":n[3]||(n[3]=k=>l(C).token=k),modelModifiers:{trim:!0},onBlur:l(p).getLimit},null,8,["modelValue","onBlur"])]),_:1}),e(i,null,{default:s(()=>[e(o,{size:"small"},{default:s(()=>[e(b,{type:"submit"},{default:s(()=>n[5]||(n[5]=[g(" 获取文件列表 ")])),_:1}),e(b,{onClick:l(p).getDownloadLinks},{default:s(()=>n[6]||(n[6]=[g(" 批量解析 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})}}}),we=ce(ve,[["__scopeId","data-v-6853fcf7"]]),ke=B({__name:"FilesList",setup(v){const c=P(),{GetFileListReq:m,GetFileListRes:p,selectedRowKeys:a}=$(c),C=y([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"server_filename",title:"文件名",cell:(d,{row:r})=>e(x,null,[e("div",{class:"filename"},[e("img",{class:"ico",src:r.is_dir?"/images/folder.png":"/images/file.png"},null),e("span",null,[r.server_filename])])]),ellipsis:!0},{colKey:"server_mtime",title:"修改时间",cell:(d,{row:r})=>e(x,null,[oe(r.server_mtime)]),ellipsis:!0},{colKey:"size",title:"文件大小",cell:(d,{row:r})=>e(x,null,[j(r.size)]),ellipsis:!0},{colKey:"operation",title:"操作",cell:(d,{row:r})=>r.is_dir?e(x,null,[e(G,{theme:"primary",onClick:f=>w(f,r.path)},{default:()=>[g("打开文件夹")]})]):e(x,null,[e(G,{theme:"primary",onClick:f=>c.getDownloadLinks(f,r)},{default:()=>[g("解析")]})]),width:130,align:"center",fixed:"right"}]),w=async(d,r)=>{d.stopPropagation(),m.value.dir=r,await c.getFileList()};return(d,r)=>{const f=O,L=T;return l(p)?(R(),z(L,{key:0},{default:s(()=>[e(f,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:l(p).list,maxHeight:500,columns:C.value,"select-on-row-click":!0,selectedRowKeys:l(a),onSelectChange:l(c).handleSelectChange},null,8,["data","columns","selectedRowKeys","onSelectChange"])]),_:1})):V("",!0)}}}),ye=B({__name:"LinksList",setup(v){const c=P(),{GetDownLoadLinksRes:m}=$(c),p=ae(),a=y([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"message",title:"状态"},{colKey:"filename",title:"文件名"},{colKey:"ua",title:"UA",cell:(L,{row:t})=>e(Z,{onClick:()=>E(t.ua)},{default:()=>[e(I,null,null),t.ua]})},{colKey:"fs_id",title:"文件ID"},{colKey:"operation",title:"操作",cell:(L,{row:t,rowIndex:n})=>e(x,null,[e(G,{onClick:()=>C(t,n)},{default:()=>[g("重新解析")]})])}]),C=async(L,t)=>{const n=await c.getDownloadLinks(L.fs_id);n&&(m.value[t]=n[0])},w=y([]),d=y([]),r=(L,t)=>{w.value=L,d.value=t.selectedRowData.filter(n=>n.urls).map(n=>({filename:n.filename,urls:n.urls,ua:n.ua}))},f=()=>{w.value=[],d.value=[]};return(L,t)=>{const n=Z,h=G,o=H,u=J,i=_e,b=me,D=de,M=O,k=T;return l(m).length>0?(R(),z(k,{key:0},{default:s(()=>[e(o,{direction:"vertical"},{default:s(()=>[e(u,null,{default:s(()=>[t[4]||(t[4]=g(" 下载请推荐使用Aria2下载器,如 ")),e(n,{href:"https://motrix.app/",target:"_blank"},{"prefix-icon":s(()=>[e(l(I))]),default:s(()=>[t[1]||(t[1]=g(" Motrix "))]),_:1}),t[5]||(t[5]=S("p",null,"IDM下载需要手动指定UA,点击即可复制",-1)),t[6]||(t[6]=S("p",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可重新解析该文件",-1)),t[7]||(t[7]=S("br",null,null,-1)),e(o,null,{default:s(()=>[e(h,{onClick:l(p).showAria2Config},{default:s(()=>t[2]||(t[2]=[g(" 修改Aria2配置 ")])),_:1},8,["onClick"]),e(h,{onClick:t[0]||(t[0]=_=>l(p).downloadLinks(d.value))},{default:s(()=>t[3]||(t[3]=[g("批量发送")])),_:1})]),_:1})]),_:1}),e(M,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:l(m),columns:a.value,"select-on-row-click":!0,selectedRowKeys:w.value,onSelectChange:r,onPageChange:f},{expandedRow:s(({row:_})=>[e(D,{split:"",size:"large"},{default:s(()=>[(R(!0),q(x,null,se(_.urls,(A,Q)=>(R(),z(b,{key:A},{default:s(()=>[e(o,{direction:"vertical"},{default:s(()=>[e(o,null,{default:s(()=>[e(i,{size:"large"},{default:s(()=>[g(" 第 "+K(Q+1)+" 条 ",1)]),_:2},1024),e(h,{onClick:W=>l(E)(A)},{default:s(()=>t[8]||(t[8]=[g("复制")])),_:2},1032,["onClick"]),e(h,{onClick:W=>l(p).addAria2Url(A,_.filename,_.ua,16)},{default:s(()=>t[9]||(t[9]=[g("发送到Aria2下载器")])),_:2},1032,["onClick"])]),_:2},1024),S("p",null,K(A),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","columns","selectedRowKeys"])]),_:1})]),_:1})):V("",!0)}}}),Ie=B({__name:"index",setup(v){return(c,m)=>(R(),q(x,null,[e(fe),e(we),e(ke),e(ye),e(ie)],64))}});export{Ie as default};
