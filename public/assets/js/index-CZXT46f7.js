import{D as E,v as ne,b as h,M as U,d as B,s as $,o as y,e as S,g as o,h as e,i as l,m as r,j as L,B as R,$ as M,q as ae,A as ie,l as J,n as se,p as ue,F as z,t as H}from"./index-CV3fu6i-.js";import{c as W,L as de,a as re}from"./copy-Cl12ygGi.js";import{G as N,f as I,b as me}from"./format-CjozJBcl.js";import{u as pe}from"./useCommonStore-D-Thrjcv.js";import{O as X,S as Z,T as _e}from"./index-DZ-TUD3T.js";import{F as G,a as O}from"./index-1SfUu0_F.js";import{I as Y,S as F,C as ce}from"./index-CdgF-B5O.js";import{I as ee}from"./index-spX1BO2C.js";import{V as fe,D as ge}from"./validates-k1Z3eOf5.js";import{S as te}from"./index-C0sCzzCH.js";import{T as ke}from"./index-C_bP7Fag.js";import{D as be,a as ve}from"./index-CoU9LyVc.js";import{T as ye}from"./index-CoIIykQO.js";import"./useVirtualScrollNew-oKZXErT7.js";import"./useResizeObserver-DM5PrmsF.js";import"./dep-1296ed3e-DtBVqCkS.js";import"./fake-arrow-B3O7ttQ5.js";import"./add-ZnKv6a83.js";import"./index-WeThOMeb.js";import"./helper-C9ADZrPD.js";const we=g=>E.request("get","/admin/token",{params:g}),Ve=g=>E.request("post","/admin/token",{data:g}),Q=g=>E.request("patch","/admin/token",{data:g}),Se=g=>E.request("delete","/admin/token",{data:g}),P=ne("tokens",()=>{const[g,u,p,n]=pe(we),f=h([]),w=h([]),V=(D,K)=>{f.value=D,w.value=K.selectedRowData},a=h(!1),t=()=>a.value=!0,d=()=>a.value=!1,s=h({count:100,size:1e3,day:100,can_use_ip_count:5,type:"generate",generate_count:10}),_=async()=>{await Ve({...s.value,size:s.value.size*N}),U.success("添加成功"),await n()},c=h(!1),v=()=>c.value=!0,C=()=>c.value=!1,b=h({id:[],switch:!0,reason:"手动操作"}),k=async()=>{if(f.value.length===0)return U.error("请选择卡密");await Q({...b.value,id:f.value}),U.success(`${b.value.switch?"启用":"禁用"}成功`),await n()},m=async()=>{if(f.value.length===0)return U.error("请选择卡密");await Se({id:f.value}),U.success("删除成功"),await n()},T=h(!1),i=h({id:[],count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0});return{tokenList:p,pagination:u,selectReq:g,getTokens:n,selectedRowKeys:f,handleSelectChange:V,isAddingToken:a,showAddingTokenDialog:t,hideAddingTokenDialog:d,addingTokenReq:s,addToken:_,isUpdateSwitchDialog:c,showUpdateSwitchDialog:v,hideUpdateSwitchDialog:C,updateSwitchReq:b,updateSwitchSelection:k,deleteSelection:m,isEditDialog:T,updateReq:i,showEditDialog:(D,K)=>{if(D&&K?(D.stopPropagation(),i.value.id=[K]):i.value={id:f.value,count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0},i.value.id.length===1){const A=p.value.find(oe=>oe.id===i.value.id[0]);A&&(i.value={...A,size:A.size/N,id:i.value.id})}T.value=!0},hideEditDialog:()=>T.value=!1,updateSelection:async()=>{if(i.value.id.length===0)return U.error("请选择卡密");await Q({...i.value,size:(i.value.size??0)*N,token:i.value.id.length===1&&i.value.token==="guest"?void 0:i.value.token}),U.success("更新成功~"),await n()},copySelection:()=>{W(w.value.map(D=>`${D.token} | ${I(D.size)} | ${D.count} 次 | ${D.day} 天`).join(`
`))}}}),Ce=B({__name:"AddToken",setup(g){const u=P(),{isAddingToken:p,addingTokenReq:n}=$(u),f={token:[{required:!0,message:"卡密不能为空"}],generate_count:[{required:!0,message:"生成数量不能为空"}],count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},w=async({validateResult:V})=>{V===!0&&(await u.addToken(),u.hideAddingTokenDialog())};return(V,a)=>{const t=X,d=Z,s=G,_=Y,c=ee,v=R,C=F,b=O,k=M;return y(),S(k,{visible:l(p),"onUpdate:visible":a[7]||(a[7]=m=>L(p)?p.value=m:null),header:"添加卡密",footer:!1},{default:o(()=>[e(b,{onSubmit:w,data:l(n),rules:f},{default:o(()=>[e(s,{name:"type",label:"添加方式"},{default:o(()=>[e(d,{modelValue:l(n).type,"onUpdate:modelValue":a[0]||(a[0]=m=>l(n).type=m)},{default:o(()=>[e(t,{label:"手动添加",value:"set"}),e(t,{label:"自动添加",value:"generate"})]),_:1},8,["modelValue"])]),_:1}),l(n).type==="set"?(y(),S(s,{key:0,name:"token",label:"卡密"},{default:o(()=>[e(_,{modelValue:l(n).token,"onUpdate:modelValue":a[1]||(a[1]=m=>l(n).token=m)},null,8,["modelValue"])]),_:1})):(y(),S(s,{key:1,name:"generate_count",label:"生成数量"},{default:o(()=>[e(c,{min:1,modelValue:l(n).generate_count,"onUpdate:modelValue":a[2]||(a[2]=m=>l(n).generate_count=m)},null,8,["modelValue"])]),_:1})),e(s,{name:"count",label:"次数配额"},{default:o(()=>[e(c,{min:1,modelValue:l(n).count,"onUpdate:modelValue":a[3]||(a[3]=m=>l(n).count=m)},null,8,["modelValue"])]),_:1}),e(s,{name:"size",label:"大小配额(GB)"},{default:o(()=>[e(c,{min:1,modelValue:l(n).size,"onUpdate:modelValue":a[4]||(a[4]=m=>l(n).size=m)},null,8,["modelValue"])]),_:1}),e(s,{name:"day",label:"时间配额"},{default:o(()=>[e(c,{min:1,modelValue:l(n).day,"onUpdate:modelValue":a[5]||(a[5]=m=>l(n).day=m)},null,8,["modelValue"])]),_:1}),e(s,{name:"can_use_ip_count",label:"IP配额"},{default:o(()=>[e(c,{min:1,modelValue:l(n).can_use_ip_count,"onUpdate:modelValue":a[6]||(a[6]=m=>l(n).can_use_ip_count=m)},null,8,["modelValue"])]),_:1}),e(s,null,{default:o(()=>[e(C,{size:"small"},{default:o(()=>[e(v,{theme:"default",onClick:l(u).hideUpdateSwitchDialog},{default:o(()=>a[8]||(a[8]=[r(" 取消 ")])),_:1},8,["onClick"]),e(v,{type:"submit"},{default:o(()=>a[9]||(a[9]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),De=B({__name:"UpdateToken",setup(g){const u=P(),{isEditDialog:p,updateReq:n}=$(u),f={count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},w=async({validateResult:a})=>{a===!0&&(await u.updateSelection(),u.hideEditDialog())},V=(a,t)=>{if(!(!t.item||typeof t.item=="number")){if(!fe(t.item)){U.error("请输入正确的 ip 地址");return}n.value.ip=a}};return(a,t)=>{const d=Y,s=G,_=ee,c=_e,v=ge,C=te,b=R,k=F,m=O,T=M;return y(),S(T,{visible:l(p),"onUpdate:visible":t[8]||(t[8]=i=>L(p)?p.value=i:null),header:"更新卡密",footer:!1},{default:o(()=>[e(m,{onSubmit:w,data:l(n),rules:f},{default:o(()=>[l(n).id.length===1&&l(n).token!=="guest"?(y(),S(s,{key:0,name:"token",label:"卡密"},{default:o(()=>[e(d,{modelValue:l(n).token,"onUpdate:modelValue":t[0]||(t[0]=i=>l(n).token=i)},null,8,["modelValue"])]),_:1})):ae("",!0),e(s,{name:"count",label:"次数配额"},{default:o(()=>[e(_,{min:1,modelValue:l(n).count,"onUpdate:modelValue":t[1]||(t[1]=i=>l(n).count=i)},null,8,["modelValue"])]),_:1}),e(s,{name:"size",label:"大小配额(GB)"},{default:o(()=>[e(_,{min:1,modelValue:l(n).size,"onUpdate:modelValue":t[2]||(t[2]=i=>l(n).size=i)},null,8,["modelValue"])]),_:1}),e(s,{name:"day",label:"时间配额"},{default:o(()=>[e(_,{min:1,modelValue:l(n).day,"onUpdate:modelValue":t[3]||(t[3]=i=>l(n).day=i)},null,8,["modelValue"])]),_:1}),e(s,{name:"can_use_ip_count",label:"IP配额"},{default:o(()=>[e(_,{min:1,modelValue:l(n).can_use_ip_count,"onUpdate:modelValue":t[4]||(t[4]=i=>l(n).can_use_ip_count=i)},null,8,["modelValue"])]),_:1}),e(s,{name:"ip",label:"已绑IP",help:"回车添加"},{default:o(()=>[e(c,{value:l(n).ip,onChange:V},null,8,["value"])]),_:1}),e(s,{name:"expires_at",label:"过期时间"},{default:o(()=>[e(v,{modelValue:l(n).expires_at,"onUpdate:modelValue":t[5]||(t[5]=i=>l(n).expires_at=i),"enable-time-picker":"","allow-input":"",clearable:"",format:"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue"])]),_:1}),e(s,{name:"switch",label:"启用"},{default:o(()=>[e(C,{modelValue:l(n).switch,"onUpdate:modelValue":t[6]||(t[6]=i=>l(n).switch=i)},null,8,["modelValue"])]),_:1}),e(s,{name:"reason",label:"原因"},{default:o(()=>[e(d,{modelValue:l(n).reason,"onUpdate:modelValue":t[7]||(t[7]=i=>l(n).reason=i)},null,8,["modelValue"])]),_:1}),e(s,{label:"选中的卡密"},{default:o(()=>[e(d,{value:JSON.stringify(l(n).id),disabled:""},null,8,["value"])]),_:1}),e(s,null,{default:o(()=>[e(k,{size:"small"},{default:o(()=>[e(b,{theme:"default",onClick:l(u).hideEditDialog},{default:o(()=>t[9]||(t[9]=[r(" 取消 ")])),_:1},8,["onClick"]),e(b,{type:"submit"},{default:o(()=>t[10]||(t[10]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ze=B({__name:"UpdateSwitch",setup(g){const u=P(),{isUpdateSwitchDialog:p,updateSwitchReq:n,selectedRowKeys:f}=$(u),w={},V=async({validateResult:a})=>{a===!0&&(await u.updateSwitchSelection(),u.hideUpdateSwitchDialog())};return(a,t)=>{const d=te,s=G,_=Y,c=R,v=F,C=O,b=M;return y(),S(b,{visible:l(p),"onUpdate:visible":t[2]||(t[2]=k=>L(p)?p.value=k:null),header:"启用/禁用卡密",footer:!1},{default:o(()=>[e(C,{onSubmit:V,data:l(n),rules:w},{default:o(()=>[e(s,{label:"启用",name:"switch"},{default:o(()=>[e(d,{modelValue:l(n).switch,"onUpdate:modelValue":t[0]||(t[0]=k=>l(n).switch=k)},null,8,["modelValue"])]),_:1}),e(s,{label:"原因",name:"reason"},{default:o(()=>[e(_,{modelValue:l(n).reason,"onUpdate:modelValue":t[1]||(t[1]=k=>l(n).reason=k)},null,8,["modelValue"])]),_:1}),e(s,{label:"选中的账号"},{default:o(()=>[e(_,{value:JSON.stringify(l(f)),disabled:""},null,8,["value"])]),_:1}),e(s,null,{default:o(()=>[e(v,{size:"small"},{default:o(()=>[e(c,{theme:"default",onClick:l(u).hideUpdateSwitchDialog},{default:o(()=>t[3]||(t[3]=[r(" 取消 ")])),_:1},8,["onClick"]),e(c,{type:"submit"},{default:o(()=>t[4]||(t[4]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),he={class:"buttons"},Je=B({__name:"index",setup(g){const u=P(),{selectReq:p,tokenList:n,pagination:f,selectedRowKeys:w}=$(u);ie(u.getTokens);const V=h([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID"},{colKey:"token",title:"卡密",width:200,ellipsis:!0},{colKey:"switch",title:"状态",cell:(a,{row:t})=>e(z,null,[t.switch?"启用":`禁用 (${t.reason})`]),ellipsis:!0},{colKey:"today_count",title:"今日解析",cell:(a,{row:t})=>e(z,null,[t.today_count,r(" ("),I(t.today_size??0),r(")")]),width:150,ellipsis:!0},{colKey:"total_count",title:"总计解析",cell:(a,{row:t})=>e(z,null,[t.total_count,r(" ("),I(t.total_size??0),r(")")]),width:150,ellipsis:!0},{colKey:"size",title:"大小配额",cell:(a,{row:t})=>e(z,null,[I(t.size)]),width:90,ellipsis:!0},{colKey:"count",title:"次数配额",cell:(a,{row:t})=>e(z,null,[t.count,r(" 次")]),width:90,ellipsis:!0},{colKey:"day",title:"时间配额",cell:(a,{row:t})=>e(z,null,[t.day,r(" 天")]),width:90,ellipsis:!0},{colKey:"can_use_ip_count",title:"IP配额",cell:(a,{row:t})=>e(z,null,[t.can_use_ip_count,r(" 个")]),ellipsis:!0},{colKey:"expires_at",title:"过期时间",cell:(a,{row:t})=>e(z,null,[t.expires_at===null?"未使用":me(t.expires_at)]),width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(a,{row:t})=>e(R,{theme:"primary",onClick:d=>u.showEditDialog(d,t.id)},{default:()=>[r("编辑")]}),width:90,fixed:"right"}]);return(a,t)=>{const d=X,s=Z,_=R,c=F,v=ke,C=re,b=de,k=be,m=ve,T=ye,i=ce;return y(),S(i,null,{default:o(()=>[J("div",he,[e(c,{size:"small"},{default:o(()=>[e(s,{modelValue:l(p).column,"onUpdate:modelValue":t[0]||(t[0]=q=>l(p).column=q),onChange:l(u).getTokens},{default:o(()=>[e(d,{label:"按 id 排序",value:"id"}),e(d,{label:"按 token 排序",value:"token"}),e(d,{label:"按 count 排序",value:"count"}),e(d,{label:"按 size 排序",value:"size"}),e(d,{label:"按 day 排序",value:"day"}),e(d,{label:"按 can_use_ip_count 排序",value:"can_use_ip_count"}),e(d,{label:"按 ip 排序",value:"ip"}),e(d,{label:"按 expires_at 排序",value:"expires_at"}),e(d,{label:"按 created_at 排序",value:"created_at"}),e(d,{label:"按 updated_at 排序",value:"updated_at"}),e(d,{label:"按 deleted_at 排序",value:"deleted_at"})]),_:1},8,["modelValue","onChange"]),e(s,{modelValue:l(p).direction,"onUpdate:modelValue":t[1]||(t[1]=q=>l(p).direction=q),onChange:l(u).getTokens},{default:o(()=>[e(d,{label:"正序",value:"asc"}),e(d,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(_,{onClick:l(u).getTokens},{default:o(()=>t[2]||(t[2]=[r(" 刷新列表 ")])),_:1},8,["onClick"]),e(_,{onClick:l(u).showAddingTokenDialog},{default:o(()=>t[3]||(t[3]=[r(" 添加卡密 ")])),_:1},8,["onClick"]),e(_,{onClick:l(u).deleteSelection},{default:o(()=>t[4]||(t[4]=[r(" 批量删除 ")])),_:1},8,["onClick"]),e(_,{onClick:l(u).showUpdateSwitchDialog},{default:o(()=>t[5]||(t[5]=[r(" 批量启用/禁用 ")])),_:1},8,["onClick"]),e(_,{onClick:l(u).showEditDialog},{default:o(()=>t[6]||(t[6]=[r(" 批量更新 ")])),_:1},8,["onClick"]),e(_,{onClick:l(u).copySelection},{default:o(()=>t[7]||(t[7]=[r(" 批量复制 ")])),_:1},8,["onClick"])]),_:1})]),e(Ce),e(ze),e(De),e(T,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(n),pagination:l(f),columns:V.value,"select-on-row-click":!0,selectedRowKeys:l(w),onSelectChange:l(u).handleSelectChange},{expandedRow:o(({row:q})=>[e(m,{bordered:"",colon:"",layout:"vertical"},{default:o(()=>[e(k,{label:"已绑定的ip"},{default:o(()=>[q.ip.length===0?(y(),S(v,{key:0,size:"large"},{default:o(()=>t[8]||(t[8]=[r(" 没有绑定的IP ")])),_:1})):(y(),S(b,{key:1,stripe:"",split:"",size:"large"},{default:o(()=>[(y(!0),se(z,null,ue(q.ip,(x,j)=>(y(),S(C,{key:x},{default:o(()=>[e(c,{direction:"vertical"},{default:o(()=>[e(c,null,{default:o(()=>[e(v,{size:"large"},{default:o(()=>[r(" 第 "+H(j+1)+" 条 ",1)]),_:2},1024),e(_,{onClick:le=>l(W)(x)},{default:o(()=>t[9]||(t[9]=[r("复制")])),_:2},1032,["onClick"])]),_:2},1024),J("p",null,H(x),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{Je as default};
