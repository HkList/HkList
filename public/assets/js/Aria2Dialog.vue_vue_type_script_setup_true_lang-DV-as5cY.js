import{p as J,q as K,e as u,v as W,d as O,x as X,y as j,z as Q,A as Y,B as Z,C as ee,D as ae,E as ne,r as m,l as U,G as te,H as le,I as se,_ as oe,J as ie,K as re,L as ue,N as ce,O as de,u as fe,n as q,P as ve,Q as ge,M as p,R as M,S as me,s as _e,o as pe,a as Ce,b as y,f as L,g as G,T as he}from"./index-C154U0Dp.js";import{f as we}from"./format-DG0dyroc.js";import{I as ke,S as Fe}from"./index-DG4QJa8k.js";import{F as Ie,a as Se}from"./index-CsFk7FR9.js";import{B as ye}from"./useResizeObserver-CnwZ8Jyj.js";import{D as Le}from"./index-D8p-l6pB.js";/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */function xe(){var l=W();return function(v,_){var w;if(J(l.props[v]))w=l.props[v](K);else if(l.slots[v])w=l.slots[v]&&l.slots[v](null)[0];else if(_){var t=_[l.props.theme];w=u(t,null,null)}return w}}/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var Ae={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(a){return["success","info","warning","error"].includes(a)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var be=O({name:"TAlert",props:Ae,setup:function(a){var v=X("alert"),_=v.globalConfig,w=v.classPrefix,t=j({CheckCircleFilledIcon:Q,CloseIcon:Y,ErrorCircleFilledIcon:Z,HelpCircleFilledIcon:ee,InfoCircleFilledIcon:ae}),x=t.CheckCircleFilledIcon,c=t.CloseIcon,I=t.ErrorCircleFilledIcon,C=t.HelpCircleFilledIcon,h=t.InfoCircleFilledIcon,s=ne("alert"),o=ce(),d=xe(),i=m(null),k=m(null),g=m(0),F=m(!0),f=m(!0),A=function(){var e={info:h,success:x,warning:I,error:I,question:C},n=d("icon",e);return n?u("div",{class:"".concat(s.value,"__icon")},[n]):null},V=function(){var e=a.close,n=null;return e===!0||e===""?n=u(c,null,null):ie(e)?n=e:n=d("close"),n?u("div",{class:"".concat(s.value,"__close"),onClick:P},[n]):null},$=function(){var e=o("title");return e?u("div",{class:"".concat(s.value,"__title")},[" ",e]):null},b=function(){var e=o("operation");return u("div",{class:"".concat(s.value,"__message")},[T(),e?u("div",{class:"".concat(s.value,"__operation")},[e]):null])},T=function(){var e,n;n=o("default"),n||(n=o("message"));var S=ue(n)?n.length:1,R=a.maxLine>0&&a.maxLine<S,N=(e=k.value)===null||e===void 0||(e=e.children[0])===null||e===void 0?void 0:e.offsetHeight;return R&&f.value?(n=n.slice(0,a.maxLine),N&&(k.value.style.height="".concat(g.value,"px"))):R&&N&&(k.value.style.height="".concat(N*(S-a.maxLine)+g.value,"px")),u("div",{class:"".concat(s.value,"__description"),ref:k},[R?n.map(function(E){return u("div",null,[E])}):n,R?u("div",{class:"".concat(s.value,"__collapse"),onClick:function(){f.value=!f.value}},[f.value?_.value.expandText:_.value.collapseText]):null])},z=function(){return u("div",{class:"".concat(s.value,"__content")},[$(),b()])},P=function(e){var n;(n=a.onClose)===null||n===void 0||n.call(a,{e}),re(i.value,"".concat(s.value,"--closing"))},D=function(e){var n=e.target===i.value;if(e.propertyName==="opacity"&&n){var S;F.value=!1,(S=a.onClosed)===null||S===void 0||S.call(a,{e})}};return U(function(){te(i.value,"transitionend",D),g.value=k.value.offsetHeight}),le(function(){se(i.value,"transitionend",D)}),function(){return u("div",{ref:i,class:["".concat(s.value),"".concat(s.value,"--").concat(a.theme),oe({},"".concat(w.value,"-is-hidden"),!F.value)]},[A(),z(),V()])}}});/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var Te=de(be);const B=fe(),Ne=q("fileList",()=>{const l=m({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),a=m(),v=m([]),_=()=>v.value.length===0?"/":v.value[v.value.length-2]??"/",w=async()=>{C.value=[];const g=await ve(l.value);a.value=g.data,l.value.dir!=="/"?a.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:_(),server_filename:"返回上一层",dlink:""}):v.value=[]},t=m({token:localStorage.getItem("token")??"guest"}),x=m({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),c=m(""),I=async()=>{var g,F;try{const f=await ge(t.value);x.value=f.data,c.value="",localStorage.setItem("token",t.value.token)}catch(f){const A=(F=(g=f==null?void 0:f.response)==null?void 0:g.data)==null?void 0:F.message;A&&(c.value=A)}},C=m([]),h=m([]),s=(g,F)=>{C.value=g,h.value=F.selectedRowData},o=m({hit_captcha:!1,vcode_str:"",vcode_img:"",vcode_input:""}),d=m(!1),i=m([]);return{GetFileListReq:l,GetFileListRes:a,getFileList:w,GetLimitReq:t,GetLimitRes:x,GetLimitError:c,getLimit:I,selectedRowKeys:C,handleSelectChange:s,getDownloadLinks:async(g,F)=>{var z,P,D;if(d.value)return p.error("正在解析中,请稍后再试"),!1;const{config:f}=B;g&&typeof g!="number"&&F&&(g.stopPropagation(),h.value=[F]);const A=h.value.filter(r=>r&&!r.is_dir);A.length!==h.value.length&&p.warning("暂时不支持解析文件夹");const V=A.filter(r=>r.size>f.min_single_filesize);V.length!==A.length&&p.warning("文件过小不会被解析");const $=V.filter(r=>r.size<f.max_single_filesize);$.length!==V.length&&p.warning("文件过大不会被解析");const b=$;if(b.reduce((r,e)=>r+e.size,0)>f.max_all_filesize){p.error(`单次最多解析${we(f.max_all_filesize)}的文件`);return}if(b.length>f.max_once){p.error(`单次最多解析${f.max_once}个文件`);return}if(b.length===0){p.error("满足要求的文件数量为0");return}try{if(d.value=!0,o.value.hit_captcha=!1,typeof g=="number"){const r=await M({randsk:a.value.randsk,uk:a.value.uk,shareid:a.value.shareid,fs_id:[g],surl:l.value.surl,dir:l.value.dir,pwd:l.value.pwd,token:t.value.token,parse_password:l.value.parse_password,...o.value.hit_captcha?{vcode_str:o.value.vcode_str,vcode_input:o.value.vcode_input}:{}});return p.success("重新解析成功"),r.data}else{const r=[];let e=null,n;try{for(const S in b){n=b[S],e&&e.close(),e=await p.loading(`正在解析第${parseFloat(S)+1}个文件:${n.server_filename}`,9999999);const R=await M({randsk:a.value.randsk,uk:a.value.uk,shareid:a.value.shareid,fs_id:[n.fs_id],surl:l.value.surl,dir:l.value.dir,pwd:l.value.pwd,token:t.value.token,parse_password:l.value.parse_password,...o.value.hit_captcha?{vcode_str:o.value.vcode_str,vcode_input:o.value.vcode_input}:{}});r.push(...R.data),n!==null&&(C.value=C.value.filter(N=>N!==n.fs_id),h.value=h.value.filter(N=>N.fs_id!==n.fs_id))}}catch(S){throw e&&e.close(),i.value=r,p.success("部分解析成功,下滑查看解析结果"),S}e&&e.close(),p.success("解析成功,下滑查看解析结果"),i.value=r}}catch(r){const e=r;if((D=(P=(z=e==null?void 0:e.response)==null?void 0:z.data)==null?void 0:P.message)!=null&&D.includes("-20")){const n=await me({parse_password:l.value.parse_password});o.value={hit_captcha:!0,...n.data,vcode_input:""}}else p.error("解析可能失败或超时了,请稍后前往历史记录中尝试查询是否成功")}finally{d.value=!1,await I(),await B.getConfig()}},GetDownLoadLinksRes:i,vcode:o,paths:v}}),H=Ne(),Re=q("aria2",()=>{const l=m(!1),a=m({host:"ws://localhost:16800/jsonrpc",token:"",dir:""});U(()=>{const s=localStorage.getItem("aria2Config");s&&(a.value=JSON.parse(s))});const v=()=>l.value=!0,_=()=>l.value=!1,w=()=>{localStorage.setItem("aria2Config",JSON.stringify(a.value)),t=null};let t=null;const x=()=>new Promise((s,o)=>{t&&(t.close(),t=null);try{t=new WebSocket(a.value.host),t.onopen=()=>s(t),t.onerror=d=>{p.error("链接到Aria2下载器出错"),o(d)}}catch(d){p.error("链接到Aria2下载器出错"),o(d)}}),c=async(s,o=[])=>((!t||t.readyState!==WebSocket.OPEN)&&(t=await x()),new Promise((d,i)=>{t=t;const k="HkList"+Date.now().toString(),g={jsonrpc:"2.0",method:s,id:k,params:[`token:${a.value.token}`,...o]};t.onmessage=F=>{const f=JSON.parse(F.data);f.id===k&&(f.error?i(f.error):d(f.result))},t.send(JSON.stringify(g))})),I=async()=>{await c("aria2.getVersion"),p.success("测试连接成功")},C=async(s,o,d,i)=>{await c("aria2.addUri",[[s],{out:o,dir:a.value.dir===""?null:a.value.dir,header:[`User-Agent: ${d}`],split:i.toString()}]),p.success("添加链接成功")};return{aria2ConfigDialogVisible:l,showAria2Config:v,hideAria2Config:_,aria2ConfigForm:a,saveAria2Config:w,getAria2Version:I,addAria2Url:C,downloadLinks:async(s,o=0)=>{for(const d of s){let i=d.filename;if(d.fs_id&&H.GetFileListRes){const k=H.GetFileListRes.list.find(g=>g.fs_id===d.fs_id);k&&(i=k.path)}await C(d.urls[o],i,d.ua,16)}}}}),Ee=O({__name:"Aria2Dialog",setup(l){const a=Re(),{aria2ConfigDialogVisible:v,aria2ConfigForm:_}=_e(a),w={},t=async({validateResult:x})=>{x===!0&&(a.saveAria2Config(),a.hideAria2Config(),p.success("保存成功"))};return(x,c)=>{const I=ke,C=Ie,h=ye,s=Fe,o=Se,d=Le;return pe(),Ce(d,{visible:L(v),"onUpdate:visible":c[3]||(c[3]=i=>he(v)?v.value=i:null),header:"Aria2配置调整",footer:!1},{default:y(()=>[u(o,{data:L(_),rules:w,onSubmit:t},{default:y(()=>[u(C,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:y(()=>[u(I,{modelValue:L(_).host,"onUpdate:modelValue":c[0]||(c[0]=i=>L(_).host=i)},null,8,["modelValue"])]),_:1}),u(C,{label:"密钥",name:"token"},{default:y(()=>[u(I,{modelValue:L(_).token,"onUpdate:modelValue":c[1]||(c[1]=i=>L(_).token=i)},null,8,["modelValue"])]),_:1}),u(C,{label:"保存路径",name:"dir"},{default:y(()=>[u(I,{modelValue:L(_).dir,"onUpdate:modelValue":c[2]||(c[2]=i=>L(_).dir=i)},null,8,["modelValue"])]),_:1}),u(C,null,{default:y(()=>[u(s,{size:"small"},{default:y(()=>[u(h,{theme:"default",onClick:L(a).hideAria2Config},{default:y(()=>c[4]||(c[4]=[G(" 取消 ")])),_:1},8,["onClick"]),u(h,{onClick:L(a).getAria2Version},{default:y(()=>c[5]||(c[5]=[G(" 测试连接 ")])),_:1},8,["onClick"]),u(h,{type:"submit"},{default:y(()=>c[6]||(c[6]=[G(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{Te as A,Ee as _,Re as a,Ne as u};
