import{y as R,n as te,r as z,M as U,d as I,s as E,o as V,a as C,e as o,f as e,g as l,j as r,i as $,m as le,x as oe,h as J,k as ne,l as ae,F as h,t as j}from"./index-C5Ad9MSy.js";import{G as N,f as L,b as ie}from"./format-e7SM1IWF.js";import{u as se}from"./useCommonStore-Cfv4cazC.js";import{O as Q,S as W,T as ue}from"./index-DPtkb5ky.js";import{F as M,a as G}from"./index-BpxvjsB1.js";import{I as O,B as x,S as B,C as de}from"./index-CvhmcSF0.js";import{I as X}from"./index-jGaOwCMB.js";import{D as Y}from"./index-Dk0M-TCo.js";import{V as re,D as me}from"./validates-B9d1I_ap.js";import{S as Z}from"./index-BtBTjCXx.js";import{L as pe,c as _e,a as ce}from"./copy-Bqw30Ro0.js";import{T as fe}from"./index-DFRX6niQ.js";import{D as ge,a as ke}from"./index-C4FAuRnB.js";import{T as be}from"./index-P-UOnfMN.js";import"./dep-b315df3e-BM3NQ3bZ.js";import"./fake-arrow-CoNNSefR.js";import"./useResizeObserver-J7s6DlTb.js";import"./add-rWhgnYzd.js";import"./useVirtualScrollNew-B5_qSfcF.js";import"./dep-0df090f8-DUI5xG0U.js";import"./helper-lmZs_t81.js";const ve=k=>R.request("get","/admin/token",{params:k}),ye=k=>R.request("post","/admin/token",{data:k}),H=k=>R.request("patch","/admin/token",{data:k}),we=k=>R.request("delete","/admin/token",{data:k}),F=te("tokens",()=>{const[k,s,_,n]=se(ve),g=z([]),D=q=>{g.value=q},v=z(!1),a=()=>v.value=!0,t=()=>v.value=!1,u=z({count:100,size:1e3,day:100,can_use_ip_count:5,type:"generate",generate_count:10}),i=async()=>{await ye({...u.value,size:u.value.size*N}),U.success("添加成功"),await n()},m=z(!1),f=()=>m.value=!0,y=()=>m.value=!1,w=z({id:[],switch:!0,reason:"手动操作"}),S=async()=>{if(g.value.length===0)return U.error("请选择卡密");await H({...w.value,id:g.value}),U.success(`${w.value.switch?"启用":"禁用"}成功`),await n()},b=async()=>{if(g.value.length===0)return U.error("请选择卡密");await we({id:g.value}),U.success("删除成功"),await n()},d=z(!1),c=z({id:[],count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0});return{tokenList:_,pagination:s,selectReq:k,getTokens:n,selectedRowKeys:g,handleSelectChange:D,isAddingToken:v,showAddingTokenDialog:a,hideAddingTokenDialog:t,addingTokenReq:u,addToken:i,isUpdateSwitchDialog:m,showUpdateSwitchDialog:f,hideUpdateSwitchDialog:y,updateSwitchReq:w,updateSwitchSelection:S,deleteSelection:b,isEditDialog:d,updateReq:c,showEditDialog:(q,P)=>{if(q&&P?(q.stopPropagation(),c.value.id=[P]):c.value={id:g.value,count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0},c.value.id.length===1){const A=_.value.find(ee=>ee.id===c.value.id[0]);A&&(c.value={...A,size:A.size/N,id:c.value.id})}d.value=!0},hideEditDialog:()=>d.value=!1,updateSelection:async()=>{if(c.value.id.length===0)return U.error("请选择卡密");await H({...c.value,size:(c.value.size??0)*N,token:c.value.id.length===1&&c.value.token==="guest"?void 0:c.value.token}),U.success("更新成功~"),await n()}}}),Ve=I({__name:"AddToken",setup(k){const s=F(),{isAddingToken:_,addingTokenReq:n}=E(s),g={token:[{required:!0,message:"卡密不能为空"}],generate_count:[{required:!0,message:"生成数量不能为空"}],count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},D=async({validateResult:v})=>{v===!0&&(await s.addToken(),s.hideAddingTokenDialog())};return(v,a)=>{const t=Q,u=W,i=M,m=O,f=X,y=x,w=B,S=G,b=Y;return V(),C(b,{visible:l(_),"onUpdate:visible":a[7]||(a[7]=d=>$(_)?_.value=d:null),header:"添加卡密",footer:!1},{default:o(()=>[e(S,{onSubmit:D,data:l(n),rules:g},{default:o(()=>[e(i,{name:"type",label:"添加方式"},{default:o(()=>[e(u,{modelValue:l(n).type,"onUpdate:modelValue":a[0]||(a[0]=d=>l(n).type=d)},{default:o(()=>[e(t,{label:"手动添加",value:"set"}),e(t,{label:"自动添加",value:"generate"})]),_:1},8,["modelValue"])]),_:1}),l(n).type==="set"?(V(),C(i,{key:0,name:"token",label:"卡密"},{default:o(()=>[e(m,{modelValue:l(n).token,"onUpdate:modelValue":a[1]||(a[1]=d=>l(n).token=d)},null,8,["modelValue"])]),_:1})):(V(),C(i,{key:1,name:"generate_count",label:"生成数量"},{default:o(()=>[e(f,{min:1,modelValue:l(n).generate_count,"onUpdate:modelValue":a[2]||(a[2]=d=>l(n).generate_count=d)},null,8,["modelValue"])]),_:1})),e(i,{name:"count",label:"次数配额"},{default:o(()=>[e(f,{min:1,modelValue:l(n).count,"onUpdate:modelValue":a[3]||(a[3]=d=>l(n).count=d)},null,8,["modelValue"])]),_:1}),e(i,{name:"size",label:"大小配额(GB)"},{default:o(()=>[e(f,{min:1,modelValue:l(n).size,"onUpdate:modelValue":a[4]||(a[4]=d=>l(n).size=d)},null,8,["modelValue"])]),_:1}),e(i,{name:"day",label:"时间配额"},{default:o(()=>[e(f,{min:1,modelValue:l(n).day,"onUpdate:modelValue":a[5]||(a[5]=d=>l(n).day=d)},null,8,["modelValue"])]),_:1}),e(i,{name:"can_use_ip_count",label:"IP配额"},{default:o(()=>[e(f,{min:1,modelValue:l(n).can_use_ip_count,"onUpdate:modelValue":a[6]||(a[6]=d=>l(n).can_use_ip_count=d)},null,8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(w,{size:"small"},{default:o(()=>[e(y,{theme:"default",onClick:l(s).hideUpdateSwitchDialog},{default:o(()=>a[8]||(a[8]=[r(" 取消 ")])),_:1},8,["onClick"]),e(y,{type:"submit"},{default:o(()=>a[9]||(a[9]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),Se=I({__name:"UpdateToken",setup(k){const s=F(),{isEditDialog:_,updateReq:n}=E(s),g={count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},D=async({validateResult:a})=>{a===!0&&(await s.updateSelection(),s.hideEditDialog())},v=(a,t)=>{if(!(!t.item||typeof t.item=="number")){if(!re(t.item)){U.error("请输入正确的 ip 地址");return}n.value.ip=a}};return(a,t)=>{const u=O,i=M,m=X,f=ue,y=me,w=Z,S=x,b=B,d=G,c=Y;return V(),C(c,{visible:l(_),"onUpdate:visible":t[8]||(t[8]=p=>$(_)?_.value=p:null),header:"更新卡密",footer:!1},{default:o(()=>[e(d,{onSubmit:D,data:l(n),rules:g},{default:o(()=>[l(n).id.length===1&&l(n).token!=="guest"?(V(),C(i,{key:0,name:"token",label:"卡密"},{default:o(()=>[e(u,{modelValue:l(n).token,"onUpdate:modelValue":t[0]||(t[0]=p=>l(n).token=p)},null,8,["modelValue"])]),_:1})):le("",!0),e(i,{name:"count",label:"次数配额"},{default:o(()=>[e(m,{min:1,modelValue:l(n).count,"onUpdate:modelValue":t[1]||(t[1]=p=>l(n).count=p)},null,8,["modelValue"])]),_:1}),e(i,{name:"size",label:"大小配额(GB)"},{default:o(()=>[e(m,{min:1,modelValue:l(n).size,"onUpdate:modelValue":t[2]||(t[2]=p=>l(n).size=p)},null,8,["modelValue"])]),_:1}),e(i,{name:"day",label:"时间配额"},{default:o(()=>[e(m,{min:1,modelValue:l(n).day,"onUpdate:modelValue":t[3]||(t[3]=p=>l(n).day=p)},null,8,["modelValue"])]),_:1}),e(i,{name:"can_use_ip_count",label:"IP配额"},{default:o(()=>[e(m,{min:1,modelValue:l(n).can_use_ip_count,"onUpdate:modelValue":t[4]||(t[4]=p=>l(n).can_use_ip_count=p)},null,8,["modelValue"])]),_:1}),e(i,{name:"ip",label:"已绑IP",help:"回车添加"},{default:o(()=>[e(f,{value:l(n).ip,onChange:v},null,8,["value"])]),_:1}),e(i,{name:"expires_at",label:"过期时间"},{default:o(()=>[e(y,{modelValue:l(n).expires_at,"onUpdate:modelValue":t[5]||(t[5]=p=>l(n).expires_at=p),"enable-time-picker":"","allow-input":"",clearable:"",format:"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue"])]),_:1}),e(i,{name:"switch",label:"启用"},{default:o(()=>[e(w,{modelValue:l(n).switch,"onUpdate:modelValue":t[6]||(t[6]=p=>l(n).switch=p)},null,8,["modelValue"])]),_:1}),e(i,{name:"reason",label:"原因"},{default:o(()=>[e(u,{modelValue:l(n).reason,"onUpdate:modelValue":t[7]||(t[7]=p=>l(n).reason=p)},null,8,["modelValue"])]),_:1}),e(i,{label:"选中的卡密"},{default:o(()=>[e(u,{value:JSON.stringify(l(n).id),disabled:""},null,8,["value"])]),_:1}),e(i,null,{default:o(()=>[e(b,{size:"small"},{default:o(()=>[e(S,{theme:"default",onClick:l(s).hideEditDialog},{default:o(()=>t[9]||(t[9]=[r(" 取消 ")])),_:1},8,["onClick"]),e(S,{type:"submit"},{default:o(()=>t[10]||(t[10]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),Ce=I({__name:"UpdateSwitch",setup(k){const s=F(),{isUpdateSwitchDialog:_,updateSwitchReq:n,selectedRowKeys:g}=E(s),D={},v=async({validateResult:a})=>{a===!0&&(await s.updateSwitchSelection(),s.hideUpdateSwitchDialog())};return(a,t)=>{const u=Z,i=M,m=O,f=x,y=B,w=G,S=Y;return V(),C(S,{visible:l(_),"onUpdate:visible":t[2]||(t[2]=b=>$(_)?_.value=b:null),header:"启用/禁用卡密",footer:!1},{default:o(()=>[e(w,{onSubmit:v,data:l(n),rules:D},{default:o(()=>[e(i,{label:"启用",name:"switch"},{default:o(()=>[e(u,{modelValue:l(n).switch,"onUpdate:modelValue":t[0]||(t[0]=b=>l(n).switch=b)},null,8,["modelValue"])]),_:1}),e(i,{label:"原因",name:"reason"},{default:o(()=>[e(m,{modelValue:l(n).reason,"onUpdate:modelValue":t[1]||(t[1]=b=>l(n).reason=b)},null,8,["modelValue"])]),_:1}),e(i,{label:"选中的账号"},{default:o(()=>[e(m,{value:JSON.stringify(l(g)),disabled:""},null,8,["value"])]),_:1}),e(i,null,{default:o(()=>[e(y,{size:"small"},{default:o(()=>[e(f,{theme:"default",onClick:l(s).hideUpdateSwitchDialog},{default:o(()=>t[3]||(t[3]=[r(" 取消 ")])),_:1},8,["onClick"]),e(f,{type:"submit"},{default:o(()=>t[4]||(t[4]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),De={class:"buttons"},Je=I({__name:"index",setup(k){const s=F(),{selectReq:_,tokenList:n,pagination:g,selectedRowKeys:D}=E(s);oe(s.getTokens);const v=z([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID"},{colKey:"token",title:"卡密",width:200,ellipsis:!0},{colKey:"switch",title:"状态",cell:(a,{row:t})=>e(h,null,[t.switch?"启用":`禁用 (${t.reason})`]),ellipsis:!0},{colKey:"today_count",title:"今日解析",cell:(a,{row:t})=>e(h,null,[t.today_count,r(" ("),L(t.today_size??0),r(")")]),width:150,ellipsis:!0},{colKey:"total_count",title:"总计解析",cell:(a,{row:t})=>e(h,null,[t.total_count,r(" ("),L(t.total_size??0),r(")")]),width:150,ellipsis:!0},{colKey:"size",title:"大小配额",cell:(a,{row:t})=>e(h,null,[L(t.size)]),width:90,ellipsis:!0},{colKey:"count",title:"次数配额",cell:(a,{row:t})=>e(h,null,[t.count,r(" 次")]),width:90,ellipsis:!0},{colKey:"day",title:"时间配额",cell:(a,{row:t})=>e(h,null,[t.day,r(" 天")]),width:90,ellipsis:!0},{colKey:"can_use_ip_count",title:"IP配额",cell:(a,{row:t})=>e(h,null,[t.can_use_ip_count,r(" 个")]),ellipsis:!0},{colKey:"expires_at",title:"过期时间",cell:(a,{row:t})=>e(h,null,[t.expires_at===null?"未使用":ie(t.expires_at)]),width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(a,{row:t})=>e(x,{theme:"primary",onClick:u=>s.showEditDialog(u,t.id)},{default:()=>[r("编辑")]}),width:90,fixed:"right"}]);return(a,t)=>{const u=Q,i=W,m=x,f=B,y=fe,w=ce,S=pe,b=ge,d=ke,c=be,p=de;return V(),C(p,null,{default:o(()=>[J("div",De,[e(f,{size:"small"},{default:o(()=>[e(i,{modelValue:l(_).column,"onUpdate:modelValue":t[0]||(t[0]=T=>l(_).column=T),onChange:l(s).getTokens},{default:o(()=>[e(u,{label:"按 id 排序",value:"id"}),e(u,{label:"按 token 排序",value:"token"}),e(u,{label:"按 count 排序",value:"count"}),e(u,{label:"按 size 排序",value:"size"}),e(u,{label:"按 day 排序",value:"day"}),e(u,{label:"按 can_use_ip_count 排序",value:"can_use_ip_count"}),e(u,{label:"按 ip 排序",value:"ip"}),e(u,{label:"按 expires_at 排序",value:"expires_at"}),e(u,{label:"按 created_at 排序",value:"created_at"}),e(u,{label:"按 updated_at 排序",value:"updated_at"}),e(u,{label:"按 deleted_at 排序",value:"deleted_at"})]),_:1},8,["modelValue","onChange"]),e(i,{modelValue:l(_).direction,"onUpdate:modelValue":t[1]||(t[1]=T=>l(_).direction=T),onChange:l(s).getTokens},{default:o(()=>[e(u,{label:"正序",value:"asc"}),e(u,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(m,{onClick:l(s).getTokens},{default:o(()=>t[2]||(t[2]=[r(" 刷新列表 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).showAddingTokenDialog},{default:o(()=>t[3]||(t[3]=[r(" 添加卡密 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).deleteSelection},{default:o(()=>t[4]||(t[4]=[r(" 批量删除 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).showUpdateSwitchDialog},{default:o(()=>t[5]||(t[5]=[r(" 批量启用/禁用 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).showEditDialog},{default:o(()=>t[6]||(t[6]=[r(" 批量更新 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).showEditDialog},{default:o(()=>t[7]||(t[7]=[r(" 批量复制 ")])),_:1},8,["onClick"])]),_:1})]),e(Ve),e(Ce),e(Se),e(c,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(n),pagination:l(g),columns:v.value,"select-on-row-click":!0,selectedRowKeys:l(D),onSelectChange:l(s).handleSelectChange},{expandedRow:o(({row:T})=>[e(d,{bordered:"",colon:"",layout:"vertical"},{default:o(()=>[e(b,{label:"已绑定的ip"},{default:o(()=>[T.ip.length===0?(V(),C(y,{key:0,size:"large"},{default:o(()=>t[8]||(t[8]=[r(" 没有绑定的IP ")])),_:1})):(V(),C(S,{key:1,stripe:"",split:"",size:"large"},{default:o(()=>[(V(!0),ne(h,null,ae(T.ip,(K,q)=>(V(),C(w,{key:K},{default:o(()=>[e(f,{direction:"vertical"},{default:o(()=>[e(f,null,{default:o(()=>[e(y,{size:"large"},{default:o(()=>[r(" 第 "+j(q+1)+" 条 ",1)]),_:2},1024),e(m,{onClick:P=>l(_e)(K)},{default:o(()=>t[9]||(t[9]=[r("复制")])),_:2},1032,["onClick"])]),_:2},1024),J("p",null,j(K),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{Je as default};
