import{E as R,G as B,h as t,H as q,d as L,I as G,J as W,K as X,L as j,N as z,O as K,P as Q,Q as Y,b as F,A as P,R as Z,S as ee,T as ne,U as ae,V as oe,W as le,X as te,Y as re,Z as ie,v as se,M as y,s as ce,o as ue,e as de,g as C,i as m,m as w,j as fe,B as ve,$ as Ce}from"./index-BJn9XbFk.js";import{I as me,S as ge}from"./index-1apc2-bA.js";import{F as pe,a as _e}from"./index-CV8xjUnp.js";/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */function he(){var d=q();return function(u,c){var v;if(R(d.props[u]))v=d.props[u](B);else if(d.slots[u])v=d.slots[u]&&d.slots[u](null)[0];else if(c){var a=c[d.props.theme];v=t(a,null,null)}return v}}/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Ie={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(e){return["success","info","warning","error"].includes(e)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Fe=L({name:"TAlert",props:Ie,setup:function(e){var u=G("alert"),c=u.globalConfig,v=u.classPrefix,a=W({CheckCircleFilledIcon:X,CloseIcon:j,ErrorCircleFilledIcon:z,HelpCircleFilledIcon:K,InfoCircleFilledIcon:Q}),S=a.CheckCircleFilledIcon,r=a.CloseIcon,_=a.ErrorCircleFilledIcon,g=a.HelpCircleFilledIcon,k=a.InfoCircleFilledIcon,o=Y("alert"),i=re(),f=he(),s=F(null),h=F(null),b=F(0),x=F(!0),p=F(!0),U=function(){var n={info:k,success:S,warning:_,error:_,question:g},l=f("icon",n);return l?t("div",{class:"".concat(o.value,"__icon")},[l]):null},H=function(){var n=e.close,l=null;return n===!0||n===""?l=t(r,null,null):oe(n)?l=n:l=f("close"),l?t("div",{class:"".concat(o.value,"__close"),onClick:M},[l]):null},O=function(){var n=i("title");return n?t("div",{class:"".concat(o.value,"__title")},[" ",n]):null},$=function(){var n=i("operation");return t("div",{class:"".concat(o.value,"__message")},[D(),n?t("div",{class:"".concat(o.value,"__operation")},[n]):null])},D=function(){var n,l;l=i("default"),l||(l=i("message"));var A=te(l)?l.length:1,N=e.maxLine>0&&e.maxLine<A,V=(n=h.value)===null||n===void 0||(n=n.children[0])===null||n===void 0?void 0:n.offsetHeight;return N&&p.value?(l=l.slice(0,e.maxLine),V&&(h.value.style.height="".concat(b.value,"px"))):N&&V&&(h.value.style.height="".concat(V*(A-e.maxLine)+b.value,"px")),t("div",{class:"".concat(o.value,"__description"),ref:h},[N?l.map(function(E){return t("div",null,[E])}):l,N?t("div",{class:"".concat(o.value,"__collapse"),onClick:function(){p.value=!p.value}},[p.value?c.value.expandText:c.value.collapseText]):null])},J=function(){return t("div",{class:"".concat(o.value,"__content")},[O(),$()])},M=function(n){var l;(l=e.onClose)===null||l===void 0||l.call(e,{e:n}),le(s.value,"".concat(o.value,"--closing"))},T=function(n){var l=n.target===s.value;if(n.propertyName==="opacity"&&l){var A;x.value=!1,(A=e.onClosed)===null||A===void 0||A.call(e,{e:n})}};return P(function(){Z(s.value,"transitionend",T),b.value=h.value.offsetHeight}),ee(function(){ne(s.value,"transitionend",T)}),function(){return t("div",{ref:s,class:["".concat(o.value),"".concat(o.value,"--").concat(e.theme),ae({},"".concat(v.value,"-is-hidden"),!x.value)]},[U(),J(),H()])}}});/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var ye=ie(Fe);const Se=se("aria2Store",()=>{const d=F(!1),e=F({host:"http://localhost:16800/jsonrpc",token:"",dir:""});P(()=>{const o=localStorage.getItem("aria2Config");o&&(e.value=JSON.parse(o))});const u=()=>d.value=!0,c=()=>d.value=!1,v=()=>localStorage.setItem("aria2Config",JSON.stringify(e.value));let a=null;const S=()=>new Promise((o,i)=>{a&&(a.close(),a=null);try{a=new WebSocket(e.value.host),a.onopen=()=>o(a),a.onerror=f=>{y.error("链接到Aria2下载器出错"),i(f)}}catch(f){y.error("链接到Aria2下载器出错"),i(f)}}),r=async(o,i=[])=>((!a||a.readyState!==WebSocket.OPEN)&&(a=await S()),new Promise((f,s)=>{a=a;const h="HkList"+Date.now().toString(),b={jsonrpc:"2.0",method:o,id:h,params:[`token:${e.value.token}`,...i]};a.onmessage=x=>{const p=JSON.parse(x.data);p.id===h&&(p.error?s(p.error):f(p.result))},a.send(JSON.stringify(b))})),_=async()=>{await r("aria2.getVersion"),y.success("测试连接成功")},g=async(o,i,f,s)=>{await r("aria2.addUri",[[o],{out:i,dir:e.value.dir===""?null:e.value.dir,header:[`User-Agent: ${f}`],split:s.toString()}]),y.success("添加链接成功")};return{aria2ConfigDialogVisible:d,showAria2Config:u,hideAria2Config:c,aria2ConfigForm:e,saveAria2Config:v,getAria2Version:_,addAria2Url:g,downloadLinks:o=>{o.forEach(i=>g(i.urls[0],i.filename,i.ua,16))}}}),xe=L({__name:"Aria2Dialog",setup(d){const e=Se(),{aria2ConfigDialogVisible:u,aria2ConfigForm:c}=ce(e),v={},a=async({validateResult:S})=>{S===!0&&(e.saveAria2Config(),e.hideAria2Config(),y.success("保存成功"))};return(S,r)=>{const _=me,g=pe,k=ve,o=ge,i=_e,f=Ce;return ue(),de(f,{visible:m(u),"onUpdate:visible":r[3]||(r[3]=s=>fe(u)?u.value=s:null),header:"Aria2配置调整",footer:!1},{default:C(()=>[t(i,{data:m(c),rules:v,onSubmit:a},{default:C(()=>[t(g,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:C(()=>[t(_,{modelValue:m(c).host,"onUpdate:modelValue":r[0]||(r[0]=s=>m(c).host=s)},null,8,["modelValue"])]),_:1}),t(g,{label:"密钥",name:"token"},{default:C(()=>[t(_,{modelValue:m(c).token,"onUpdate:modelValue":r[1]||(r[1]=s=>m(c).token=s)},null,8,["modelValue"])]),_:1}),t(g,{label:"保存路径",name:"dir"},{default:C(()=>[t(_,{modelValue:m(c).dir,"onUpdate:modelValue":r[2]||(r[2]=s=>m(c).dir=s)},null,8,["modelValue"])]),_:1}),t(g,null,{default:C(()=>[t(o,{size:"small"},{default:C(()=>[t(k,{theme:"default",onClick:m(e).hideAria2Config},{default:C(()=>r[4]||(r[4]=[w(" 取消 ")])),_:1},8,["onClick"]),t(k,{onClick:m(e).getAria2Version},{default:C(()=>r[5]||(r[5]=[w(" 测试连接 ")])),_:1},8,["onClick"]),t(k,{type:"submit"},{default:C(()=>r[6]||(r[6]=[w(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{ye as A,xe as _,Se as u};
