import{y as R,z as $,e as t,A as q,d as P,B as G,C as z,D as W,E as X,G as j,H as K,I as Q,J as Y,r as F,v as D,K as Z,L as ee,N as ne,_ as ae,O as oe,P as le,Q as te,R as re,S as ie,l as se,M as y,s as ce,o as ue,a as de,b as C,f as m,g as V,T as fe}from"./index-OaYvTeRJ.js";import{I as ve,S as Ce}from"./index-D961EtPV.js";import{F as me,a as ge}from"./index-y_SPXcip.js";import{B as pe}from"./useResizeObserver-CBtsOIQO.js";import{D as _e}from"./index-BRgs09Pu.js";/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */function Ie(){var d=q();return function(u,c){var v;if(R(d.props[u]))v=d.props[u]($);else if(d.slots[u])v=d.slots[u]&&d.slots[u](null)[0];else if(c){var n=c[d.props.theme];v=t(n,null,null)}return v}}/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var he={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(e){return["success","info","warning","error"].includes(e)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var Fe=P({name:"TAlert",props:he,setup:function(e){var u=G("alert"),c=u.globalConfig,v=u.classPrefix,n=z({CheckCircleFilledIcon:W,CloseIcon:X,ErrorCircleFilledIcon:j,HelpCircleFilledIcon:K,InfoCircleFilledIcon:Q}),S=n.CheckCircleFilledIcon,r=n.CloseIcon,_=n.ErrorCircleFilledIcon,g=n.HelpCircleFilledIcon,k=n.InfoCircleFilledIcon,o=Y("alert"),i=re(),f=Ie(),s=F(null),I=F(null),b=F(0),w=F(!0),p=F(!0),E=function(){var a={info:k,success:S,warning:_,error:_,question:g},l=f("icon",a);return l?t("div",{class:"".concat(o.value,"__icon")},[l]):null},H=function(){var a=e.close,l=null;return a===!0||a===""?l=t(r,null,null):oe(a)?l=a:l=f("close"),l?t("div",{class:"".concat(o.value,"__close"),onClick:M},[l]):null},O=function(){var a=i("title");return a?t("div",{class:"".concat(o.value,"__title")},[" ",a]):null},U=function(){var a=i("operation");return t("div",{class:"".concat(o.value,"__message")},[B(),a?t("div",{class:"".concat(o.value,"__operation")},[a]):null])},B=function(){var a,l;l=i("default"),l||(l=i("message"));var A=te(l)?l.length:1,x=e.maxLine>0&&e.maxLine<A,N=(a=I.value)===null||a===void 0||(a=a.children[0])===null||a===void 0?void 0:a.offsetHeight;return x&&p.value?(l=l.slice(0,e.maxLine),N&&(I.value.style.height="".concat(b.value,"px"))):x&&N&&(I.value.style.height="".concat(N*(A-e.maxLine)+b.value,"px")),t("div",{class:"".concat(o.value,"__description"),ref:I},[x?l.map(function(L){return t("div",null,[L])}):l,x?t("div",{class:"".concat(o.value,"__collapse"),onClick:function(){p.value=!p.value}},[p.value?c.value.expandText:c.value.collapseText]):null])},J=function(){return t("div",{class:"".concat(o.value,"__content")},[O(),U()])},M=function(a){var l;(l=e.onClose)===null||l===void 0||l.call(e,{e:a}),le(s.value,"".concat(o.value,"--closing"))},T=function(a){var l=a.target===s.value;if(a.propertyName==="opacity"&&l){var A;w.value=!1,(A=e.onClosed)===null||A===void 0||A.call(e,{e:a})}};return D(function(){Z(s.value,"transitionend",T),b.value=I.value.offsetHeight}),ee(function(){ne(s.value,"transitionend",T)}),function(){return t("div",{ref:s,class:["".concat(o.value),"".concat(o.value,"--").concat(e.theme),ae({},"".concat(v.value,"-is-hidden"),!w.value)]},[E(),J(),H()])}}});/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var xe=ie(Fe);const Se=se("aria2",()=>{const d=F(!1),e=F({host:"ws://localhost:16800/jsonrpc",token:"",dir:""});D(()=>{const o=localStorage.getItem("aria2Config");o&&(e.value=JSON.parse(o))});const u=()=>d.value=!0,c=()=>d.value=!1,v=()=>{localStorage.setItem("aria2Config",JSON.stringify(e.value)),n=null};let n=null;const S=()=>new Promise((o,i)=>{n&&(n.close(),n=null);try{n=new WebSocket(e.value.host),n.onopen=()=>o(n),n.onerror=f=>{y.error("链接到Aria2下载器出错"),i(f)}}catch(f){y.error("链接到Aria2下载器出错"),i(f)}}),r=async(o,i=[])=>((!n||n.readyState!==WebSocket.OPEN)&&(n=await S()),new Promise((f,s)=>{n=n;const I="HkList"+Date.now().toString(),b={jsonrpc:"2.0",method:o,id:I,params:[`token:${e.value.token}`,...i]};n.onmessage=w=>{const p=JSON.parse(w.data);p.id===I&&(p.error?s(p.error):f(p.result))},n.send(JSON.stringify(b))})),_=async()=>{await r("aria2.getVersion"),y.success("测试连接成功")},g=async(o,i,f,s)=>{await r("aria2.addUri",[[o],{out:i,dir:e.value.dir===""?null:e.value.dir,header:[`User-Agent: ${f}`],split:s.toString()}]),y.success("添加链接成功")};return{aria2ConfigDialogVisible:d,showAria2Config:u,hideAria2Config:c,aria2ConfigForm:e,saveAria2Config:v,getAria2Version:_,addAria2Url:g,downloadLinks:async o=>{for(const i of o)await g(i.urls[0],i.filename,i.ua,16)}}}),Ne=P({__name:"Aria2Dialog",setup(d){const e=Se(),{aria2ConfigDialogVisible:u,aria2ConfigForm:c}=ce(e),v={},n=async({validateResult:S})=>{S===!0&&(e.saveAria2Config(),e.hideAria2Config(),y.success("保存成功"))};return(S,r)=>{const _=ve,g=me,k=pe,o=Ce,i=ge,f=_e;return ue(),de(f,{visible:m(u),"onUpdate:visible":r[3]||(r[3]=s=>fe(u)?u.value=s:null),header:"Aria2配置调整",footer:!1},{default:C(()=>[t(i,{data:m(c),rules:v,onSubmit:n},{default:C(()=>[t(g,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:C(()=>[t(_,{modelValue:m(c).host,"onUpdate:modelValue":r[0]||(r[0]=s=>m(c).host=s)},null,8,["modelValue"])]),_:1}),t(g,{label:"密钥",name:"token"},{default:C(()=>[t(_,{modelValue:m(c).token,"onUpdate:modelValue":r[1]||(r[1]=s=>m(c).token=s)},null,8,["modelValue"])]),_:1}),t(g,{label:"保存路径",name:"dir"},{default:C(()=>[t(_,{modelValue:m(c).dir,"onUpdate:modelValue":r[2]||(r[2]=s=>m(c).dir=s)},null,8,["modelValue"])]),_:1}),t(g,null,{default:C(()=>[t(o,{size:"small"},{default:C(()=>[t(k,{theme:"default",onClick:m(e).hideAria2Config},{default:C(()=>r[4]||(r[4]=[V(" 取消 ")])),_:1},8,["onClick"]),t(k,{onClick:m(e).getAria2Version},{default:C(()=>r[5]||(r[5]=[V(" 测试连接 ")])),_:1},8,["onClick"]),t(k,{type:"submit"},{default:C(()=>r[6]||(r[6]=[V(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{xe as A,Ne as _,Se as u};
