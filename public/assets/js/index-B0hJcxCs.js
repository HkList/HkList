import{p as U,q as G,b as C,M as P,d as E,s as D,a3 as L,e as R,j as t,S as N,f as l,g as e,h as A,k as M,F as K,i as v,o as S,l as Q,n as W,m as X}from"./index-BlUydGuh.js";import{u as Y}from"./useCommonStore-D-2iIUg-.js";import{u as O}from"./accounts-B9i55lBH.js";import{D as $}from"./index-CU4uzVRw.js";import{F as j,a as H}from"./index-CB8fqy6i.js";import{S as F,O as B}from"./index-DmQKD-Vd.js";import{I as z,S as T,C as Z}from"./index-DlzaH1y1.js";import{B as q}from"./useResizeObserver-i89Y8hdt.js";import{S as ee}from"./index-Bqi24OcS.js";import{T as te}from"./index-BOGZtms0.js";import"./format-N3ZSnBhF.js";import"./fake-arrow-DJdQvvgp.js";import"./debounce-C97J7VUq.js";import"./omit-B3YBGMpO.js";import"./index-DnrHboiB.js";import"./dep-7dcc7954-M5d1UZIS.js";import"./index-xmIZzoIh.js";import"./add-C2TwbPrH.js";import"./useVirtualScrollNew-CfxxSUWN.js";const oe={http:"HTTP静态代理",api:"API动态代理",proxy:"中转代理"},le=y=>U.request("get","/admin/proxy",{params:y}),ae=y=>U.request("post","/admin/proxy",{data:y}),ne=y=>U.request("patch","/admin/proxy",{data:y}),se=y=>U.request("delete","/admin/proxy",{data:y}),I=G("proxies",()=>{const[y,s,r,a]=Y(le,()=>{m.value=[],x.value=[]},{keyword:""}),m=C([]),x=C([]),k=(w,d)=>{m.value=w,x.value=d.selectedRowData},_=C(!1),n=()=>_.value=!0,u=()=>{_.value=!1,o.value={type:"proxy",proxy:"",account_id:void 0}},o=C({type:"proxy",proxy:"",account_id:void 0}),b=async()=>{await ae(o.value),P.success("添加成功"),await a()},p=async()=>{if(m.value.length===0)return P.error("请选择代理");await se({id:m.value}),m.value=[],P.success("删除成功"),await a()},f=C(!1),c=C({id:[],enable:!0,reason:"",type:"proxy",proxy:""});return{proxyList:r,pagination:s,selectReq:y,getProxies:a,selectedRowKeys:m,handleSelectChange:k,isAddingProxy:_,showAddingProxyDialog:n,hideAddingProxyDialog:u,addProxyReq:o,addProxy:b,isEditDialog:f,updateReq:c,showEditDialog:(w,d)=>{if(w&&d?(w.stopPropagation(),c.value.id=[d]):c.value={id:m.value,enable:!0,reason:""},c.value.id.length===1){const i=r.value.find(J=>J.id===c.value.id[0]);i&&(c.value={id:[i.id],enable:i.enable,reason:i.reason,type:i.type,proxy:i.proxy,account_id:i.account_id})}f.value=!0},hideEditDialog:()=>f.value=!1,updateSelection:async()=>{if(c.value.id.length===0)return P.error("请选择卡密");await ne(c.value),P.success("更新成功~"),await a()},deleteSelection:p}}),ie=E({__name:"AddProxy",setup(y){const s=I(),{isAddingProxy:r,addProxyReq:a}=D(s),m=O(),{accountList:x,selectReq:k}=D(m);k.value.size=9999,m.getAccounts(),L(()=>{x.value=[]});const _={type:[{required:!0,message:"请选择代理类型"}],proxy:[{required:!0,message:"请输入代理信息"}],account_id:[{required:!0,message:"请选择账号"}]},n=async({validateResult:u})=>{u===!0&&(await s.addProxy(),s.hideAddingProxyDialog())};return(u,o)=>{const b=B,p=F,f=H,c=z,V=q,g=T,h=j,w=$;return S(),R(w,{visible:t(r),"onUpdate:visible":o[3]||(o[3]=d=>N(r)?r.value=d:null),header:"添加代理",footer:!1},{default:l(()=>[e(h,{onSubmit:n,data:t(a),rules:_},{default:l(()=>[e(f,{name:"type",label:"代理类型"},{default:l(()=>[e(p,{modelValue:t(a).type,"onUpdate:modelValue":o[0]||(o[0]=d=>t(a).type=d)},{default:l(()=>[e(b,{label:"中转代理",value:"proxy"})]),_:1},8,["modelValue"])]),_:1}),e(f,{name:"proxy",label:"代理信息",help:"格式<host@password>例如:<http://a.com@hklist>"},{default:l(()=>[e(c,{modelValue:t(a).proxy,"onUpdate:modelValue":o[1]||(o[1]=d=>t(a).proxy=d)},null,8,["modelValue"])]),_:1}),e(f,{name:"account_id",label:"账号"},{default:l(()=>[e(p,{modelValue:t(a).account_id,"onUpdate:modelValue":o[2]||(o[2]=d=>t(a).account_id=d)},{default:l(()=>[(S(!0),A(K,null,M(t(x),d=>(S(),R(b,{key:d.id,label:d.baidu_name,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(g,{size:"small"},{default:l(()=>[e(V,{theme:"default",onClick:t(s).hideAddingProxyDialog},{default:l(()=>o[4]||(o[4]=[v(" 取消 ")])),_:1},8,["onClick"]),e(V,{type:"submit"},{default:l(()=>o[5]||(o[5]=[v(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ue=E({__name:"UpdateProxy",setup(y){const s=I(),{isEditDialog:r,updateReq:a}=D(s),m=O(),{accountList:x,selectReq:k}=D(m);k.value.size=9999,m.getAccounts(),L(()=>{x.value=[]});const _={},n=async({validateResult:u})=>{u===!0&&(await s.updateSelection(),s.hideEditDialog())};return(u,o)=>{const b=z,p=H,f=ee,c=B,V=F,g=q,h=T,w=j,d=$;return S(),R(d,{visible:t(r),"onUpdate:visible":o[5]||(o[5]=i=>N(r)?r.value=i:null),header:"更新代理",footer:!1},{default:l(()=>[e(w,{onSubmit:n,data:t(a),rules:_},{default:l(()=>[e(p,{label:"选中的代理"},{default:l(()=>[e(b,{value:JSON.stringify(t(a).id),disabled:""},null,8,["value"])]),_:1}),e(p,{name:"enable",label:"启用"},{default:l(()=>[e(f,{modelValue:t(a).enable,"onUpdate:modelValue":o[0]||(o[0]=i=>t(a).enable=i)},null,8,["modelValue"])]),_:1}),e(p,{name:"reason",label:"原因"},{default:l(()=>[e(b,{modelValue:t(a).reason,"onUpdate:modelValue":o[1]||(o[1]=i=>t(a).reason=i)},null,8,["modelValue"])]),_:1}),t(a).id.length===1?(S(),A(K,{key:0},[e(p,{name:"type",label:"代理类型"},{default:l(()=>[e(V,{modelValue:t(a).type,"onUpdate:modelValue":o[2]||(o[2]=i=>t(a).type=i)},{default:l(()=>[e(c,{label:"中转代理",value:"proxy"})]),_:1},8,["modelValue"])]),_:1}),e(p,{name:"proxy",label:"代理信息",help:"格式<host@password>例如:<http://a.com@hklist>"},{default:l(()=>[e(b,{modelValue:t(a).proxy,"onUpdate:modelValue":o[3]||(o[3]=i=>t(a).proxy=i)},null,8,["modelValue"])]),_:1}),e(p,{name:"account_id",label:"账号"},{default:l(()=>[e(V,{modelValue:t(a).account_id,"onUpdate:modelValue":o[4]||(o[4]=i=>t(a).account_id=i)},{default:l(()=>[(S(!0),A(K,null,M(t(x),i=>(S(),R(c,{key:i.id,label:i.baidu_name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})],64)):Q("",!0),e(p,null,{default:l(()=>[e(h,{size:"small"},{default:l(()=>[e(g,{theme:"default",onClick:t(s).hideEditDialog},{default:l(()=>o[6]||(o[6]=[v(" 取消 ")])),_:1},8,["onClick"]),e(g,{type:"submit"},{default:l(()=>o[7]||(o[7]=[v(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),de={class:"buttons"},he=E({__name:"index",setup(y){const s=I(),{selectReq:r,proxyList:a,pagination:m,selectedRowKeys:x}=D(s);W(s.getProxies);const k=C([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID"},{colKey:"type",title:"代理类型",cell:(_,{row:n})=>_("span",oe[n.type])},{colKey:"proxy",title:"代理信息"},{colKey:"status",title:"状态",cell:(_,{row:n})=>_("span",n.enable?"启用":`禁用(${n.reason})`)},{colKey:"created_at",title:"创建时间",width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(_,{row:n})=>e(q,{theme:"primary",onClick:u=>s.showEditDialog(u,n.id)},{default:()=>[v("编辑")]}),width:90,fixed:"right"}]);return(_,n)=>{const u=B,o=F,b=z,p=q,f=T,c=te,V=Z;return S(),R(V,null,{default:l(()=>[X("div",de,[e(f,{size:"small"},{default:l(()=>[e(o,{modelValue:t(r).column,"onUpdate:modelValue":n[0]||(n[0]=g=>t(r).column=g),onChange:t(s).getProxies},{default:l(()=>[e(u,{label:"按 id 排序",value:"id"}),e(u,{label:"按 type 排序",value:"type"}),e(u,{label:"按 proxy 排序",value:"proxy"}),e(u,{label:"按 enable 排序",value:"enable"}),e(u,{label:"按 reason 排序",value:"reason"}),e(u,{label:"按 created_at 排序",value:"created_at"}),e(u,{label:"按 updated_at 排序",value:"updated_at"})]),_:1},8,["modelValue","onChange"]),e(o,{modelValue:t(r).direction,"onUpdate:modelValue":n[1]||(n[1]=g=>t(r).direction=g),onChange:t(s).getProxies},{default:l(()=>[e(u,{label:"正序",value:"asc"}),e(u,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(b,{modelValue:t(r).keyword,"onUpdate:modelValue":n[2]||(n[2]=g=>t(r).keyword=g),onBlur:t(s).getProxies,placeholder:"请输入需要查询的代理"},null,8,["modelValue","onBlur"]),e(p,{onClick:t(s).getProxies},{default:l(()=>n[3]||(n[3]=[v(" 刷新列表 ")])),_:1},8,["onClick"]),e(p,{onClick:t(s).showAddingProxyDialog},{default:l(()=>n[4]||(n[4]=[v(" 添加代理 ")])),_:1},8,["onClick"]),e(p,{onClick:t(s).deleteSelection},{default:l(()=>n[5]||(n[5]=[v(" 批量删除 ")])),_:1},8,["onClick"]),e(p,{onClick:t(s).showEditDialog},{default:l(()=>n[6]||(n[6]=[v(" 批量编辑 ")])),_:1},8,["onClick"])]),_:1})]),e(ie),e(ue),e(c,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:t(a),pagination:t(m),columns:k.value,"select-on-row-click":!0,selectedRowKeys:t(x),onSelectChange:t(s).handleSelectChange},null,8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{he as default};
