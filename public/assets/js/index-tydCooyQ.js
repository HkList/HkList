import{T as U,O as Y,r as w,R as B,d as x,s as q,o as L,a as I,e as o,f as t,g as l,k as $,F as j,N as E,j as _,i as F,D as J,h as W}from"./index-CXsQrBlN.js";import{u as G}from"./useCommonStore-BszmuRxV.js";import{D as H,V as N}from"./validates-8aMqv2cK.js";import{O as R,S as h}from"./index-B4qoRM2T.js";import{F as P,a as z}from"./index-BPdgWXY4.js";import{I as T,B as S,S as D,C as Q}from"./index-BrMISRL3.js";import{D as M}from"./index-BbWKxUy8.js";import{I as X}from"./index-BXxGOXeh.js";import{T as Z}from"./index-Ca7uAS7r.js";import"./dep-b315df3e-Bhs51j-8.js";import"./useResizeObserver-68q0ST9u.js";import"./fake-arrow-RRoJ920x.js";import"./index-BVzw0HaR.js";import"./add-B9qLOlVE.js";import"./dep-0df090f8-B8El8jRh.js";import"./useVirtualScrollNew-XSuNWHRp.js";import"./helper-DL-Ugjgz.js";const ee=u=>U.request("get","/admin/black_list",{params:u}),te=u=>U.request("post","/admin/black_list",{data:u}),le=u=>U.request("patch","/admin/black_list",{data:u}),ae=u=>U.request("delete","/admin/black_list",{data:u}),K=Y("blackLists",()=>{const[u,n,m,a]=G(ee),r=w([]),y=g=>{r.value=g},V=async()=>{if(r.value.length===0)return B.error("请选择黑名单");await ae({id:r.value}),B.success("删除成功"),await a()},c=w(!1),e=w({id:[],type:void 0,identifier:void 0,reason:"",expires_at:""}),s=(g,i)=>{if(g&&i?(g.stopPropagation(),e.value.id=[i]):e.value={id:r.value,type:void 0,identifier:void 0,reason:"",expires_at:""},e.value.id.length===1){const A=m.value.find(O=>O.id===e.value.id[0]);A&&(e.value={...A,id:e.value.id})}c.value=!0},f=()=>c.value=!1,d=async()=>{if(e.value.id.length===0)return B.error("请选择黑名单");await le({...e.value,id:r.value}),B.success("更新成功"),await a()},p=w(!1),b=w({type:"fingerprint",identifier:"",reason:"",ban_days:10});return{pagination:n,selectReq:u,blackList:m,getBlackLists:a,selectedRowKeys:r,handleSelectChange:y,deleteSelection:V,isUpdate:c,updateReq:e,showUpdateDialog:s,hideUpdateDialog:f,updateSelection:d,isAddBlackList:p,addBlackListReq:b,showAddBlackList:()=>p.value=!0,hideAddBlackList:()=>p.value=!1,addBlackList:async()=>{await te(b.value),B.success("插入成功~"),await a()}}}),oe=x({__name:"UpdateBlackList",setup(u){const n=K(),{isUpdate:m,updateReq:a}=q(n),y={identifier:[{required:!0,message:"请输入识别码"},{validator:()=>a.value.type==="ip"&&a.value.identifier&&!N(a.value.identifier)?{result:!1,message:"请输入正确的IP地址",type:"error"}:!0}],reason:[{required:!0,message:"请输入原因"}],expires_at:[{required:!0,message:"请选择到期时间"}]},V=async({validateResult:c})=>{c===!0&&(await n.updateSelection(),n.hideUpdateDialog())};return(c,e)=>{const s=R,f=h,d=P,p=T,b=H,k=S,v=D,C=z,g=M;return L(),I(g,{visible:l(m),"onUpdate:visible":e[4]||(e[4]=i=>F(m)?m.value=i:null),header:"更新黑名单",footer:!1},{default:o(()=>[t(C,{onSubmit:V,data:l(a),rules:y},{default:o(()=>[l(a).id.length===1?(L(),$(j,{key:0},[t(d,{label:"类型",name:"type"},{default:o(()=>[t(f,{modelValue:l(a).type,"onUpdate:modelValue":e[0]||(e[0]=i=>l(a).type=i)},{default:o(()=>[t(s,{label:"指纹",value:"fingerprint"}),t(s,{label:"IP",value:"ip"})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"识别码",name:"identifier"},{default:o(()=>[t(p,{modelValue:l(a).identifier,"onUpdate:modelValue":e[1]||(e[1]=i=>l(a).identifier=i)},null,8,["modelValue"])]),_:1})],64)):E("",!0),t(d,{label:"原因",name:"reason"},{default:o(()=>[t(p,{modelValue:l(a).reason,"onUpdate:modelValue":e[2]||(e[2]=i=>l(a).reason=i)},null,8,["modelValue"])]),_:1}),t(d,{label:"到期时间",name:"expires_at"},{default:o(()=>[t(b,{modelValue:l(a).expires_at,"onUpdate:modelValue":e[3]||(e[3]=i=>l(a).expires_at=i),"enable-time-picker":"","allow-input":"",clearable:"",format:"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue"])]),_:1}),t(d,{label:"选中的账号"},{default:o(()=>[t(p,{value:JSON.stringify(l(a).id),disabled:""},null,8,["value"])]),_:1}),t(d,null,{default:o(()=>[t(v,{size:"small"},{default:o(()=>[t(k,{theme:"default",onClick:l(n).hideUpdateDialog},{default:o(()=>e[5]||(e[5]=[_(" 取消 ")])),_:1},8,["onClick"]),t(k,{type:"submit"},{default:o(()=>e[6]||(e[6]=[_(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ie=x({__name:"AddBlackList",setup(u){const n=K(),{isAddBlackList:m,addBlackListReq:a}=q(n),y={identifier:[{required:!0,message:"请输入识别码"},{validator:()=>a.value.type==="ip"&&a.value.identifier&&!N(a.value.identifier)?{result:!1,message:"请输入正确的IP地址",type:"error"}:!0}],reason:[{required:!0,message:"请输入原因"}],ban_days:[{required:!0,message:"请输入封禁天数"}]},V=async({validateResult:c})=>{c===!0&&await n.addBlackList()};return(c,e)=>{const s=R,f=h,d=P,p=T,b=X,k=S,v=D,C=z,g=M;return L(),I(g,{visible:l(m),"onUpdate:visible":e[4]||(e[4]=i=>F(m)?m.value=i:null),header:"添加黑名单",footer:!1},{default:o(()=>[t(C,{data:l(a),rules:y,onSubmit:V,labelWidth:130},{default:o(()=>[t(d,{label:"类型",name:"type"},{default:o(()=>[t(f,{modelValue:l(a).type,"onUpdate:modelValue":e[0]||(e[0]=i=>l(a).type=i)},{default:o(()=>[t(s,{label:"指纹",value:"fingerprint"}),t(s,{label:"IP",value:"ip"})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"识别码",name:"identifier"},{default:o(()=>[t(p,{modelValue:l(a).identifier,"onUpdate:modelValue":e[1]||(e[1]=i=>l(a).identifier=i)},null,8,["modelValue"])]),_:1}),t(d,{label:"原因",name:"reason"},{default:o(()=>[t(p,{modelValue:l(a).reason,"onUpdate:modelValue":e[2]||(e[2]=i=>l(a).reason=i)},null,8,["modelValue"])]),_:1}),t(d,{label:"封禁天数",name:"ban_days"},{default:o(()=>[t(b,{min:0,modelValue:l(a).ban_days,"onUpdate:modelValue":e[3]||(e[3]=i=>l(a).ban_days=i)},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(v,{size:"small"},{default:o(()=>[t(k,{theme:"default",onClick:l(n).hideAddBlackList},{default:o(()=>e[5]||(e[5]=[_(" 取消 ")])),_:1},8,["onClick"]),t(k,{type:"submit"},{default:o(()=>e[6]||(e[6]=[_(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ne={class:"buttons"},Ce=x({__name:"index",setup(u){const n=K(),{blackList:m,pagination:a,selectReq:r,selectedRowKeys:y}=q(n);J(n.getBlackLists);const V=w([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID",ellipsis:!0},{colKey:"type",title:"类型",ellipsis:!0},{colKey:"identifier",title:"识别码",ellipsis:!0},{colKey:"reason",title:"原因",ellipsis:!0},{colKey:"expires_at",title:"到期时间",width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(c,{row:e})=>t(S,{theme:"primary",onClick:s=>n.showUpdateDialog(s,e.id)},{default:()=>[_("编辑")]}),width:90,fixed:"right"}]);return(c,e)=>{const s=R,f=h,d=S,p=D,b=Z,k=Q;return L(),I(k,null,{default:o(()=>[W("div",ne,[t(p,{size:"small"},{default:o(()=>[t(f,{modelValue:l(r).column,"onUpdate:modelValue":e[0]||(e[0]=v=>l(r).column=v),onChange:l(n).getBlackLists},{default:o(()=>[t(s,{label:"按 id 排序",value:"id"}),t(s,{label:"按 type 排序",value:"type"}),t(s,{label:"按 identifier 排序",value:"identifier"}),t(s,{label:"按 reason 排序",value:"reason"}),t(s,{label:"按 expires_at 排序",value:"expires_at"}),t(s,{label:"按 created_at 排序",value:"created_at"}),t(s,{label:"按 updated_at 排序",value:"updated_at"})]),_:1},8,["modelValue","onChange"]),t(f,{modelValue:l(r).direction,"onUpdate:modelValue":e[1]||(e[1]=v=>l(r).direction=v),onChange:l(n).getBlackLists},{default:o(()=>[t(s,{label:"正序",value:"asc"}),t(s,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),t(d,{onClick:l(n).getBlackLists},{default:o(()=>e[2]||(e[2]=[_(" 刷新列表 ")])),_:1},8,["onClick"]),t(d,{onClick:l(n).showAddBlackList},{default:o(()=>e[3]||(e[3]=[_(" 添加黑名单 ")])),_:1},8,["onClick"]),t(d,{theme:"danger",onClick:l(n).deleteSelection},{default:o(()=>e[4]||(e[4]=[_(" 删除选中黑名单 ")])),_:1},8,["onClick"]),t(d,{onClick:l(n).showUpdateDialog},{default:o(()=>e[5]||(e[5]=[_(" 更新黑名单 ")])),_:1},8,["onClick"])]),_:1})]),t(ie),t(oe),t(b,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(m),pagination:l(a),columns:V.value,"select-on-row-click":!0,selectedRowKeys:l(y),onSelectChange:l(n).handleSelectChange},null,8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{Ce as default};
