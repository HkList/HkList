import{p as J,q as j,e as i,v as K,d as O,x as W,y as X,z as Q,A as Y,B as Z,C as ee,D as ae,E as ne,r as C,l as U,G as te,H as le,I as se,_ as oe,J as ie,K as re,L as ce,N as ue,O as de,u as fe,n as q,P as ve,Q as ge,M as _,R as M,S as me,s as pe,o as _e,a as Ce,b as y,f as L,g as G,T as he}from"./index-BVfyFF4r.js";import{f as we}from"./format-C2RM6Clz.js";import{I as ke,S as Fe}from"./index-BM23a07a.js";import{F as Ie,a as Se}from"./index-Jc1wxeft.js";import{B as ye}from"./useResizeObserver-DmPoJ7Bq.js";import{D as Le}from"./index-DlNVeh1k.js";/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */function xe(){var s=K();return function(h,m){var w;if(J(s.props[h]))w=s.props[h](j);else if(s.slots[h])w=s.slots[h]&&s.slots[h](null)[0];else if(m){var l=m[s.props.theme];w=i(l,null,null)}return w}}/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var Ae={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(e){return["success","info","warning","error"].includes(e)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var be=O({name:"TAlert",props:Ae,setup:function(e){var h=W("alert"),m=h.globalConfig,w=h.classPrefix,l=X({CheckCircleFilledIcon:Q,CloseIcon:Y,ErrorCircleFilledIcon:Z,HelpCircleFilledIcon:ee,InfoCircleFilledIcon:ae}),S=l.CheckCircleFilledIcon,r=l.CloseIcon,I=l.ErrorCircleFilledIcon,k=l.HelpCircleFilledIcon,x=l.InfoCircleFilledIcon,a=ne("alert"),f=ue(),c=xe(),u=C(null),o=C(null),g=C(0),p=C(!0),F=C(!0),R=function(){var n={info:x,success:S,warning:I,error:I,question:k},t=c("icon",n);return t?i("div",{class:"".concat(a.value,"__icon")},[t]):null},V=function(){var n=e.close,t=null;return n===!0||n===""?t=i(r,null,null):ie(n)?t=n:t=c("close"),t?i("div",{class:"".concat(a.value,"__close"),onClick:P},[t]):null},N=function(){var n=f("title");return n?i("div",{class:"".concat(a.value,"__title")},[" ",n]):null},T=function(){var n=f("operation");return i("div",{class:"".concat(a.value,"__message")},[D(),n?i("div",{class:"".concat(a.value,"__operation")},[n]):null])},D=function(){var n,t;t=f("default"),t||(t=f("message"));var A=ce(t)?t.length:1,b=e.maxLine>0&&e.maxLine<A,z=(n=o.value)===null||n===void 0||(n=n.children[0])===null||n===void 0?void 0:n.offsetHeight;return b&&F.value?(t=t.slice(0,e.maxLine),z&&(o.value.style.height="".concat(g.value,"px"))):b&&z&&(o.value.style.height="".concat(z*(A-e.maxLine)+g.value,"px")),i("div",{class:"".concat(a.value,"__description"),ref:o},[b?t.map(function(E){return i("div",null,[E])}):t,b?i("div",{class:"".concat(a.value,"__collapse"),onClick:function(){F.value=!F.value}},[F.value?m.value.expandText:m.value.collapseText]):null])},$=function(){return i("div",{class:"".concat(a.value,"__content")},[N(),T()])},P=function(n){var t;(t=e.onClose)===null||t===void 0||t.call(e,{e:n}),re(u.value,"".concat(a.value,"--closing"))},v=function(n){var t=n.target===u.value;if(n.propertyName==="opacity"&&t){var A;p.value=!1,(A=e.onClosed)===null||A===void 0||A.call(e,{e:n})}};return U(function(){te(u.value,"transitionend",v),g.value=o.value.offsetHeight}),le(function(){se(u.value,"transitionend",v)}),function(){return i("div",{ref:u,class:["".concat(a.value),"".concat(a.value,"--").concat(e.theme),oe({},"".concat(w.value,"-is-hidden"),!p.value)]},[R(),$(),V()])}}});/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var Te=de(be);const B=fe(),Ne=q("fileList",()=>{const s=C({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),e=C(),h=()=>{const o=s.value.dir.split("/");o.pop();const g=o.join("/");return g===""?"/":g},m=async()=>{I.value=[];const o=await ve(s.value);e.value=o.data,s.value.dir!=="/"&&e.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:h(),server_filename:"返回上一层",dlink:""})},w=C({token:localStorage.getItem("token")??"guest"}),l=C({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),S=C(""),r=async()=>{var o,g;try{const p=await ge(w.value);l.value=p.data,S.value="",localStorage.setItem("token",w.value.token)}catch(p){const F=(g=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:g.message;F&&(S.value=F)}},I=C([]),k=C([]),x=(o,g)=>{I.value=o,k.value=g.selectedRowData},a=C({hit_captcha:!1,vcode_str:"",vcode_img:"",vcode_input:""}),f=C(!1),c=C([]);return{GetFileListReq:s,GetFileListRes:e,getFileList:m,GetLimitReq:w,GetLimitRes:l,GetLimitError:S,getLimit:r,selectedRowKeys:I,handleSelectChange:x,getDownloadLinks:async(o,g)=>{var D,$,P;if(f.value)return _.error("正在解析中,请稍后再试"),!1;const{config:p}=B;o&&typeof o!="number"&&g&&(o.stopPropagation(),k.value=[g]);const F=k.value.filter(v=>v&&!v.is_dir);F.length!==k.value.length&&_.warning("暂时不支持解析文件夹");const R=F.filter(v=>v.size>p.min_single_filesize);R.length!==F.length&&_.warning("文件过小不会被解析");const V=R.filter(v=>v.size<p.max_single_filesize);V.length!==R.length&&_.warning("文件过大不会被解析");const N=V;if(N.reduce((v,d)=>v+d.size,0)>p.max_all_filesize){_.error(`单次最多解析${we(p.max_all_filesize)}的文件`);return}if(N.length>p.max_once){_.error(`单次最多解析${p.max_once}个文件`);return}if(N.length===0){_.error("满足要求的文件数量为0");return}try{if(f.value=!0,a.value.hit_captcha=!1,typeof o=="number"){const v=await M({randsk:e.value.randsk,uk:e.value.uk,shareid:e.value.shareid,fs_id:[o],surl:s.value.surl,dir:s.value.dir,pwd:s.value.pwd,token:w.value.token,parse_password:s.value.parse_password,...a.value.hit_captcha?{vcode_str:a.value.vcode_str,vcode_input:a.value.vcode_input}:{}});return _.success("重新解析成功"),v.data}else{const v=[];let d=null,n;try{for(const t in N){n=N[t],d&&d.close(),d=await _.loading(`正在解析第${parseFloat(t)+1}个文件:${n.server_filename}`,9999999);const A=await M({randsk:e.value.randsk,uk:e.value.uk,shareid:e.value.shareid,fs_id:[n.fs_id],surl:s.value.surl,dir:s.value.dir,pwd:s.value.pwd,token:w.value.token,parse_password:s.value.parse_password,...a.value.hit_captcha?{vcode_str:a.value.vcode_str,vcode_input:a.value.vcode_input}:{}});v.push(...A.data),n!==null&&(I.value=I.value.filter(b=>b!==n.fs_id),k.value=k.value.filter(b=>b.fs_id!==n.fs_id))}}catch(t){throw d&&d.close(),c.value=v,_.success("部分解析成功,下滑查看解析结果"),t}d&&d.close(),_.success("解析成功,下滑查看解析结果"),c.value=v}}catch(v){const d=v;if((P=($=(D=d==null?void 0:d.response)==null?void 0:D.data)==null?void 0:$.message)!=null&&P.includes("-20")){const n=await me({parse_password:s.value.parse_password});a.value={hit_captcha:!0,...n.data,vcode_input:""}}else _.error("解析可能失败或超时了,请稍后前往历史记录中尝试查询是否成功")}finally{f.value=!1,await r(),await B.getConfig()}},GetDownLoadLinksRes:c,vcode:a}}),H=Ne(),Re=q("aria2",()=>{const s=C(!1),e=C({host:"ws://localhost:16800/jsonrpc",token:"",dir:""});U(()=>{const a=localStorage.getItem("aria2Config");a&&(e.value=JSON.parse(a))});const h=()=>s.value=!0,m=()=>s.value=!1,w=()=>{localStorage.setItem("aria2Config",JSON.stringify(e.value)),l=null};let l=null;const S=()=>new Promise((a,f)=>{l&&(l.close(),l=null);try{l=new WebSocket(e.value.host),l.onopen=()=>a(l),l.onerror=c=>{_.error("链接到Aria2下载器出错"),f(c)}}catch(c){_.error("链接到Aria2下载器出错"),f(c)}}),r=async(a,f=[])=>((!l||l.readyState!==WebSocket.OPEN)&&(l=await S()),new Promise((c,u)=>{l=l;const o="HkList"+Date.now().toString(),g={jsonrpc:"2.0",method:a,id:o,params:[`token:${e.value.token}`,...f]};l.onmessage=p=>{const F=JSON.parse(p.data);F.id===o&&(F.error?u(F.error):c(F.result))},l.send(JSON.stringify(g))})),I=async()=>{await r("aria2.getVersion"),_.success("测试连接成功")},k=async(a,f,c,u)=>{await r("aria2.addUri",[[a],{out:f,dir:e.value.dir===""?null:e.value.dir,header:[`User-Agent: ${c}`],split:u.toString()}]),_.success("添加链接成功")};return{aria2ConfigDialogVisible:s,showAria2Config:h,hideAria2Config:m,aria2ConfigForm:e,saveAria2Config:w,getAria2Version:I,addAria2Url:k,downloadLinks:async(a,f=0)=>{for(const c of a){let u=c.filename;if(c.fs_id&&H.GetFileListRes){const o=H.GetFileListRes.list.find(g=>g.fs_id===c.fs_id);o&&(u=o.path)}await k(c.urls[f],u,c.ua,16)}}}}),Ee=O({__name:"Aria2Dialog",setup(s){const e=Re(),{aria2ConfigDialogVisible:h,aria2ConfigForm:m}=pe(e),w={},l=async({validateResult:S})=>{S===!0&&(e.saveAria2Config(),e.hideAria2Config(),_.success("保存成功"))};return(S,r)=>{const I=ke,k=Ie,x=ye,a=Fe,f=Se,c=Le;return _e(),Ce(c,{visible:L(h),"onUpdate:visible":r[3]||(r[3]=u=>he(h)?h.value=u:null),header:"Aria2配置调整",footer:!1},{default:y(()=>[i(f,{data:L(m),rules:w,onSubmit:l},{default:y(()=>[i(k,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:y(()=>[i(I,{modelValue:L(m).host,"onUpdate:modelValue":r[0]||(r[0]=u=>L(m).host=u)},null,8,["modelValue"])]),_:1}),i(k,{label:"密钥",name:"token"},{default:y(()=>[i(I,{modelValue:L(m).token,"onUpdate:modelValue":r[1]||(r[1]=u=>L(m).token=u)},null,8,["modelValue"])]),_:1}),i(k,{label:"保存路径",name:"dir"},{default:y(()=>[i(I,{modelValue:L(m).dir,"onUpdate:modelValue":r[2]||(r[2]=u=>L(m).dir=u)},null,8,["modelValue"])]),_:1}),i(k,null,{default:y(()=>[i(a,{size:"small"},{default:y(()=>[i(x,{theme:"default",onClick:L(e).hideAria2Config},{default:y(()=>r[4]||(r[4]=[G(" 取消 ")])),_:1},8,["onClick"]),i(x,{onClick:L(e).getAria2Version},{default:y(()=>r[5]||(r[5]=[G(" 测试连接 ")])),_:1},8,["onClick"]),i(x,{type:"submit"},{default:y(()=>r[6]||(r[6]=[G(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{Te as A,Ee as _,Re as a,Ne as u};
