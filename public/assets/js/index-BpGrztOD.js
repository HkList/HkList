import{d as I,u as H,s as T,f as t,o as F,a as G,b as s,j as $,k as P,l as le,r as v,m as se,n as oe,M as x,p as ae,q as ne,v as ie,e,g as C,t as A,h as E,F as K,w as re,i as ue}from"./index-BJhcKZeD.js";import{C as N,S as Y,I as de}from"./index-0g5QdBBD.js";import{f as j,a as ce}from"./format-Dg1vCwiB.js";import{g as me}from"./getUrlId-C6EUnTTr.js";import{A as Z,u as _e,_ as pe}from"./Aria2Dialog.vue_vue_type_script_setup_true_lang-BcGSBrKp.js";import{F as fe,a as ge}from"./index-Jl42w06N.js";import{B as q}from"./useResizeObserver-CrahsTvI.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as ee}from"./index-DQlRfgjG.js";import{c as J,L as we,a as ke}from"./copy-D7wizWmk.js";import{l as O}from"./link-B8glB0eq.js";import{L as Q}from"./index-ByEQAoZA.js";import{T as Le}from"./index-CN5NUBdd.js";import"./index-DBytTMNS.js";import"./index-PG3XRsWF.js";import"./dep-b315df3e-w72xg2Kb.js";import"./fake-arrow-BrDZk_aI.js";import"./dep-0df090f8-D8dxZAAR.js";import"./index-BPhO86LL.js";import"./add-BV_6eahh.js";import"./useVirtualScrollNew-9Ci0_5un.js";import"./helper-D9Yh0fxx.js";import"./index-D29H5hKA.js";const ye=["innerHTML"],he=I({__name:"Announce",setup(w){const u=H(),{config:_}=T(u);return(f,a)=>{const S=N;return t(_).show_announce?(F(),G(S,{key:0,title:"公告"},{default:s(()=>[$("div",{innerHTML:t(_).announce},null,8,ye)]),_:1})):P("",!0)}}}),X=H(),W=le("fileList",()=>{const w=v({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),u=v(),_=()=>{const i=w.value.dir.split("/");i.pop();const y=i.join("/");return y===""?"/":y},f=async()=>{r.value=[];const i=await se(w.value);u.value=i.data,w.value.dir!=="/"&&u.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:_(),server_filename:"返回上一层",dlink:""})},a=v({token:"guest"}),S=v({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),k=v(""),c=async()=>{var i,y;try{const d=await oe(a.value);S.value=d.data,k.value=""}catch(d){const o=(y=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:y.message;o&&(k.value=o)}},r=v([]),L=v([]),V=(i,y)=>{r.value=i,L.value=y.selectedRowData},p=v({hit_captcha:!1,vcode_str:"",vcode_img:"",vcode_input:""}),l=v(!1),m=v([]);return{GetFileListReq:w,GetFileListRes:u,getFileList:f,GetLimitReq:a,GetLimitRes:S,GetLimitError:k,getLimit:c,selectedRowKeys:r,handleSelectChange:V,getDownloadLinks:async(i,y)=>{var z,B,U;if(l.value)return x.error("正在解析中,请稍后再试"),!1;const{config:d}=X;i&&typeof i!="number"&&y&&(i.stopPropagation(),L.value=[y]);const o=L.value.filter(n=>n&&!n.is_dir);o.length!==L.value.length&&x.warning("文件夹不会进行解析,已忽略");const R=o.filter(n=>n.size>d.min_single_filesize);R.length!==o.length&&x.warning("文件过小不会被解析");const D=R.filter(n=>n.size<d.max_single_filesize);D.length!==R.length&&x.warning("文件过大不会被解析");const h=D;if(h.reduce((n,M)=>n+M.size,0)>d.max_all_filesize){x.error(`单次最多解析${j(d.max_all_filesize)}的文件`);return}if(h.length>d.max_once){x.error(`单次最多解析${d.max_once}个文件`);return}if(h.length===0){x.error("满足要求的文件数量为0");return}try{l.value=!0;const n=await ae({randsk:u.value.randsk,uk:u.value.uk,shareid:u.value.shareid,fs_id:typeof i=="number"?[i]:h.map(M=>M.fs_id),surl:w.value.surl,dir:w.value.dir,pwd:w.value.pwd,token:a.value.token,parse_password:w.value.parse_password,...p.value.hit_captcha?{vcode_str:p.value.vcode_str,vcode_input:p.value.vcode_input}:{}});if(typeof i=="number")return x.success("重新解析成功"),n.data;x.success("解析成功,下滑查看解析结果"),m.value=n.data,p.value.hit_captcha=!1}catch(n){const M=n;if((U=(B=(z=M==null?void 0:M.response)==null?void 0:z.data)==null?void 0:B.message)!=null&&U.includes("-20")){const te=await ne({parse_password:w.value.parse_password});p.value={hit_captcha:!0,...te.data,vcode_input:""}}else x.error("解析可能失败或超时了,请稍后前往历史记录中尝试查询是否成功")}finally{l.value=!1,await c(),await X.getConfig()}},GetDownLoadLinksRes:m,vcode:p}}),Ce={key:1},be=["src"],Re=I({__name:"Form",setup(w){const u=H(),{config:_}=T(u),f=W(),{GetFileListReq:a,GetLimitReq:S,GetLimitRes:k,GetLimitError:c,GetFileListRes:r,GetDownLoadLinksRes:L,vcode:V}=T(f),p=()=>{const d=me(a.value.url);if(!d)return;const{surl:o,pwd:R,url:D}=d;a.value.surl=o,a.value.url=D,a.value.dir="/",R&&(a.value.pwd=R,x.success("已自动填写密码~"))},l=()=>{a.value.dir="/",r.value=void 0,L.value=[]},m={url:[{required:!0,message:"链接不能为空"}],parse_password:[{required:!0,message:"解析密码不能为空"}],vcode_input:[{required:!0,message:"验证码不能为空"}]};ie(()=>{f.getLimit(),u.getConfig()});const b=async({validateResult:d})=>{d===!0&&(a.value.dir="/",await f.getFileList(),x.success("获取成功"))},i=v(Date.now()),y=()=>{i.value=Date.now()};return(d,o)=>{const R=Z,D=Y,h=de,g=fe,z=q,B=ge,U=N;return F(),G(U,null,{default:s(()=>[e(D,{direction:"vertical",class:"space"},{default:s(()=>[e(R,{theme:t(_).have_account?"success":"error"},{default:s(()=>[C(A(t(_).have_account?"当前中转账号充足":"当前中转账号不足"),1)]),_:1},8,["theme"]),t(_).debug?(F(),G(R,{key:0,theme:"error"},{default:s(()=>o[6]||(o[6]=[C(" 当前网站开启了DEBUG模式,非调试请关闭!!!! ")])),_:1})):P("",!0),e(R,{theme:t(c).length===0?"success":"error"},{default:s(()=>[t(c).length===0?(F(),G(D,{key:0},{default:s(()=>[$("span",null,"剩余可解析文件数: "+A(t(k).count),1),$("span",null,"剩余可解析大小: "+A(t(j)(t(k).size)),1),$("span",null,"到期时间: "+A(t(k).expires_at),1)]),_:1})):(F(),E("span",Ce,A(t(c)),1))]),_:1},8,["theme"]),e(B,{data:t(a),rules:m,labelWidth:120,onSubmit:b},{default:s(()=>[e(g,{name:"url",label:"链接"},{default:s(()=>[e(h,{modelValue:t(a).url,"onUpdate:modelValue":o[0]||(o[0]=n=>t(a).url=n),modelModifiers:{trim:!0},onBlur:p,onChange:l},null,8,["modelValue"])]),_:1}),e(g,{name:"surl",label:"提取到的链接"},{default:s(()=>[e(h,{value:t(a).surl,disabled:""},null,8,["value"])]),_:1}),e(g,{name:"pwd",label:"提取码"},{default:s(()=>[e(h,{modelValue:t(a).pwd,"onUpdate:modelValue":o[1]||(o[1]=n=>t(a).pwd=n),modelModifiers:{trim:!0},onChange:l},null,8,["modelValue"])]),_:1}),t(_).need_password?(F(),G(g,{key:0,name:"parse_password",label:"解析密码"},{default:s(()=>[e(h,{modelValue:t(a).parse_password,"onUpdate:modelValue":o[2]||(o[2]=n=>t(a).parse_password=n),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):P("",!0),e(g,{name:"token",label:"卡密"},{default:s(()=>[e(h,{modelValue:t(S).token,"onUpdate:modelValue":o[3]||(o[3]=n=>t(S).token=n),modelModifiers:{trim:!0},onBlur:t(f).getLimit},null,8,["modelValue","onBlur"])]),_:1}),e(g,{name:"dir",label:"路径"},{default:s(()=>[e(h,{modelValue:t(a).dir,"onUpdate:modelValue":o[4]||(o[4]=n=>t(a).dir=n),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),_:1}),t(V).hit_captcha?(F(),E(K,{key:1},[e(g,{label:"验证码图片",name:"vcode_img"},{default:s(()=>[$("img",{src:`${t(V).vcode_img}&t=${i.value}`,onClick:y},null,8,be)]),_:1}),e(g,{label:"验证码字符",name:"vcode_input"},{default:s(()=>[e(h,{modelValue:t(V).vcode_input,"onUpdate:modelValue":o[5]||(o[5]=n=>t(V).vcode_input=n)},null,8,["modelValue"])]),_:1})],64)):P("",!0),e(g,null,{default:s(()=>[e(D,{size:"small"},{default:s(()=>[e(z,{type:"submit"},{default:s(()=>o[7]||(o[7]=[C(" 获取文件列表 ")])),_:1}),e(z,{onClick:t(f).getDownloadLinks},{default:s(()=>o[8]||(o[8]=[C(" 批量解析 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})}}}),xe=ve(Re,[["__scopeId","data-v-ac4df58b"]]),Fe=I({__name:"FilesList",setup(w){const u=W(),{GetFileListReq:_,GetFileListRes:f,selectedRowKeys:a}=T(u),S=v([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"server_filename",title:"文件名",cell:(c,{row:r})=>e(K,null,[e("div",{class:"filename"},[e("img",{class:"ico",src:r.is_dir?"/images/folder.png":"/images/file.png"},null),e("span",null,[r.server_filename])])]),ellipsis:!0},{colKey:"server_mtime",title:"修改时间",cell:(c,{row:r})=>e(K,null,[ce(r.server_mtime)]),ellipsis:!0},{colKey:"size",title:"文件大小",cell:(c,{row:r})=>e(K,null,[j(r.size)]),ellipsis:!0},{colKey:"operation",title:"操作",cell:(c,{row:r})=>r.is_dir?e(K,null,[e(q,{theme:"primary",onClick:L=>k(L,r.path)},{default:()=>[C("打开文件夹")]})]):e(K,null,[e(q,{theme:"primary",onClick:L=>u.getDownloadLinks(L,r)},{default:()=>[C("解析")]})]),width:130,align:"center",fixed:"right"}]),k=async(c,r)=>{c.stopPropagation(),_.value.dir=r,await u.getFileList()};return(c,r)=>{const L=ee,V=N;return t(f)?(F(),G(V,{key:0},{default:s(()=>[e(L,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:t(f).list,maxHeight:500,columns:S.value,"select-on-row-click":!0,selectedRowKeys:t(a),onSelectChange:t(u).handleSelectChange},null,8,["data","columns","selectedRowKeys","onSelectChange"])]),_:1})):P("",!0)}}}),Se=I({__name:"LinksList",setup(w){const u=W(),{GetDownLoadLinksRes:_}=T(u),f=_e(),a=v([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"message",title:"状态"},{colKey:"filename",title:"文件名"},{colKey:"ua",title:"UA",cell:(p,{row:l})=>e(Q,{onClick:m=>V(m,l.ua)},{default:()=>[e(O,null,null),l.ua]})},{colKey:"fs_id",title:"文件ID"},{colKey:"operation",title:"操作",cell:(p,{row:l,rowIndex:m})=>e(K,null,[e(q,{onClick:b=>S(b,l,m)},{default:()=>[C("重新解析")]})])}]),S=async(p,l,m)=>{p.stopPropagation();const b=await u.getDownloadLinks(l.fs_id);b&&(_.value[m]=b[0])},k=v([]),c=v([]),r=(p,l)=>{k.value=p,c.value=l.selectedRowData.filter(m=>m.urls).map(m=>({filename:m.filename,urls:m.urls,ua:m.ua}))};re(_,()=>{k.value=[],c.value=[]});const L=()=>{k.value=[],c.value=[]},V=(p,l)=>{p.stopPropagation(),J(l)};return(p,l)=>{const m=Q,b=q,i=Y,y=Z,d=Le,o=ke,R=we,D=ee,h=N;return t(_).length>0?(F(),G(h,{key:0},{default:s(()=>[e(i,{direction:"vertical"},{default:s(()=>[e(y,null,{default:s(()=>[l[4]||(l[4]=C(" 下载请推荐使用Aria2下载器,如 ")),e(m,{href:"https://motrix.app/",target:"_blank"},{"prefix-icon":s(()=>[e(t(O))]),default:s(()=>[l[1]||(l[1]=C(" Motrix "))]),_:1}),l[5]||(l[5]=$("p",null,"IDM下载需要手动指定UA,点击即可复制",-1)),l[6]||(l[6]=$("p",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可重新解析该文件",-1)),l[7]||(l[7]=$("br",null,null,-1)),e(i,null,{default:s(()=>[e(b,{onClick:t(f).showAria2Config},{default:s(()=>l[2]||(l[2]=[C(" 修改Aria2配置 ")])),_:1},8,["onClick"]),e(b,{onClick:l[0]||(l[0]=g=>t(f).downloadLinks(c.value))},{default:s(()=>l[3]||(l[3]=[C("批量发送")])),_:1})]),_:1})]),_:1}),e(D,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:t(_),columns:a.value,"select-on-row-click":!0,selectedRowKeys:k.value,onSelectChange:r,onPageChange:L},{expandedRow:s(({row:g})=>[e(R,{split:"",size:"large"},{default:s(()=>[(F(!0),E(K,null,ue(g.urls,(z,B)=>(F(),G(o,{key:z},{default:s(()=>[e(i,{direction:"vertical"},{default:s(()=>[e(i,null,{default:s(()=>[e(d,{size:"large"},{default:s(()=>[C(" 第 "+A(B+1)+" 条 ",1)]),_:2},1024),e(b,{onClick:U=>t(J)(z)},{default:s(()=>l[8]||(l[8]=[C("复制")])),_:2},1032,["onClick"]),e(b,{onClick:U=>t(f).addAria2Url(z,g.filename,g.ua,16)},{default:s(()=>l[9]||(l[9]=[C("发送到Aria2下载器")])),_:2},1032,["onClick"])]),_:2},1024),$("p",null,A(z),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","columns","selectedRowKeys"])]),_:1})]),_:1})):P("",!0)}}}),Ye=I({__name:"index",setup(w){return(u,_)=>(F(),E(K,null,[e(he),e(xe),e(Fe),e(Se),e(pe)],64))}});export{Ye as default};
