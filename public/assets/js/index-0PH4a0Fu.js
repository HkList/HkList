import{m as oe,n as se,f as e,p as re,d as A,q as ie,v as ce,x as ue,y as de,z as me,A as _e,B as fe,C as pe,r as C,D as W,E as ve,G as ge,H as he,_ as Ce,I as we,J as Le,K as ye,L as ke,M as Fe,u as U,s as E,g as n,o as x,a as b,e as r,h as B,N as V,O as xe,P as Ie,Q as Se,R,S as be,j as z,t as $,k as Z,F as G,l as ze}from"./index-CXsQrBlN.js";import{C as P,S as Y,I as Re,B as N}from"./index-BrMISRL3.js";import{f as ee,a as Me}from"./format-DM3J8B0o.js";import{F as $e,a as Ge}from"./index-BPdgWXY4.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as te}from"./index-Ca7uAS7r.js";import{c as X,L as De,a as Ve}from"./copy-BEeO7rZN.js";import{L as Ae}from"./index-DRFPT3xl.js";import{T as Be}from"./index-BVzw0HaR.js";import"./useResizeObserver-68q0ST9u.js";import"./index-B4qoRM2T.js";import"./dep-b315df3e-Bhs51j-8.js";import"./fake-arrow-RRoJ920x.js";import"./dep-0df090f8-B8El8jRh.js";import"./index-BXxGOXeh.js";import"./add-B9qLOlVE.js";import"./useVirtualScrollNew-XSuNWHRp.js";import"./helper-DL-Ugjgz.js";/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */function Ee(){var p=re();return function(i,v){var t;if(oe(p.props[i]))t=p.props[i](se);else if(p.slots[i])t=p.slots[i]&&p.slots[i](null)[0];else if(v){var f=v[p.props.theme];t=e(f,null,null)}return t}}/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Ke={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(l){return["success","info","warning","error"].includes(l)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Ne=A({name:"TAlert",props:Ke,setup:function(l){var i=ie("alert"),v=i.globalConfig,t=i.classPrefix,f=ce({CheckCircleFilledIcon:ue,CloseIcon:de,ErrorCircleFilledIcon:me,HelpCircleFilledIcon:_e,InfoCircleFilledIcon:fe}),w=f.CheckCircleFilledIcon,g=f.CloseIcon,c=f.ErrorCircleFilledIcon,h=f.HelpCircleFilledIcon,S=f.InfoCircleFilledIcon,u=pe("alert"),a=ke(),L=Ee(),o=C(null),s=C(null),d=C(0),y=C(!0),I=C(!0),T=function(){var m={info:S,success:w,warning:c,error:c,question:h},_=L("icon",m);return _?e("div",{class:"".concat(u.value,"__icon")},[_]):null},k=function(){var m=l.close,_=null;return m===!0||m===""?_=e(g,null,null):we(m)?_=m:_=L("close"),_?e("div",{class:"".concat(u.value,"__close"),onClick:ae},[_]):null},F=function(){var m=a("title");return m?e("div",{class:"".concat(u.value,"__title")},[" ",m]):null},q=function(){var m=a("operation");return e("div",{class:"".concat(u.value,"__message")},[le(),m?e("div",{class:"".concat(u.value,"__operation")},[m]):null])},le=function(){var m,_;_=a("default"),_||(_=a("message"));var D=ye(_)?_.length:1,K=l.maxLine>0&&l.maxLine<D,H=(m=s.value)===null||m===void 0||(m=m.children[0])===null||m===void 0?void 0:m.offsetHeight;return K&&I.value?(_=_.slice(0,l.maxLine),H&&(s.value.style.height="".concat(d.value,"px"))):K&&H&&(s.value.style.height="".concat(H*(D-l.maxLine)+d.value,"px")),e("div",{class:"".concat(u.value,"__description"),ref:s},[K?_.map(function(j){return e("div",null,[j])}):_,K?e("div",{class:"".concat(u.value,"__collapse"),onClick:function(){I.value=!I.value}},[I.value?v.value.expandText:v.value.collapseText]):null])},ne=function(){return e("div",{class:"".concat(u.value,"__content")},[F(),q()])},ae=function(m){var _;(_=l.onClose)===null||_===void 0||_.call(l,{e:m}),Le(o.value,"".concat(u.value,"--closing"))},O=function(m){var _=m.target===o.value;if(m.propertyName==="opacity"&&_){var D;y.value=!1,(D=l.onClosed)===null||D===void 0||D.call(l,{e:m})}};return W(function(){ve(o.value,"transitionend",O),d.value=s.value.offsetHeight}),ge(function(){he(o.value,"transitionend",O)}),function(){return e("div",{ref:o,class:["".concat(u.value),"".concat(u.value,"--").concat(l.theme),Ce({},"".concat(t.value,"-is-hidden"),!y.value)]},[T(),ne(),k()])}}});/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Pe=Fe(Ne);const qe=["innerHTML"],He=A({__name:"Announce",setup(p){const l=U(),{config:i}=E(l);return(v,t)=>{const f=P;return n(i).show_announce?(x(),b(f,{key:0,title:"公告"},{default:r(()=>[B("div",{innerHTML:n(i).announce},null,8,qe)]),_:1})):V("",!0)}}}),Q=U(),J=xe("fileListStore",()=>{const p=C({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),l=C(),i=()=>{const o=p.value.dir.split("/");o.pop();const s=o.join("/");return s===""?"/":s},v=async()=>{c.value=[];const o=await Ie(p.value);l.value=o.data,p.value.dir!=="/"&&l.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:i(),server_filename:"返回上一层",dlink:""})},t=C({token:"guest"}),f=C({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),w=C(""),g=async()=>{var o,s;try{const d=await Se(t.value);f.value=d.data,w.value=""}catch(d){const y=(s=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:s.message;y&&(w.value=y)}},c=C([]),h=C([]),S=(o,s)=>{c.value=o,h.value=s.selectedRowData},u=C(!1),a=C([]);return{GetFileListReq:p,GetFileListRes:l,getFileList:v,GetLimitReq:t,GetLimitRes:f,GetLimitError:w,getLimit:g,selectedRowKeys:c,handleSelectChange:S,getDownloadLinks:async(o,s)=>{const{config:d}=Q;o&&s&&(o.stopPropagation(),h.value=[s]);const y=h.value.filter(F=>F&&!F.is_dir);console.log(y,h.value),y.length!==h.value.length&&R.warning("文件夹不会进行解析,已忽略");const I=y.filter(F=>F.size>d.min_single_filesize);I.length!==y.length&&R.warning("文件过小不会被解析");const T=I.filter(F=>F.size<d.max_single_filesize);T.length!==I.length&&R.warning("文件过大不会被解析");const k=T;if(k.length>d.max_once){R.error(`单次最多解析${d.max_once}个文件`);return}if(k.length===0){R.error("满足要求的文件数量为0");return}try{u.value=!0;const F=await be({randsk:l.value.randsk,uk:l.value.uk,shareid:l.value.shareid,fs_id:k.map(q=>q.fs_id),surl:p.value.surl,dir:p.value.dir,pwd:p.value.pwd,token:t.value.token,parse_password:p.value.parse_password});a.value=F.data}catch(F){console.log(F)}finally{u.value=!1,await g(),await Q.getConfig()}},GetDownLoadLinksRes:a}}),Ue={key:1},Ze=A({__name:"Form",setup(p){const l=U(),{config:i}=E(l),v=J(),{GetFileListReq:t,GetLimitReq:f,GetLimitRes:w,GetLimitError:g}=E(v),c=()=>{const u=t.value.url,a=u.match(/s\/([a-zA-Z0-9_-]+)/),L=u.match(/surl=([a-zA-Z0-9_-]+)/),o=u.match(/\?pwd=([a-zA-Z0-9_-]+)/),s=u.match(/&pwd=([a-zA-Z0-9_-]+)/),d=u.match(/提取码[:：]\s?([a-zA-Z0-9_-]+)/);if(a)t.value.surl=a[1];else if(L)t.value.surl=`1${L[1]}`;else return t.value.surl="",t.value.pwd="",t.value.dir="",R.error("无法识别的链接");return t.value.url=`https://pan.baidu.com/s/${t.value.surl}`,t.value.pwd=o?o[1]:s?s[1]:d?d[1]:"",R.success("链接识别成功~"),!0},h={url:[{required:!0,message:"链接不能为空"}],parse_password:[{required:!0,message:"解析密码不能为空"}]};W(()=>{v.getLimit(),l.getConfig()});const S=async({validateResult:u})=>{u===!0&&(t.value.dir="/",await v.getFileList(),R.success("获取成功"))};return(u,a)=>{const L=Pe,o=Y,s=Re,d=$e,y=N,I=Ge,T=P;return x(),b(T,null,{default:r(()=>[e(o,{direction:"vertical",class:"space"},{default:r(()=>[e(L,{theme:n(i).have_account?"success":"error"},{default:r(()=>[z($(n(i).have_account?"当前中转账号充足":"当前中转账号不足"),1)]),_:1},8,["theme"]),n(i).debug?(x(),b(L,{key:0,theme:"error"},{default:r(()=>a[4]||(a[4]=[z(" 当前网站开启了DEBUG模式,非调试请关闭!!!! ")])),_:1})):V("",!0),n(i).is_ssl?V("",!0):(x(),b(L,{key:1,theme:"error"},{default:r(()=>a[5]||(a[5]=[z(" 当前网站未开启SSL,可能无法连接Aria2 ")])),_:1})),e(L,{theme:n(g).length===0?"success":"error"},{default:r(()=>[n(g).length===0?(x(),b(o,{key:0},{default:r(()=>[B("span",null,"剩余可解析文件数: "+$(n(w).count),1),B("span",null,"剩余可解析大小: "+$(n(ee)(n(w).size)),1),B("span",null,"到期时间: "+$(n(w).expires_at),1)]),_:1})):(x(),Z("span",Ue,$(n(g)),1))]),_:1},8,["theme"]),e(I,{data:n(t),rules:h,onSubmit:S},{default:r(()=>[e(d,{name:"url",label:"链接"},{default:r(()=>[e(s,{modelValue:n(t).url,"onUpdate:modelValue":a[0]||(a[0]=k=>n(t).url=k),modelModifiers:{trim:!0},onBlur:c},null,8,["modelValue"])]),_:1}),e(d,{name:"surl",label:"提取到的链接"},{default:r(()=>[e(s,{value:n(t).surl,disabled:""},null,8,["value"])]),_:1}),e(d,{name:"pwd",label:"提取码"},{default:r(()=>[e(s,{modelValue:n(t).pwd,"onUpdate:modelValue":a[1]||(a[1]=k=>n(t).pwd=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1}),n(i).need_password?(x(),b(d,{key:0,name:"parse_password",label:"解析密码"},{default:r(()=>[e(s,{modelValue:n(t).parse_password,"onUpdate:modelValue":a[2]||(a[2]=k=>n(t).parse_password=k),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):V("",!0),e(d,{name:"token",label:"卡密"},{default:r(()=>[e(s,{modelValue:n(f).token,"onUpdate:modelValue":a[3]||(a[3]=k=>n(f).token=k),modelModifiers:{trim:!0},onBlur:n(v).getLimit},null,8,["modelValue","onBlur"])]),_:1}),e(d,null,{default:r(()=>[e(o,{size:"small"},{default:r(()=>[e(y,{type:"submit"},{default:r(()=>a[6]||(a[6]=[z(" 获取文件列表 ")])),_:1}),e(y,{onClick:n(v).getDownloadLinks},{default:r(()=>a[7]||(a[7]=[z(" 批量解析 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})}}}),Je=Te(Ze,[["__scopeId","data-v-69a0be3f"]]),Oe=A({__name:"FilesList",setup(p){const l=J(),{GetFileListReq:i,GetFileListRes:v,selectedRowKeys:t}=E(l),f=C([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"server_filename",title:"文件名",cell:(g,{row:c})=>e(G,null,[e("div",{class:"filename"},[e("img",{class:"ico",src:c.is_dir?"/images/folder.png":"/images/file.png"},null),e("span",null,[c.server_filename])])]),ellipsis:!0},{colKey:"server_mtime",title:"修改时间",cell:(g,{row:c})=>e(G,null,[Me(c.server_mtime)]),ellipsis:!0},{colKey:"size",title:"文件大小",cell:(g,{row:c})=>e(G,null,[ee(c.size)]),ellipsis:!0},{colKey:"operation",title:"操作",cell:(g,{row:c})=>c.is_dir?e(G,null,[e(N,{theme:"primary",onClick:h=>w(h,c.path)},{default:()=>[z("打开文件夹")]})]):e(G,null,[e(N,{theme:"primary",onClick:h=>l.getDownloadLinks(h,c)},{default:()=>[z("解析")]})]),width:130,align:"center",fixed:"right"}]),w=async(g,c)=>{g.stopPropagation(),i.value.dir=c,await l.getFileList()};return(g,c)=>{const h=te,S=P;return n(v)?(x(),b(S,{key:0},{default:r(()=>[e(h,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:n(v).list,columns:f.value,"select-on-row-click":!0,selectedRowKeys:n(t),onSelectChange:n(l).handleSelectChange},null,8,["data","columns","selectedRowKeys","onSelectChange"])]),_:1})):V("",!0)}}}),je=A({__name:"LinksList",setup(p){const l=J(),{GetDownLoadLinksRes:i}=E(l),v=C([{colKey:"message",title:"状态"},{colKey:"filename",title:"文件名"},{colKey:"ua",title:"UA",cell:(t,{row:f})=>e(Ae,{onClick:()=>X(f.ua)},{default:()=>[f.ua]})},{colKey:"fs_id",title:"文件ID"}]);return(t,f)=>{const w=Be,g=N,c=Y,h=Ve,S=De,u=te,a=P;return n(i).length>0?(x(),b(a,{key:0},{default:r(()=>[e(u,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:n(i),columns:v.value},{expandedRow:r(({row:L})=>[e(S,{split:"",size:"large"},{default:r(()=>[(x(!0),Z(G,null,ze(L.urls,(o,s)=>(x(),b(h,{key:o},{default:r(()=>[e(c,{direction:"vertical"},{default:r(()=>[e(c,null,{default:r(()=>[e(w,{size:"large"},{default:r(()=>[z(" 第 "+$(s+1)+" 条 ",1)]),_:2},1024),e(g,{onClick:d=>n(X)(o)},{default:r(()=>f[0]||(f[0]=[z("复制")])),_:2},1032,["onClick"])]),_:2},1024),B("p",null,$(o),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","columns"])]),_:1})):V("",!0)}}}),ft=A({__name:"index",setup(p){return(l,i)=>(x(),Z(G,null,[e(He),e(Je),e(Oe),e(je)],64))}});export{ft as default};
