import{x as B,l as ae,r as h,M as T,d as F,s as E,o as V,a as D,b as o,e,f as l,g as r,T as G,k as ie,v as ue,j as Q,h as se,i as de,F as U,t as W}from"./index-DHXQ7Ria.js";import{c as M,L as re,a as me}from"./copy-haZ0Ygex.js";import{G as L,f as I,b as pe}from"./format-Cqa4hYXu.js";import{u as ce}from"./useCommonStore-CN0jOakk.js";import{O as Z,S as ee,T as _e}from"./index-s-4RqYxf.js";import{F as O,a as Y}from"./index-CaGtdN7j.js";import{I as N,S as P,C as fe}from"./index-CcZbOF0C.js";import{I as te}from"./index-DDWfR_cy.js";import{B as R}from"./useResizeObserver-B6vL9CAv.js";import{D as j}from"./index-DezHTrFh.js";import{V as ge,D as ke}from"./validates-F8kGFd3x.js";import{S as le}from"./index-BPIL9y4p.js";import{T as ye}from"./index-C7ocfl3I.js";import{D as ve,a as be}from"./index-DzTvkFsX.js";import{T as we}from"./index-yl2bWJuX.js";import"./dep-d2ce4e2b-CXntoJY8.js";import"./useVirtualScrollNew-DsGbtd_P.js";import"./fake-arrow-CK8q4RJJ.js";import"./add-CAJKYjP1.js";import"./dep-4a07c5ff-CUniQyBf.js";import"./helper-93ZXRMB9.js";const Ve=f=>B.request("get","/admin/token",{params:f}),Se=f=>B.request("post","/admin/token",{data:f}),X=f=>B.request("patch","/admin/token",{data:f}),Ce=f=>B.request("delete","/admin/token",{data:f}),$=ae("tokens",()=>{const[f,s,p,n]=ce(Ve,()=>{_.value=[],y.value=[]},{keyword:""}),_=h([]),y=h([]),S=(w,K)=>{_.value=w,y.value=K.selectedRowData},a=h(!1),t=()=>a.value=!0,d=()=>a.value=!1,u=h({count:100,size:1e3,day:100,can_use_ip_count:5,type:"generate",generate_count:10}),g=async()=>{await Se({...u.value,size:u.value.size*L}),T.success("添加成功"),await n()},m=h(!1),v=()=>m.value=!0,C=()=>m.value=!1,b=h({id:[],switch:!0,reason:"手动操作"}),k=async()=>{if(_.value.length===0)return T.error("请选择卡密");await X({...b.value,id:_.value}),T.success(`${b.value.switch?"启用":"禁用"}成功`),await n()},c=async()=>{if(_.value.length===0)return T.error("请选择卡密");await Ce({id:_.value}),_.value=[],T.success("删除成功"),await n()},q=h(!1),i=h({id:[],count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0});return{tokenList:p,pagination:s,selectReq:f,getTokens:n,selectedRowKeys:_,handleSelectChange:S,isAddingToken:a,showAddingTokenDialog:t,hideAddingTokenDialog:d,addingTokenReq:u,addToken:g,isUpdateSwitchDialog:m,showUpdateSwitchDialog:v,hideUpdateSwitchDialog:C,updateSwitchReq:b,updateSwitchSelection:k,deleteSelection:c,isEditDialog:q,updateReq:i,showEditDialog:(w,K)=>{if(w&&K?(w.stopPropagation(),i.value.id=[K]):i.value={id:_.value,count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0},i.value.id.length===1){const A=p.value.find(ne=>ne.id===i.value.id[0]);A&&(i.value={...A,size:A.size/L,id:i.value.id})}q.value=!0},hideEditDialog:()=>q.value=!1,updateSelection:async()=>{if(i.value.id.length===0)return T.error("请选择卡密");await X({...i.value,size:(i.value.size??0)*L,token:i.value.id.length===1&&i.value.token==="guest"?void 0:i.value.token}),T.success("更新成功~"),await n()},copySelection:()=>{M(y.value.map(w=>`${w.token} | ${I(w.size)} | ${w.count} 次 | ${w.day} 天`).join(`
`))},copySelectionNoFormat:()=>{M(y.value.map(w=>w.token).join(`
`))}}}),De=F({__name:"AddToken",setup(f){const s=$(),{isAddingToken:p,addingTokenReq:n}=E(s),_={token:[{required:!0,message:"卡密不能为空"}],generate_count:[{required:!0,message:"生成数量不能为空"}],count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},y=async({validateResult:S})=>{S===!0&&(await s.addToken(),s.hideAddingTokenDialog())};return(S,a)=>{const t=Z,d=ee,u=O,g=N,m=te,v=R,C=P,b=Y,k=j;return V(),D(k,{visible:l(p),"onUpdate:visible":a[7]||(a[7]=c=>G(p)?p.value=c:null),header:"添加卡密",footer:!1},{default:o(()=>[e(b,{onSubmit:y,data:l(n),rules:_},{default:o(()=>[e(u,{name:"type",label:"添加方式"},{default:o(()=>[e(d,{modelValue:l(n).type,"onUpdate:modelValue":a[0]||(a[0]=c=>l(n).type=c)},{default:o(()=>[e(t,{label:"手动添加",value:"set"}),e(t,{label:"自动添加",value:"generate"})]),_:1},8,["modelValue"])]),_:1}),l(n).type==="set"?(V(),D(u,{key:0,name:"token",label:"卡密"},{default:o(()=>[e(g,{modelValue:l(n).token,"onUpdate:modelValue":a[1]||(a[1]=c=>l(n).token=c)},null,8,["modelValue"])]),_:1})):(V(),D(u,{key:1,name:"generate_count",label:"生成数量"},{default:o(()=>[e(m,{min:1,modelValue:l(n).generate_count,"onUpdate:modelValue":a[2]||(a[2]=c=>l(n).generate_count=c)},null,8,["modelValue"])]),_:1})),e(u,{name:"count",label:"次数配额"},{default:o(()=>[e(m,{min:1,modelValue:l(n).count,"onUpdate:modelValue":a[3]||(a[3]=c=>l(n).count=c)},null,8,["modelValue"])]),_:1}),e(u,{name:"size",label:"大小配额(GB)"},{default:o(()=>[e(m,{min:1,modelValue:l(n).size,"onUpdate:modelValue":a[4]||(a[4]=c=>l(n).size=c)},null,8,["modelValue"])]),_:1}),e(u,{name:"day",label:"时间配额"},{default:o(()=>[e(m,{min:1,modelValue:l(n).day,"onUpdate:modelValue":a[5]||(a[5]=c=>l(n).day=c)},null,8,["modelValue"])]),_:1}),e(u,{name:"can_use_ip_count",label:"IP配额"},{default:o(()=>[e(m,{min:1,modelValue:l(n).can_use_ip_count,"onUpdate:modelValue":a[6]||(a[6]=c=>l(n).can_use_ip_count=c)},null,8,["modelValue"])]),_:1}),e(u,null,{default:o(()=>[e(C,{size:"small"},{default:o(()=>[e(v,{theme:"default",onClick:l(s).hideUpdateSwitchDialog},{default:o(()=>a[8]||(a[8]=[r(" 取消 ")])),_:1},8,["onClick"]),e(v,{type:"submit"},{default:o(()=>a[9]||(a[9]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ze=F({__name:"UpdateToken",setup(f){const s=$(),{isEditDialog:p,updateReq:n}=E(s),_={count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},y=async({validateResult:a})=>{a===!0&&(await s.updateSelection(),s.hideEditDialog())},S=(a,t)=>{if(!(!t.item||typeof t.item=="number")){if(!ge(t.item)){T.error("请输入正确的 ip 地址");return}n.value.ip=a}};return(a,t)=>{const d=N,u=O,g=te,m=_e,v=ke,C=le,b=R,k=P,c=Y,q=j;return V(),D(q,{visible:l(p),"onUpdate:visible":t[8]||(t[8]=i=>G(p)?p.value=i:null),header:"更新卡密",footer:!1},{default:o(()=>[e(c,{onSubmit:y,data:l(n),rules:_},{default:o(()=>[l(n).id.length===1&&l(n).token!=="guest"?(V(),D(u,{key:0,name:"token",label:"卡密"},{default:o(()=>[e(d,{modelValue:l(n).token,"onUpdate:modelValue":t[0]||(t[0]=i=>l(n).token=i)},null,8,["modelValue"])]),_:1})):ie("",!0),e(u,{name:"count",label:"次数配额"},{default:o(()=>[e(g,{min:1,modelValue:l(n).count,"onUpdate:modelValue":t[1]||(t[1]=i=>l(n).count=i)},null,8,["modelValue"])]),_:1}),e(u,{name:"size",label:"大小配额(GB)"},{default:o(()=>[e(g,{min:1,modelValue:l(n).size,"onUpdate:modelValue":t[2]||(t[2]=i=>l(n).size=i)},null,8,["modelValue"])]),_:1}),e(u,{name:"day",label:"时间配额"},{default:o(()=>[e(g,{min:1,modelValue:l(n).day,"onUpdate:modelValue":t[3]||(t[3]=i=>l(n).day=i)},null,8,["modelValue"])]),_:1}),e(u,{name:"can_use_ip_count",label:"IP配额"},{default:o(()=>[e(g,{min:1,modelValue:l(n).can_use_ip_count,"onUpdate:modelValue":t[4]||(t[4]=i=>l(n).can_use_ip_count=i)},null,8,["modelValue"])]),_:1}),e(u,{name:"ip",label:"已绑IP",help:"回车添加"},{default:o(()=>[e(m,{value:l(n).ip,onChange:S},null,8,["value"])]),_:1}),e(u,{name:"expires_at",label:"过期时间"},{default:o(()=>[e(v,{modelValue:l(n).expires_at,"onUpdate:modelValue":t[5]||(t[5]=i=>l(n).expires_at=i),"enable-time-picker":"","allow-input":"",clearable:"",format:"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue"])]),_:1}),e(u,{name:"switch",label:"启用"},{default:o(()=>[e(C,{modelValue:l(n).switch,"onUpdate:modelValue":t[6]||(t[6]=i=>l(n).switch=i)},null,8,["modelValue"])]),_:1}),e(u,{name:"reason",label:"原因"},{default:o(()=>[e(d,{modelValue:l(n).reason,"onUpdate:modelValue":t[7]||(t[7]=i=>l(n).reason=i)},null,8,["modelValue"])]),_:1}),e(u,{label:"选中的卡密"},{default:o(()=>[e(d,{value:JSON.stringify(l(n).id),disabled:""},null,8,["value"])]),_:1}),e(u,null,{default:o(()=>[e(k,{size:"small"},{default:o(()=>[e(b,{theme:"default",onClick:l(s).hideEditDialog},{default:o(()=>t[9]||(t[9]=[r(" 取消 ")])),_:1},8,["onClick"]),e(b,{type:"submit"},{default:o(()=>t[10]||(t[10]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),Ue=F({__name:"UpdateSwitch",setup(f){const s=$(),{isUpdateSwitchDialog:p,updateSwitchReq:n,selectedRowKeys:_}=E(s),y={},S=async({validateResult:a})=>{a===!0&&(await s.updateSwitchSelection(),s.hideUpdateSwitchDialog())};return(a,t)=>{const d=le,u=O,g=N,m=R,v=P,C=Y,b=j;return V(),D(b,{visible:l(p),"onUpdate:visible":t[2]||(t[2]=k=>G(p)?p.value=k:null),header:"启用/禁用卡密",footer:!1},{default:o(()=>[e(C,{onSubmit:S,data:l(n),rules:y},{default:o(()=>[e(u,{label:"启用",name:"switch"},{default:o(()=>[e(d,{modelValue:l(n).switch,"onUpdate:modelValue":t[0]||(t[0]=k=>l(n).switch=k)},null,8,["modelValue"])]),_:1}),e(u,{label:"原因",name:"reason"},{default:o(()=>[e(g,{modelValue:l(n).reason,"onUpdate:modelValue":t[1]||(t[1]=k=>l(n).reason=k)},null,8,["modelValue"])]),_:1}),e(u,{label:"选中的账号"},{default:o(()=>[e(g,{value:JSON.stringify(l(_)),disabled:""},null,8,["value"])]),_:1}),e(u,null,{default:o(()=>[e(v,{size:"small"},{default:o(()=>[e(m,{theme:"default",onClick:l(s).hideUpdateSwitchDialog},{default:o(()=>t[3]||(t[3]=[r(" 取消 ")])),_:1},8,["onClick"]),e(m,{type:"submit"},{default:o(()=>t[4]||(t[4]=[r(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),he={class:"buttons"},Qe=F({__name:"index",setup(f){const s=$(),{selectReq:p,tokenList:n,pagination:_,selectedRowKeys:y}=E(s);ue(s.getTokens);const S=h([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID"},{colKey:"token",title:"卡密",width:200,ellipsis:!0},{colKey:"switch",title:"状态",cell:(a,{row:t})=>e(U,null,[t.switch?"启用":`禁用 (${t.reason})`]),ellipsis:!0},{colKey:"today_count",title:"今日解析",cell:(a,{row:t})=>e(U,null,[t.today_count,r(" ("),I(t.today_size??0),r(")")]),width:150,ellipsis:!0},{colKey:"total_count",title:"总计解析",cell:(a,{row:t})=>e(U,null,[t.total_count,r(" ("),I(t.total_size??0),r(")")]),width:150,ellipsis:!0},{colKey:"size",title:"大小配额",cell:(a,{row:t})=>e(U,null,[I(t.size)]),width:90,ellipsis:!0},{colKey:"count",title:"次数配额",cell:(a,{row:t})=>e(U,null,[t.count,r(" 次")]),width:90,ellipsis:!0},{colKey:"day",title:"时间配额",cell:(a,{row:t})=>e(U,null,[t.day,r(" 天")]),width:90,ellipsis:!0},{colKey:"can_use_ip_count",title:"IP配额",cell:(a,{row:t})=>e(U,null,[t.can_use_ip_count,r(" 个")]),ellipsis:!0},{colKey:"expires_at",title:"过期时间",cell:(a,{row:t})=>e(U,null,[t.expires_at===null?"未使用":pe(t.expires_at)]),width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(a,{row:t})=>e(R,{theme:"primary",onClick:d=>s.showEditDialog(d,t.id)},{default:()=>[r("编辑")]}),width:90,fixed:"right"}]);return(a,t)=>{const d=Z,u=ee,g=N,m=R,v=P,C=ye,b=me,k=re,c=ve,q=be,i=we,J=fe;return V(),D(J,null,{default:o(()=>[Q("div",he,[e(v,{size:"small"},{default:o(()=>[e(u,{modelValue:l(p).column,"onUpdate:modelValue":t[0]||(t[0]=z=>l(p).column=z),onChange:l(s).getTokens},{default:o(()=>[e(d,{label:"按 id 排序",value:"id"}),e(d,{label:"按 token 排序",value:"token"}),e(d,{label:"按 count 排序",value:"count"}),e(d,{label:"按 size 排序",value:"size"}),e(d,{label:"按 day 排序",value:"day"}),e(d,{label:"按 can_use_ip_count 排序",value:"can_use_ip_count"}),e(d,{label:"按 ip 排序",value:"ip"}),e(d,{label:"按 expires_at 排序",value:"expires_at"}),e(d,{label:"按 created_at 排序",value:"created_at"}),e(d,{label:"按 updated_at 排序",value:"updated_at"}),e(d,{label:"按 deleted_at 排序",value:"deleted_at"})]),_:1},8,["modelValue","onChange"]),e(u,{modelValue:l(p).direction,"onUpdate:modelValue":t[1]||(t[1]=z=>l(p).direction=z),onChange:l(s).getTokens},{default:o(()=>[e(d,{label:"正序",value:"asc"}),e(d,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(g,{modelValue:l(p).keyword,"onUpdate:modelValue":t[2]||(t[2]=z=>l(p).keyword=z),onBlur:l(s).getTokens,placeholder:"请输入需要查询的卡密"},null,8,["modelValue","onBlur"]),e(m,{onClick:l(s).getTokens},{default:o(()=>t[3]||(t[3]=[r(" 刷新列表 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).showAddingTokenDialog},{default:o(()=>t[4]||(t[4]=[r(" 添加卡密 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).deleteSelection},{default:o(()=>t[5]||(t[5]=[r(" 批量删除 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).showUpdateSwitchDialog},{default:o(()=>t[6]||(t[6]=[r(" 批量启用/禁用 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).showEditDialog},{default:o(()=>t[7]||(t[7]=[r(" 批量更新 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).copySelection},{default:o(()=>t[8]||(t[8]=[r(" 批量复制 ")])),_:1},8,["onClick"]),e(m,{onClick:l(s).copySelectionNoFormat},{default:o(()=>t[9]||(t[9]=[r(" 无格式批量复制 ")])),_:1},8,["onClick"])]),_:1})]),e(De),e(Ue),e(ze),e(i,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(n),pagination:l(_),columns:S.value,"select-on-row-click":!0,selectedRowKeys:l(y),onSelectChange:l(s).handleSelectChange},{expandedRow:o(({row:z})=>[e(q,{bordered:"",colon:"",layout:"vertical"},{default:o(()=>[e(c,{label:"已绑定的ip"},{default:o(()=>[z.ip.length===0?(V(),D(C,{key:0,size:"large"},{default:o(()=>t[10]||(t[10]=[r(" 没有绑定的IP ")])),_:1})):(V(),D(k,{key:1,stripe:"",split:"",size:"large"},{default:o(()=>[(V(!0),se(U,null,de(z.ip,(x,H)=>(V(),D(b,{key:x},{default:o(()=>[e(v,{direction:"vertical"},{default:o(()=>[e(v,null,{default:o(()=>[e(C,{size:"large"},{default:o(()=>[r(" 第 "+W(H+1)+" 条 ",1)]),_:2},1024),e(m,{onClick:oe=>l(M)(x)},{default:o(()=>t[11]||(t[11]=[r("复制")])),_:2},1032,["onClick"])]),_:2},1024),Q("p",null,W(x),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{Qe as default};
