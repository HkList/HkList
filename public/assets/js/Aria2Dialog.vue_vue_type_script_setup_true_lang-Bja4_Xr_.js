import{D as $,E as B,h as l,G as q,d as P,H as W,I as G,J as X,K as j,L as z,N as Y,O as K,P as Q,b as A,z as E,Q as Z,R as ee,S as ne,T as oe,U as ae,V as le,W as te,X as re,Y as ie,q as se,M as S,s as ce,o as ue,e as de,g as C,i as g,l as w,j as fe,B as ve,Z as Ce}from"./index-oOsh6Yp-.js";import{I as ge,S as me}from"./index-BhO2Ilwz.js";import{F as pe,a as _e}from"./index-DZkpM1t2.js";/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */function he(){var f=q();return function(u,c){var v;if($(f.props[u]))v=f.props[u](B);else if(f.slots[u])v=f.slots[u]&&f.slots[u](null)[0];else if(c){var o=c[f.props.theme];v=l(o,null,null)}return v}}/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Ie={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(e){return["success","info","warning","error"].includes(e)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Fe=P({name:"TAlert",props:Ie,setup:function(e){var u=W("alert"),c=u.globalConfig,v=u.classPrefix,o=G({CheckCircleFilledIcon:X,CloseIcon:j,ErrorCircleFilledIcon:z,HelpCircleFilledIcon:Y,InfoCircleFilledIcon:K}),k=o.CheckCircleFilledIcon,r=o.CloseIcon,p=o.ErrorCircleFilledIcon,_=o.HelpCircleFilledIcon,s=o.InfoCircleFilledIcon,t=Q("alert"),d=re(),m=he(),i=A(null),h=A(null),y=A(0),I=A(!0),V=A(!0),D=function(){var n={info:s,success:k,warning:p,error:p,question:_},a=m("icon",n);return a?l("div",{class:"".concat(t.value,"__icon")},[a]):null},H=function(){var n=e.close,a=null;return n===!0||n===""?a=l(r,null,null):ae(n)?a=n:a=m("close"),a?l("div",{class:"".concat(t.value,"__close"),onClick:R},[a]):null},J=function(){var n=d("title");return n?l("div",{class:"".concat(t.value,"__title")},[" ",n]):null},L=function(){var n=d("operation");return l("div",{class:"".concat(t.value,"__message")},[M(),n?l("div",{class:"".concat(t.value,"__operation")},[n]):null])},M=function(){var n,a;a=d("default"),a||(a=d("message"));var b=te(a)?a.length:1,x=e.maxLine>0&&e.maxLine<b,N=(n=h.value)===null||n===void 0||(n=n.children[0])===null||n===void 0?void 0:n.offsetHeight;return x&&V.value?(a=a.slice(0,e.maxLine),N&&(h.value.style.height="".concat(y.value,"px"))):x&&N&&(h.value.style.height="".concat(N*(b-e.maxLine)+y.value,"px")),l("div",{class:"".concat(t.value,"__description"),ref:h},[x?a.map(function(U){return l("div",null,[U])}):a,x?l("div",{class:"".concat(t.value,"__collapse"),onClick:function(){V.value=!V.value}},[V.value?c.value.expandText:c.value.collapseText]):null])},O=function(){return l("div",{class:"".concat(t.value,"__content")},[J(),L()])},R=function(n){var a;(a=e.onClose)===null||a===void 0||a.call(e,{e:n}),le(i.value,"".concat(t.value,"--closing"))},T=function(n){var a=n.target===i.value;if(n.propertyName==="opacity"&&a){var b;I.value=!1,(b=e.onClosed)===null||b===void 0||b.call(e,{e:n})}};return E(function(){Z(i.value,"transitionend",T),y.value=h.value.offsetHeight}),ee(function(){ne(i.value,"transitionend",T)}),function(){return l("div",{ref:i,class:["".concat(t.value),"".concat(t.value,"--").concat(e.theme),oe({},"".concat(v.value,"-is-hidden"),!I.value)]},[D(),O(),H()])}}});/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var ye=ie(Fe);const Se=se("aria2Store",()=>{const f=A(!1),e=A({host:"ws://localhost:16800/jsonrpc",token:"JTRWUYMehm2w",dir:""});E(()=>{const s=localStorage.getItem("aria2Config");s&&(e.value=JSON.parse(s))});const u=()=>f.value=!0,c=()=>f.value=!1,v=()=>localStorage.setItem("aria2Config",JSON.stringify(e.value));let o=null;const k=()=>new Promise((s,t)=>{o&&(o.close(),o=null);try{o=new WebSocket(e.value.host),o.onopen=()=>s(o),o.onerror=d=>{S.error("链接到Aria2下载器出错"),t(d)}}catch(d){S.error("链接到Aria2下载器出错"),t(d)}}),r=async(s,t=[])=>((!o||o.readyState!==WebSocket.OPEN)&&(o=await k()),new Promise((d,m)=>{o=o;const i="HkList"+Date.now().toString(),h={jsonrpc:"2.0",method:s,id:i,params:[`token:${e.value.token}`,...t]};o.onmessage=y=>{const I=JSON.parse(y.data);I.id===i&&(I.error?m(I.error):d(I.result))},o.send(JSON.stringify(h))}));return{aria2ConfigDialogVisible:f,showAria2Config:u,hideAria2Config:c,aria2ConfigForm:e,saveAria2Config:v,getAria2Version:async()=>{try{await r("aria2.getVersion"),S.success("测试连接成功")}catch(s){S.success("测试连接失败"),console.log(s)}},addAria2Url:async(s,t,d,m)=>{try{await r("aria2.addUri",[[s],{out:t,dir:e.value.dir===""?null:e.value.dir,header:[`User-Agent: ${d}`],split:m.toString()}]),S.success("发送成功")}catch(i){S.success("发送失败"),console.log(i)}}}}),Ve=P({__name:"Aria2Dialog",setup(f){const e=Se(),{aria2ConfigDialogVisible:u,aria2ConfigForm:c}=ce(e),v={},o=async({validateResult:k})=>{k===!0&&(e.saveAria2Config(),e.hideAria2Config(),S.success("保存成功"))};return(k,r)=>{const p=ge,_=pe,s=ve,t=me,d=_e,m=Ce;return ue(),de(m,{visible:g(u),"onUpdate:visible":r[3]||(r[3]=i=>fe(u)?u.value=i:null),header:"Aria2配置调整",footer:!1},{default:C(()=>[l(d,{data:g(c),rules:v,onSubmit:o},{default:C(()=>[l(_,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:C(()=>[l(p,{modelValue:g(c).host,"onUpdate:modelValue":r[0]||(r[0]=i=>g(c).host=i)},null,8,["modelValue"])]),_:1}),l(_,{label:"密钥",name:"token"},{default:C(()=>[l(p,{modelValue:g(c).token,"onUpdate:modelValue":r[1]||(r[1]=i=>g(c).token=i)},null,8,["modelValue"])]),_:1}),l(_,{label:"保存路径",name:"dir"},{default:C(()=>[l(p,{modelValue:g(c).dir,"onUpdate:modelValue":r[2]||(r[2]=i=>g(c).dir=i)},null,8,["modelValue"])]),_:1}),l(_,null,{default:C(()=>[l(t,{size:"small"},{default:C(()=>[l(s,{theme:"default",onClick:g(e).hideAria2Config},{default:C(()=>r[4]||(r[4]=[w(" 取消 ")])),_:1},8,["onClick"]),l(s,{onClick:g(e).getAria2Version},{default:C(()=>r[5]||(r[5]=[w(" 测试连接 ")])),_:1},8,["onClick"]),l(s,{type:"submit"},{default:C(()=>r[6]||(r[6]=[w(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{ye as A,Ve as _,Se as u};
