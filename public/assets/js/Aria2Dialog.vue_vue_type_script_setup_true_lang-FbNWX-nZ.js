import{p as J,q as j,e as i,v as K,d as O,x as W,y as X,z as Q,A as Y,B as Z,C as ee,D as ne,E as ae,r as _,l as U,G as te,H as le,I as oe,_ as se,J as ie,K as re,L as ce,N as ue,O as de,u as fe,n as q,P as ve,Q as ge,M as k,R as M,S as me,s as pe,o as _e,a as Ce,b as y,f as L,g as G,T as he}from"./index-CPdvGQ7v.js";import{f as we}from"./format-vvy1hSit.js";import{I as ke,S as Fe}from"./index-AWKOBdES.js";import{F as Ie,a as Se}from"./index-DXuSQdNA.js";import{B as ye}from"./useResizeObserver-Aa1wqO5m.js";import{D as Le}from"./index-_-FsC40a.js";/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */function xe(){var l=K();return function(C,m){var h;if(J(l.props[C]))h=l.props[C](j);else if(l.slots[C])h=l.slots[C]&&l.slots[C](null)[0];else if(m){var t=m[l.props.theme];h=i(t,null,null)}return h}}/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var Ae={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(e){return["success","info","warning","error"].includes(e)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var be=O({name:"TAlert",props:Ae,setup:function(e){var C=W("alert"),m=C.globalConfig,h=C.classPrefix,t=X({CheckCircleFilledIcon:Q,CloseIcon:Y,ErrorCircleFilledIcon:Z,HelpCircleFilledIcon:ee,InfoCircleFilledIcon:ne}),S=t.CheckCircleFilledIcon,r=t.CloseIcon,I=t.ErrorCircleFilledIcon,F=t.HelpCircleFilledIcon,x=t.InfoCircleFilledIcon,n=ae("alert"),f=ue(),c=xe(),u=_(null),o=_(null),v=_(0),p=_(!0),w=_(!0),N=function(){var a={info:x,success:S,warning:I,error:I,question:F},s=c("icon",a);return s?i("div",{class:"".concat(n.value,"__icon")},[s]):null},R=function(){var a=e.close,s=null;return a===!0||a===""?s=i(r,null,null):ie(a)?s=a:s=c("close"),s?i("div",{class:"".concat(n.value,"__close"),onClick:$},[s]):null},b=function(){var a=f("title");return a?i("div",{class:"".concat(n.value,"__title")},[" ",a]):null},T=function(){var a=f("operation");return i("div",{class:"".concat(n.value,"__message")},[V(),a?i("div",{class:"".concat(n.value,"__operation")},[a]):null])},V=function(){var a,s;s=f("default"),s||(s=f("message"));var A=ce(s)?s.length:1,P=e.maxLine>0&&e.maxLine<A,z=(a=o.value)===null||a===void 0||(a=a.children[0])===null||a===void 0?void 0:a.offsetHeight;return P&&w.value?(s=s.slice(0,e.maxLine),z&&(o.value.style.height="".concat(v.value,"px"))):P&&z&&(o.value.style.height="".concat(z*(A-e.maxLine)+v.value,"px")),i("div",{class:"".concat(n.value,"__description"),ref:o},[P?s.map(function(E){return i("div",null,[E])}):s,P?i("div",{class:"".concat(n.value,"__collapse"),onClick:function(){w.value=!w.value}},[w.value?m.value.expandText:m.value.collapseText]):null])},D=function(){return i("div",{class:"".concat(n.value,"__content")},[b(),T()])},$=function(a){var s;(s=e.onClose)===null||s===void 0||s.call(e,{e:a}),re(u.value,"".concat(n.value,"--closing"))},g=function(a){var s=a.target===u.value;if(a.propertyName==="opacity"&&s){var A;p.value=!1,(A=e.onClosed)===null||A===void 0||A.call(e,{e:a})}};return U(function(){te(u.value,"transitionend",g),v.value=o.value.offsetHeight}),le(function(){oe(u.value,"transitionend",g)}),function(){return i("div",{ref:u,class:["".concat(n.value),"".concat(n.value,"--").concat(e.theme),se({},"".concat(h.value,"-is-hidden"),!p.value)]},[N(),D(),R()])}}});/**
 * tdesign v1.10.6
 * (c) 2024 tdesign
 * @license MIT
 */var Te=de(be);const B=fe(),Ne=q("fileList",()=>{const l=_({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),e=_(),C=()=>{const o=l.value.dir.split("/");o.pop();const v=o.join("/");return v===""?"/":v},m=async()=>{I.value=[];const o=await ve(l.value);e.value=o.data,l.value.dir!=="/"&&e.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:C(),server_filename:"返回上一层",dlink:""})},h=_({token:localStorage.getItem("token")??"guest"}),t=_({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),S=_(""),r=async()=>{var o,v;try{const p=await ge(h.value);t.value=p.data,S.value="",localStorage.setItem("token",h.value.token)}catch(p){const w=(v=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:v.message;w&&(S.value=w)}},I=_([]),F=_([]),x=(o,v)=>{I.value=o,F.value=v.selectedRowData},n=_({hit_captcha:!1,vcode_str:"",vcode_img:"",vcode_input:""}),f=_(!1),c=_([]);return{GetFileListReq:l,GetFileListRes:e,getFileList:m,GetLimitReq:h,GetLimitRes:t,GetLimitError:S,getLimit:r,selectedRowKeys:I,handleSelectChange:x,getDownloadLinks:async(o,v)=>{var V,D,$;if(f.value)return k.error("正在解析中,请稍后再试"),!1;const{config:p}=B;o&&typeof o!="number"&&v&&(o.stopPropagation(),F.value=[v]);const w=F.value.filter(g=>g&&!g.is_dir);w.length!==F.value.length&&k.warning("暂时不支持解析文件夹");const N=w.filter(g=>g.size>p.min_single_filesize);N.length!==w.length&&k.warning("文件过小不会被解析");const R=N.filter(g=>g.size<p.max_single_filesize);R.length!==N.length&&k.warning("文件过大不会被解析");const b=R;if(b.reduce((g,d)=>g+d.size,0)>p.max_all_filesize){k.error(`单次最多解析${we(p.max_all_filesize)}的文件`);return}if(b.length>p.max_once){k.error(`单次最多解析${p.max_once}个文件`);return}if(b.length===0){k.error("满足要求的文件数量为0");return}try{if(f.value=!0,n.value.hit_captcha=!1,typeof o=="number"){const g=await M({randsk:e.value.randsk,uk:e.value.uk,shareid:e.value.shareid,fs_id:[o],surl:l.value.surl,dir:l.value.dir,pwd:l.value.pwd,token:h.value.token,parse_password:l.value.parse_password,...n.value.hit_captcha?{vcode_str:n.value.vcode_str,vcode_input:n.value.vcode_input}:{}});return k.success("重新解析成功"),g.data}else{const g=[];let d=null;try{for(const a in b){const s=b[a];d&&d.close(),d=await k.loading(`正在解析第${parseFloat(a)+1}个文件:${s.server_filename}`,9999999);const A=await M({randsk:e.value.randsk,uk:e.value.uk,shareid:e.value.shareid,fs_id:[s.fs_id],surl:l.value.surl,dir:l.value.dir,pwd:l.value.pwd,token:h.value.token,parse_password:l.value.parse_password,...n.value.hit_captcha?{vcode_str:n.value.vcode_str,vcode_input:n.value.vcode_input}:{}});g.push(...A.data)}}catch(a){throw d&&d.close(),a}d&&d.close(),k.success("解析成功,下滑查看解析结果"),c.value=g}}catch(g){const d=g;if(($=(D=(V=d==null?void 0:d.response)==null?void 0:V.data)==null?void 0:D.message)!=null&&$.includes("-20")){const a=await me({parse_password:l.value.parse_password});n.value={hit_captcha:!0,...a.data,vcode_input:""}}else k.error("解析可能失败或超时了,请稍后前往历史记录中尝试查询是否成功")}finally{f.value=!1,await r(),await B.getConfig()}},GetDownLoadLinksRes:c,vcode:n}}),H=Ne(),Re=q("aria2",()=>{const l=_(!1),e=_({host:"ws://localhost:16800/jsonrpc",token:"",dir:""});U(()=>{const n=localStorage.getItem("aria2Config");n&&(e.value=JSON.parse(n))});const C=()=>l.value=!0,m=()=>l.value=!1,h=()=>{localStorage.setItem("aria2Config",JSON.stringify(e.value)),t=null};let t=null;const S=()=>new Promise((n,f)=>{t&&(t.close(),t=null);try{t=new WebSocket(e.value.host),t.onopen=()=>n(t),t.onerror=c=>{k.error("链接到Aria2下载器出错"),f(c)}}catch(c){k.error("链接到Aria2下载器出错"),f(c)}}),r=async(n,f=[])=>((!t||t.readyState!==WebSocket.OPEN)&&(t=await S()),new Promise((c,u)=>{t=t;const o="HkList"+Date.now().toString(),v={jsonrpc:"2.0",method:n,id:o,params:[`token:${e.value.token}`,...f]};t.onmessage=p=>{const w=JSON.parse(p.data);w.id===o&&(w.error?u(w.error):c(w.result))},t.send(JSON.stringify(v))})),I=async()=>{await r("aria2.getVersion"),k.success("测试连接成功")},F=async(n,f,c,u)=>{await r("aria2.addUri",[[n],{out:f,dir:e.value.dir===""?null:e.value.dir,header:[`User-Agent: ${c}`],split:u.toString()}]),k.success("添加链接成功")};return{aria2ConfigDialogVisible:l,showAria2Config:C,hideAria2Config:m,aria2ConfigForm:e,saveAria2Config:h,getAria2Version:I,addAria2Url:F,downloadLinks:async(n,f=0)=>{for(const c of n){let u=c.filename;if(c.fs_id&&H.GetFileListRes){const o=H.GetFileListRes.list.find(v=>v.fs_id===c.fs_id);o&&(u=o.path)}await F(c.urls[f],u,c.ua,16)}}}}),Ee=O({__name:"Aria2Dialog",setup(l){const e=Re(),{aria2ConfigDialogVisible:C,aria2ConfigForm:m}=pe(e),h={},t=async({validateResult:S})=>{S===!0&&(e.saveAria2Config(),e.hideAria2Config(),k.success("保存成功"))};return(S,r)=>{const I=ke,F=Ie,x=ye,n=Fe,f=Se,c=Le;return _e(),Ce(c,{visible:L(C),"onUpdate:visible":r[3]||(r[3]=u=>he(C)?C.value=u:null),header:"Aria2配置调整",footer:!1},{default:y(()=>[i(f,{data:L(m),rules:h,onSubmit:t},{default:y(()=>[i(F,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:y(()=>[i(I,{modelValue:L(m).host,"onUpdate:modelValue":r[0]||(r[0]=u=>L(m).host=u)},null,8,["modelValue"])]),_:1}),i(F,{label:"密钥",name:"token"},{default:y(()=>[i(I,{modelValue:L(m).token,"onUpdate:modelValue":r[1]||(r[1]=u=>L(m).token=u)},null,8,["modelValue"])]),_:1}),i(F,{label:"保存路径",name:"dir"},{default:y(()=>[i(I,{modelValue:L(m).dir,"onUpdate:modelValue":r[2]||(r[2]=u=>L(m).dir=u)},null,8,["modelValue"])]),_:1}),i(F,null,{default:y(()=>[i(n,{size:"small"},{default:y(()=>[i(x,{theme:"default",onClick:L(e).hideAria2Config},{default:y(()=>r[4]||(r[4]=[G(" 取消 ")])),_:1},8,["onClick"]),i(x,{onClick:L(e).getAria2Version},{default:y(()=>r[5]||(r[5]=[G(" 测试连接 ")])),_:1},8,["onClick"]),i(x,{type:"submit"},{default:y(()=>r[6]||(r[6]=[G(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{Te as A,Ee as _,Re as a,Ne as u};
