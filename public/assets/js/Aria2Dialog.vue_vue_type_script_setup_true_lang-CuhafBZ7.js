import{x as R,y as $,e as t,z as q,d as T,A as G,B as z,C as W,D as X,E as j,G as K,H as Q,I as Y,r as F,q as D,J as Z,K as ee,L as ne,_ as oe,N as ae,O as le,P as te,Q as re,R as ie,l as se,M as y,s as ce,o as ue,a as de,b as C,f as m,g as V,S as fe}from"./index-DNBdRIqV.js";import{I as ve,S as Ce}from"./index-BbtIi5-D.js";import{F as me,a as ge}from"./index-1_N5pgSu.js";import{B as pe}from"./useResizeObserver--cwdCy-z.js";import{D as _e}from"./index-Z62yMjsR.js";/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */function Ie(){var d=q();return function(u,c){var v;if(R(d.props[u]))v=d.props[u]($);else if(d.slots[u])v=d.slots[u]&&d.slots[u](null)[0];else if(c){var o=c[d.props.theme];v=t(o,null,null)}return v}}/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var he={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(e){return["success","info","warning","error"].includes(e)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Fe=T({name:"TAlert",props:he,setup:function(e){var u=G("alert"),c=u.globalConfig,v=u.classPrefix,o=z({CheckCircleFilledIcon:W,CloseIcon:X,ErrorCircleFilledIcon:j,HelpCircleFilledIcon:K,InfoCircleFilledIcon:Q}),S=o.CheckCircleFilledIcon,r=o.CloseIcon,_=o.ErrorCircleFilledIcon,g=o.HelpCircleFilledIcon,k=o.InfoCircleFilledIcon,a=Y("alert"),i=re(),f=Ie(),s=F(null),I=F(null),b=F(0),x=F(!0),p=F(!0),E=function(){var n={info:k,success:S,warning:_,error:_,question:g},l=f("icon",n);return l?t("div",{class:"".concat(a.value,"__icon")},[l]):null},H=function(){var n=e.close,l=null;return n===!0||n===""?l=t(r,null,null):ae(n)?l=n:l=f("close"),l?t("div",{class:"".concat(a.value,"__close"),onClick:M},[l]):null},O=function(){var n=i("title");return n?t("div",{class:"".concat(a.value,"__title")},[" ",n]):null},U=function(){var n=i("operation");return t("div",{class:"".concat(a.value,"__message")},[B(),n?t("div",{class:"".concat(a.value,"__operation")},[n]):null])},B=function(){var n,l;l=i("default"),l||(l=i("message"));var A=te(l)?l.length:1,w=e.maxLine>0&&e.maxLine<A,N=(n=I.value)===null||n===void 0||(n=n.children[0])===null||n===void 0?void 0:n.offsetHeight;return w&&p.value?(l=l.slice(0,e.maxLine),N&&(I.value.style.height="".concat(b.value,"px"))):w&&N&&(I.value.style.height="".concat(N*(A-e.maxLine)+b.value,"px")),t("div",{class:"".concat(a.value,"__description"),ref:I},[w?l.map(function(P){return t("div",null,[P])}):l,w?t("div",{class:"".concat(a.value,"__collapse"),onClick:function(){p.value=!p.value}},[p.value?c.value.expandText:c.value.collapseText]):null])},J=function(){return t("div",{class:"".concat(a.value,"__content")},[O(),U()])},M=function(n){var l;(l=e.onClose)===null||l===void 0||l.call(e,{e:n}),le(s.value,"".concat(a.value,"--closing"))},L=function(n){var l=n.target===s.value;if(n.propertyName==="opacity"&&l){var A;x.value=!1,(A=e.onClosed)===null||A===void 0||A.call(e,{e:n})}};return D(function(){Z(s.value,"transitionend",L),b.value=I.value.offsetHeight}),ee(function(){ne(s.value,"transitionend",L)}),function(){return t("div",{ref:s,class:["".concat(a.value),"".concat(a.value,"--").concat(e.theme),oe({},"".concat(v.value,"-is-hidden"),!x.value)]},[E(),J(),H()])}}});/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var we=ie(Fe);const Se=se("aria2",()=>{const d=F(!1),e=F({host:"http://localhost:16800/jsonrpc",token:"",dir:""});D(()=>{const a=localStorage.getItem("aria2Config");a&&(e.value=JSON.parse(a))});const u=()=>d.value=!0,c=()=>d.value=!1,v=()=>localStorage.setItem("aria2Config",JSON.stringify(e.value));let o=null;const S=()=>new Promise((a,i)=>{o&&(o.close(),o=null);try{o=new WebSocket(e.value.host),o.onopen=()=>a(o),o.onerror=f=>{y.error("链接到Aria2下载器出错"),i(f)}}catch(f){y.error("链接到Aria2下载器出错"),i(f)}}),r=async(a,i=[])=>((!o||o.readyState!==WebSocket.OPEN)&&(o=await S()),new Promise((f,s)=>{o=o;const I="HkList"+Date.now().toString(),b={jsonrpc:"2.0",method:a,id:I,params:[`token:${e.value.token}`,...i]};o.onmessage=x=>{const p=JSON.parse(x.data);p.id===I&&(p.error?s(p.error):f(p.result))},o.send(JSON.stringify(b))})),_=async()=>{await r("aria2.getVersion"),y.success("测试连接成功")},g=async(a,i,f,s)=>{await r("aria2.addUri",[[a],{out:i,dir:e.value.dir===""?null:e.value.dir,header:[`User-Agent: ${f}`],split:s.toString()}]),y.success("添加链接成功")};return{aria2ConfigDialogVisible:d,showAria2Config:u,hideAria2Config:c,aria2ConfigForm:e,saveAria2Config:v,getAria2Version:_,addAria2Url:g,downloadLinks:async a=>{for(const i of a)await g(i.urls[0],i.filename,i.ua,16)}}}),Ne=T({__name:"Aria2Dialog",setup(d){const e=Se(),{aria2ConfigDialogVisible:u,aria2ConfigForm:c}=ce(e),v={},o=async({validateResult:S})=>{S===!0&&(e.saveAria2Config(),e.hideAria2Config(),y.success("保存成功"))};return(S,r)=>{const _=ve,g=me,k=pe,a=Ce,i=ge,f=_e;return ue(),de(f,{visible:m(u),"onUpdate:visible":r[3]||(r[3]=s=>fe(u)?u.value=s:null),header:"Aria2配置调整",footer:!1},{default:C(()=>[t(i,{data:m(c),rules:v,onSubmit:o},{default:C(()=>[t(g,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:C(()=>[t(_,{modelValue:m(c).host,"onUpdate:modelValue":r[0]||(r[0]=s=>m(c).host=s)},null,8,["modelValue"])]),_:1}),t(g,{label:"密钥",name:"token"},{default:C(()=>[t(_,{modelValue:m(c).token,"onUpdate:modelValue":r[1]||(r[1]=s=>m(c).token=s)},null,8,["modelValue"])]),_:1}),t(g,{label:"保存路径",name:"dir"},{default:C(()=>[t(_,{modelValue:m(c).dir,"onUpdate:modelValue":r[2]||(r[2]=s=>m(c).dir=s)},null,8,["modelValue"])]),_:1}),t(g,null,{default:C(()=>[t(a,{size:"small"},{default:C(()=>[t(k,{theme:"default",onClick:m(e).hideAria2Config},{default:C(()=>r[4]||(r[4]=[V(" 取消 ")])),_:1},8,["onClick"]),t(k,{onClick:m(e).getAria2Version},{default:C(()=>r[5]||(r[5]=[V(" 测试连接 ")])),_:1},8,["onClick"]),t(k,{type:"submit"},{default:C(()=>r[6]||(r[6]=[V(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{we as A,Ne as _,Se as u};
