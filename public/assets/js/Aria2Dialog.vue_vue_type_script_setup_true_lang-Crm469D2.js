import{z as B,A as $,f as l,B as q,d as U,C as G,D as W,E as j,G as z,H as X,I as K,J as Q,K as Y,r as A,x as D,L as Z,N as ee,O as ne,_ as oe,P as ae,Q as le,R as te,S as re,T as ie,n as se,M as S,s as ce,o as ue,a as de,e as C,g as m,j as w,i as fe}from"./index-C5Ad9MSy.js";import{I as ve,B as Ce,S as me}from"./index-CvhmcSF0.js";import{F as ge,a as pe}from"./index-BpxvjsB1.js";import{D as _e}from"./index-Dk0M-TCo.js";/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */function he(){var f=q();return function(u,c){var v;if(B(f.props[u]))v=f.props[u]($);else if(f.slots[u])v=f.slots[u]&&f.slots[u](null)[0];else if(c){var o=c[f.props.theme];v=l(o,null,null)}return v}}/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Ie={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(e){return["success","info","warning","error"].includes(e)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var Fe=U({name:"TAlert",props:Ie,setup:function(e){var u=G("alert"),c=u.globalConfig,v=u.classPrefix,o=W({CheckCircleFilledIcon:j,CloseIcon:z,ErrorCircleFilledIcon:X,HelpCircleFilledIcon:K,InfoCircleFilledIcon:Q}),k=o.CheckCircleFilledIcon,r=o.CloseIcon,p=o.ErrorCircleFilledIcon,_=o.HelpCircleFilledIcon,s=o.InfoCircleFilledIcon,t=Y("alert"),d=re(),g=he(),i=A(null),h=A(null),b=A(0),I=A(!0),x=A(!0),E=function(){var n={info:s,success:k,warning:p,error:p,question:_},a=g("icon",n);return a?l("div",{class:"".concat(t.value,"__icon")},[a]):null},H=function(){var n=e.close,a=null;return n===!0||n===""?a=l(r,null,null):ae(n)?a=n:a=g("close"),a?l("div",{class:"".concat(t.value,"__close"),onClick:R},[a]):null},J=function(){var n=d("title");return n?l("div",{class:"".concat(t.value,"__title")},[" ",n]):null},L=function(){var n=d("operation");return l("div",{class:"".concat(t.value,"__message")},[M(),n?l("div",{class:"".concat(t.value,"__operation")},[n]):null])},M=function(){var n,a;a=d("default"),a||(a=d("message"));var y=te(a)?a.length:1,N=e.maxLine>0&&e.maxLine<y,V=(n=h.value)===null||n===void 0||(n=n.children[0])===null||n===void 0?void 0:n.offsetHeight;return N&&x.value?(a=a.slice(0,e.maxLine),V&&(h.value.style.height="".concat(b.value,"px"))):N&&V&&(h.value.style.height="".concat(V*(y-e.maxLine)+b.value,"px")),l("div",{class:"".concat(t.value,"__description"),ref:h},[N?a.map(function(P){return l("div",null,[P])}):a,N?l("div",{class:"".concat(t.value,"__collapse"),onClick:function(){x.value=!x.value}},[x.value?c.value.expandText:c.value.collapseText]):null])},O=function(){return l("div",{class:"".concat(t.value,"__content")},[J(),L()])},R=function(n){var a;(a=e.onClose)===null||a===void 0||a.call(e,{e:n}),le(i.value,"".concat(t.value,"--closing"))},T=function(n){var a=n.target===i.value;if(n.propertyName==="opacity"&&a){var y;I.value=!1,(y=e.onClosed)===null||y===void 0||y.call(e,{e:n})}};return D(function(){Z(i.value,"transitionend",T),b.value=h.value.offsetHeight}),ee(function(){ne(i.value,"transitionend",T)}),function(){return l("div",{ref:i,class:["".concat(t.value),"".concat(t.value,"--").concat(e.theme),oe({},"".concat(v.value,"-is-hidden"),!I.value)]},[E(),O(),H()])}}});/**
 * tdesign v1.10.4
 * (c) 2024 tdesign
 * @license MIT
 */var xe=ie(Fe);const Se=se("aria2Store",()=>{const f=A(!1),e=A({host:"ws://localhost:16800/jsonrpc",token:"JTRWUYMehm2w",dir:""});D(()=>{const s=localStorage.getItem("aria2Config");s&&(e.value=JSON.parse(s))});const u=()=>f.value=!0,c=()=>f.value=!1,v=()=>localStorage.setItem("aria2Config",JSON.stringify(e.value));let o=null;const k=()=>new Promise((s,t)=>{o&&(o.close(),o=null);try{o=new WebSocket(e.value.host),o.onopen=()=>s(o),o.onerror=d=>{S.error("链接到Aria2下载器出错"),t(d)}}catch(d){S.error("链接到Aria2下载器出错"),t(d)}}),r=async(s,t=[])=>((!o||o.readyState!==WebSocket.OPEN)&&(o=await k()),new Promise((d,g)=>{o=o;const i="HkList"+Date.now().toString(),h={jsonrpc:"2.0",method:s,id:i,params:[`token:${e.value.token}`,...t]};o.onmessage=b=>{const I=JSON.parse(b.data);I.id===i&&(I.error?g(I.error):d(I.result))},o.send(JSON.stringify(h))}));return{aria2ConfigDialogVisible:f,showAria2Config:u,hideAria2Config:c,aria2ConfigForm:e,saveAria2Config:v,getAria2Version:async()=>{try{await r("aria2.getVersion"),S.success("测试连接成功")}catch(s){S.success("测试连接失败"),console.log(s)}},addAria2Url:async(s,t,d,g)=>{try{await r("aria2.addUri",[[s],{out:t,dir:e.value.dir===""?null:e.value.dir,header:[`User-Agent: ${d}`],split:g.toString()}]),S.success("发送成功")}catch(i){S.success("发送失败"),console.log(i)}}}}),Ne=U({__name:"Aria2Dialog",setup(f){const e=Se(),{aria2ConfigDialogVisible:u,aria2ConfigForm:c}=ce(e),v={},o=async({validateResult:k})=>{k===!0&&(e.saveAria2Config(),e.hideAria2Config(),S.success("保存成功"))};return(k,r)=>{const p=ve,_=ge,s=Ce,t=me,d=pe,g=_e;return ue(),de(g,{visible:m(u),"onUpdate:visible":r[3]||(r[3]=i=>fe(u)?u.value=i:null),header:"Aria2配置调整",footer:!1},{default:C(()=>[l(d,{data:m(c),rules:v,onSubmit:o},{default:C(()=>[l(_,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:C(()=>[l(p,{modelValue:m(c).host,"onUpdate:modelValue":r[0]||(r[0]=i=>m(c).host=i)},null,8,["modelValue"])]),_:1}),l(_,{label:"密钥",name:"token"},{default:C(()=>[l(p,{modelValue:m(c).token,"onUpdate:modelValue":r[1]||(r[1]=i=>m(c).token=i)},null,8,["modelValue"])]),_:1}),l(_,{label:"保存路径",name:"dir"},{default:C(()=>[l(p,{modelValue:m(c).dir,"onUpdate:modelValue":r[2]||(r[2]=i=>m(c).dir=i)},null,8,["modelValue"])]),_:1}),l(_,null,{default:C(()=>[l(t,{size:"small"},{default:C(()=>[l(s,{theme:"default",onClick:m(e).hideAria2Config},{default:C(()=>r[4]||(r[4]=[w(" 取消 ")])),_:1},8,["onClick"]),l(s,{onClick:m(e).getAria2Version},{default:C(()=>r[5]||(r[5]=[w(" 测试连接 ")])),_:1},8,["onClick"]),l(s,{type:"submit"},{default:C(()=>r[6]||(r[6]=[w(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{xe as A,Ne as _,Se as u};
