import{h as K,Y as X,j as D,M as C,d as E,s as B,o as U,a as z,w as n,b as e,e as l,g as p,i as M,a0 as Z,l as ee,f as q,t as te,$ as h}from"./index-D_e8F7w3.js";import{G as A,b as I,a as N}from"./format-BfWQo8TN.js";import{u as le,T as oe}from"./useCommonStore-yXH10JG6.js";import{O as H,S as L,T as ne}from"./index-BOGHR9gk.js";import{F as $,a as O}from"./index-Bo65_XdH.js";import{I as G,B as x,S as F}from"./form-model-B5UeREqF.js";import{I as j}from"./index-D8YBBlIp.js";import{D as J}from"./index-B2QByeB2.js";import{D as ae}from"./index-T1I-gFZs.js";import{S as Q}from"./index-CdbolhUg.js";import{C as ie}from"./index-D2qLX_da.js";import"./fake-arrow-B67j7q7r.js";import"./useResizeObserver-DpG4jxLQ.js";import"./dep-0df090f8-Cb_6GBHN.js";import"./helper-Csse-oO9.js";import"./add-CMcXD9Sx.js";const ue=c=>K.request("get","/admin/token",{params:c}),se=c=>K.request("post","/admin/token",{data:c}),de=c=>K.request("patch","/admin/token",{data:c}),re=c=>K.request("patch","/admin/token/switch",{data:c}),me=c=>K.request("delete","/admin/token",{data:c}),P=X("tokens",()=>{const[c,u,r,o]=le(ue),f=D([]),S=(R,Y)=>{f.value=R},b=D(!1),a=()=>b.value=!0,t=()=>b.value=!1,s=D({count:100,size:1e3,day:100,can_use_ip_count:5,type:"generate",generate_count:10}),i=async()=>{await se({...s.value,size:s.value.size*A}),C.success("添加成功"),await o()},m=D(!1),g=()=>m.value=!0,V=()=>m.value=!1,w=D({id:[],switch:!0,reason:"手动操作"}),y=async()=>{if(f.value.length===0)return C.error("请选择账号");await re({...w.value,id:f.value}),C.success(`${w.value.switch?"启用":"禁用"}成功`),await o()},v=async()=>{if(f.value.length===0)return C.error("请选择账号");await me({id:f.value}),C.success("删除成功"),await o()},d=D(!1),k=D({id:[],count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0});return{tokenList:r,pagination:u,selectReq:c,getTokens:o,selectedRowKeys:f,handleSelectChange:S,isAddingToken:b,showAddingTokenDialog:a,hideAddingTokenDialog:t,addingTokenReq:s,addToken:i,isUpdateSwitchDialog:m,showUpdateSwitchDialog:g,hideUpdateSwitchDialog:V,updateSwitchReq:w,updateSwitchSelection:y,deleteSelection:v,isEditDialog:d,updateReq:k,showEditDialog:(R,Y)=>{if(R&&Y?(R.stopPropagation(),k.value.id=[Y]):k.value={id:f.value,count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0},k.value.id.length===1){const T=r.value.find(W=>W.id===k.value.id[0]);T&&(k.value={...T,expires_at:T.expires_at?I(T.expires_at,"YYYY-MM-DD HH:mm:ss"):null,size:T.size/A,id:k.value.id})}d.value=!0},hideEditDialog:()=>d.value=!1,updateSelection:async()=>{if(k.value.id.length===0)return C.error("请选择账号");await de({...k.value,size:k.value.size*A}),C.success("更新成功~"),await o()}}}),pe=E({__name:"AddToken",setup(c){const u=P(),{isAddingToken:r,addingTokenReq:o}=B(u),f={token:[{required:!0,message:"卡密不能为空"}],generate_count:[{required:!0,message:"生成数量不能为空"}],count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},S=async({validateResult:b})=>{b===!0&&(await u.addToken(),u.hideAddingTokenDialog())};return(b,a)=>{const t=H,s=L,i=$,m=G,g=j,V=x,w=F,y=O,v=J;return U(),z(v,{visible:l(r),"onUpdate:visible":a[7]||(a[7]=d=>M(r)?r.value=d:null),header:"添加卡密",footer:!1},{default:n(()=>[e(y,{onSubmit:S,data:l(o),rules:f},{default:n(()=>[e(i,{name:"type",label:"添加方式"},{default:n(()=>[e(s,{modelValue:l(o).type,"onUpdate:modelValue":a[0]||(a[0]=d=>l(o).type=d)},{default:n(()=>[e(t,{label:"手动添加",value:"set"}),e(t,{label:"自动添加",value:"generate"})]),_:1},8,["modelValue"])]),_:1}),l(o).type==="set"?(U(),z(i,{key:0,name:"token",label:"卡密"},{default:n(()=>[e(m,{modelValue:l(o).token,"onUpdate:modelValue":a[1]||(a[1]=d=>l(o).token=d)},null,8,["modelValue"])]),_:1})):(U(),z(i,{key:1,name:"generate_count",label:"生成数量"},{default:n(()=>[e(g,{min:1,modelValue:l(o).generate_count,"onUpdate:modelValue":a[2]||(a[2]=d=>l(o).generate_count=d)},null,8,["modelValue"])]),_:1})),e(i,{name:"count",label:"次数配额"},{default:n(()=>[e(g,{min:1,modelValue:l(o).count,"onUpdate:modelValue":a[3]||(a[3]=d=>l(o).count=d)},null,8,["modelValue"])]),_:1}),e(i,{name:"size",label:"大小配额(GB)"},{default:n(()=>[e(g,{min:1,modelValue:l(o).size,"onUpdate:modelValue":a[4]||(a[4]=d=>l(o).size=d)},null,8,["modelValue"])]),_:1}),e(i,{name:"day",label:"时间配额"},{default:n(()=>[e(g,{min:1,modelValue:l(o).day,"onUpdate:modelValue":a[5]||(a[5]=d=>l(o).day=d)},null,8,["modelValue"])]),_:1}),e(i,{name:"can_use_ip_count",label:"IP配额"},{default:n(()=>[e(g,{min:1,modelValue:l(o).can_use_ip_count,"onUpdate:modelValue":a[6]||(a[6]=d=>l(o).can_use_ip_count=d)},null,8,["modelValue"])]),_:1}),e(i,null,{default:n(()=>[e(w,{size:"small"},{default:n(()=>[e(V,{theme:"default",onClick:l(u).hideUpdateSwitchDialog},{default:n(()=>a[8]||(a[8]=[p(" 取消 ")])),_:1},8,["onClick"]),e(V,{theme:"primary",type:"submit"},{default:n(()=>a[9]||(a[9]=[p(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),_e=E({__name:"UpdateToken",setup(c){const u=P(),{isEditDialog:r,updateReq:o}=B(u),f={count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},S=async({validateResult:a})=>{a===!0&&(await u.updateSelection(),u.hideEditDialog())},b=(a,t)=>{if(!(!t.item||typeof t.item=="number"))if(/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/.test(t.item))o.value.ip=a;else{C.error("请输入正确的 ip 地址");return}};return(a,t)=>{const s=G,i=$,m=j,g=ne,V=ae,w=Q,y=x,v=F,d=O,k=J;return U(),z(k,{visible:l(r),"onUpdate:visible":t[8]||(t[8]=_=>M(r)?r.value=_:null),header:"更新卡密",footer:!1},{default:n(()=>[e(d,{onSubmit:S,data:l(o),rules:f},{default:n(()=>[l(o).id.length===1?(U(),z(i,{key:0,name:"token",label:"卡密"},{default:n(()=>[e(s,{modelValue:l(o).token,"onUpdate:modelValue":t[0]||(t[0]=_=>l(o).token=_)},null,8,["modelValue"])]),_:1})):Z("",!0),e(i,{name:"count",label:"次数配额"},{default:n(()=>[e(m,{min:1,modelValue:l(o).count,"onUpdate:modelValue":t[1]||(t[1]=_=>l(o).count=_)},null,8,["modelValue"])]),_:1}),e(i,{name:"size",label:"大小配额(GB)"},{default:n(()=>[e(m,{min:1,modelValue:l(o).size,"onUpdate:modelValue":t[2]||(t[2]=_=>l(o).size=_)},null,8,["modelValue"])]),_:1}),e(i,{name:"day",label:"时间配额"},{default:n(()=>[e(m,{min:1,modelValue:l(o).day,"onUpdate:modelValue":t[3]||(t[3]=_=>l(o).day=_)},null,8,["modelValue"])]),_:1}),e(i,{name:"can_use_ip_count",label:"IP配额"},{default:n(()=>[e(m,{min:1,modelValue:l(o).can_use_ip_count,"onUpdate:modelValue":t[4]||(t[4]=_=>l(o).can_use_ip_count=_)},null,8,["modelValue"])]),_:1}),e(i,{name:"ip",label:"已绑IP",help:"回车添加"},{default:n(()=>[e(g,{value:l(o).ip,onChange:b},null,8,["value"])]),_:1}),e(i,{name:"expires_at",label:"过期时间"},{default:n(()=>[e(V,{modelValue:l(o).expires_at,"onUpdate:modelValue":t[5]||(t[5]=_=>l(o).expires_at=_),"enable-time-picker":"","allow-input":"",clearable:"",format:"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue"])]),_:1}),e(i,{name:"switch",label:"启用"},{default:n(()=>[e(w,{modelValue:l(o).switch,"onUpdate:modelValue":t[6]||(t[6]=_=>l(o).switch=_)},null,8,["modelValue"])]),_:1}),e(i,{name:"reason",label:"原因"},{default:n(()=>[e(s,{modelValue:l(o).reason,"onUpdate:modelValue":t[7]||(t[7]=_=>l(o).reason=_)},null,8,["modelValue"])]),_:1}),e(i,{label:"选中的账号"},{default:n(()=>[e(s,{value:JSON.stringify(l(o).id),disabled:""},null,8,["value"])]),_:1}),e(i,null,{default:n(()=>[e(v,{size:"small"},{default:n(()=>[e(y,{theme:"default",onClick:l(u).hideEditDialog},{default:n(()=>t[9]||(t[9]=[p(" 取消 ")])),_:1},8,["onClick"]),e(y,{theme:"primary",type:"submit"},{default:n(()=>t[10]||(t[10]=[p(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ce=E({__name:"UpdateSwitch",setup(c){const u=P(),{isUpdateSwitchDialog:r,updateSwitchReq:o,selectedRowKeys:f}=B(u),S={},b=async({validateResult:a})=>{a===!0&&(await u.updateSwitchSelection(),u.hideUpdateSwitchDialog())};return(a,t)=>{const s=Q,i=$,m=G,g=x,V=F,w=O,y=J;return U(),z(y,{visible:l(r),"onUpdate:visible":t[2]||(t[2]=v=>M(r)?r.value=v:null),header:"启用/禁用卡密",footer:!1},{default:n(()=>[e(w,{onSubmit:b,data:l(o),rules:S},{default:n(()=>[e(i,{label:"启用",name:"switch"},{default:n(()=>[e(s,{modelValue:l(o).switch,"onUpdate:modelValue":t[0]||(t[0]=v=>l(o).switch=v)},null,8,["modelValue"])]),_:1}),e(i,{label:"原因",name:"reason"},{default:n(()=>[e(m,{modelValue:l(o).reason,"onUpdate:modelValue":t[1]||(t[1]=v=>l(o).reason=v)},null,8,["modelValue"])]),_:1}),e(i,{label:"选中的账号"},{default:n(()=>[e(m,{value:JSON.stringify(l(f)),disabled:""},null,8,["value"])]),_:1}),e(i,null,{default:n(()=>[e(V,{size:"small"},{default:n(()=>[e(g,{theme:"default",onClick:l(u).hideUpdateSwitchDialog},{default:n(()=>t[3]||(t[3]=[p(" 取消 ")])),_:1},8,["onClick"]),e(g,{theme:"primary",type:"submit"},{default:n(()=>t[4]||(t[4]=[p(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),fe={class:"buttons"},ge={class:"more-detail"},Ee=E({__name:"index",setup(c){const u=P(),{selectReq:r,tokenList:o,pagination:f,selectedRowKeys:S}=B(u);ee(u.getTokens);const b=D([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID"},{colKey:"token",title:"卡密",width:200,ellipsis:!0},{colKey:"switch",title:"状态",cell:(a,{row:t})=>e(h,null,[t.switch?"启用":`禁用 (${t.reason})`]),ellipsis:!0},{colKey:"today_count",title:"今日解析",cell:(a,{row:t})=>e(h,null,[t.today_count,p(" ("),N(t.today_size??0),p(")")]),width:150,ellipsis:!0},{colKey:"total_count",title:"总计解析",cell:(a,{row:t})=>e(h,null,[t.total_count,p(" ("),N(t.total_size??0),p(")")]),width:150,ellipsis:!0},{colKey:"size",title:"大小配额",cell:(a,{row:t})=>e(h,null,[N(t.size)]),width:90,ellipsis:!0},{colKey:"count",title:"次数配额",cell:(a,{row:t})=>e(h,null,[t.count,p(" 次")]),width:90,ellipsis:!0},{colKey:"day",title:"时间配额",cell:(a,{row:t})=>e(h,null,[t.day,p(" 天")]),width:90,ellipsis:!0},{colKey:"can_use_ip_count",title:"IP配额",cell:(a,{row:t})=>e(h,null,[t.can_use_ip_count,p(" 个")]),ellipsis:!0},{colKey:"expires_at",title:"过期时间",cell:(a,{row:t})=>e(h,null,[t.expires_at===null?"未使用":I(t.expires_at)]),width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",cell:(a,{row:t})=>e(h,null,[I(t.created_at)]),width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",cell:(a,{row:t})=>e(h,null,[I(t.updated_at)]),width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(a,{row:t})=>e(x,{theme:"primary",onClick:s=>u.showEditDialog(s,t.id)},{default:()=>[p("编辑")]}),width:90,fixed:"right"}]);return(a,t)=>{const s=H,i=L,m=x,g=F,V=oe,w=ie;return U(),z(w,null,{default:n(()=>[q("div",fe,[e(g,{size:"small"},{default:n(()=>[e(i,{modelValue:l(r).column,"onUpdate:modelValue":t[0]||(t[0]=y=>l(r).column=y),onChange:l(u).getTokens},{default:n(()=>[e(s,{label:"按 id 排序",value:"id"}),e(s,{label:"按 token 排序",value:"token"}),e(s,{label:"按 count 排序",value:"count"}),e(s,{label:"按 size 排序",value:"size"}),e(s,{label:"按 day 排序",value:"day"}),e(s,{label:"按 can_use_ip_count 排序",value:"can_use_ip_count"}),e(s,{label:"按 ip 排序",value:"ip"}),e(s,{label:"按 expires_at 排序",value:"expires_at"}),e(s,{label:"按 created_at 排序",value:"created_at"}),e(s,{label:"按 updated_at 排序",value:"updated_at"})]),_:1},8,["modelValue","onChange"]),e(i,{modelValue:l(r).direction,"onUpdate:modelValue":t[1]||(t[1]=y=>l(r).direction=y),onChange:l(u).getTokens},{default:n(()=>[e(s,{label:"正序",value:"asc"}),e(s,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(m,{theme:"primary",onClick:l(u).getTokens},{default:n(()=>t[2]||(t[2]=[p(" 刷新列表 ")])),_:1},8,["onClick"]),e(m,{theme:"primary",onClick:l(u).showAddingTokenDialog},{default:n(()=>t[3]||(t[3]=[p(" 添加卡密 ")])),_:1},8,["onClick"]),e(m,{theme:"danger",onClick:l(u).deleteSelection},{default:n(()=>t[4]||(t[4]=[p(" 批量删除 ")])),_:1},8,["onClick"]),e(m,{theme:"primary",onClick:l(u).showUpdateSwitchDialog},{default:n(()=>t[5]||(t[5]=[p(" 批量启用/禁用 ")])),_:1},8,["onClick"]),e(m,{theme:"primary",onClick:l(u).showEditDialog},{default:n(()=>t[6]||(t[6]=[p(" 批量更新 ")])),_:1},8,["onClick"])]),_:1})]),e(pe),e(ce),e(_e),e(V,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(o),pagination:l(f),columns:b.value,"select-on-row-click":!0,selectedRowKeys:l(S),onSelectChange:l(u).handleSelectChange},{expandedRow:n(({row:y})=>[q("div",ge,[q("ul",null,[t[7]||(t[7]=q("li",null,"已绑定的ip:",-1)),q("li",null,te(JSON.stringify(y.ip)),1)])])]),_:1},8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{Ee as default};
