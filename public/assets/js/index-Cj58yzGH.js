import{h as U,Y as $,j as V,M as w,d as q,s as R,o as S,a as K,w as o,b as e,e as l,Z as H,$ as C,a0 as j,g as k,i as M,l as E,f as J}from"./index-D_e8F7w3.js";import{b as L}from"./format-BfWQo8TN.js";import{u as W,T as Z}from"./useCommonStore-yXH10JG6.js";import{O as A,S as I}from"./index-BOGHR9gk.js";import{F as N,a as z}from"./index-Bo65_XdH.js";import{I as P,B as x,S as Y}from"./form-model-B5UeREqF.js";import{D as G}from"./index-T1I-gFZs.js";import{D as T}from"./index-B2QByeB2.js";import{I as Q}from"./index-D8YBBlIp.js";import{C as X}from"./index-D2qLX_da.js";import"./fake-arrow-B67j7q7r.js";import"./useResizeObserver-DpG4jxLQ.js";import"./dep-0df090f8-Cb_6GBHN.js";import"./helper-Csse-oO9.js";import"./add-CMcXD9Sx.js";const ee=p=>U.request("get","/admin/black_list",{params:p}),te=p=>U.request("post","/admin/black_list",{data:p}),le=p=>U.request("patch","/admin/black_list",{data:p}),ae=p=>U.request("delete","/admin/black_list",{data:p}),F=$("blackLists",()=>{const[p,i,c,n]=W(ee),u=V([]),y=(s,h)=>{u.value=s},f=async()=>{if(u.value.length===0)return w.error("请选择账号");await ae({id:u.value}),w.success("删除成功"),await n()},t=V(!1),a=V({id:[],type:void 0,identifier:void 0,reason:"",expires_at:""}),d=(s,h)=>{if(s&&h?(s.stopPropagation(),a.value.id=[h]):a.value={id:u.value,type:void 0,identifier:void 0,reason:"",expires_at:""},a.value.id.length===1){const D=c.value.find(O=>O.id===a.value.id[0]);D&&(a.value={...D,expires_at:L(D.expires_at??new Date().toISOString(),"YYYY-MM-DD HH:mm:ss"),id:a.value.id})}t.value=!0},r=()=>t.value=!1,m=async()=>{if(a.value.id.length===0)return w.error("请选择账号");await le({...a.value,id:u.value}),w.success("更新成功"),await n()},b=V(!1),_=V({type:"fingerprint",identifier:"",reason:"",ban_days:10});return{pagination:i,selectReq:p,blackList:c,getBlackLists:n,selectedRowKeys:u,handleSelectChange:y,deleteSelection:f,isUpdate:t,updateReq:a,showUpdateDialog:d,hideUpdateDialog:r,updateSelection:m,isAddBlackList:b,addBlackListReq:_,showAddBlackList:()=>b.value=!0,hideAddBlackList:()=>b.value=!1,addBlackList:async()=>{await te(_.value),w.success("插入成功~"),await n()}}}),oe=q({__name:"UpdateBlackList",setup(p){const i=F(),{isUpdate:c,updateReq:n}=R(i),u={reason:[{required:!0,message:"请输入原因"}],expires_at:[{required:!0,message:"请选择到期时间"}]},y=async({validateResult:f})=>{f===!0&&(await i.updateSelection(),i.hideUpdateDialog())};return(f,t)=>{const a=A,d=I,r=N,m=P,b=G,_=x,v=Y,g=z,B=T;return S(),K(B,{visible:l(c),"onUpdate:visible":t[4]||(t[4]=s=>M(c)?c.value=s:null),header:"更新黑名单",footer:!1},{default:o(()=>[e(g,{onSubmit:y,data:l(n),rules:u},{default:o(()=>[l(n).id.length===1?(S(),H(C,{key:0},[e(r,{label:"类型",name:"type"},{default:o(()=>[e(d,{modelValue:l(n).type,"onUpdate:modelValue":t[0]||(t[0]=s=>l(n).type=s)},{default:o(()=>[e(a,{label:"指纹",value:"fingerprint"}),e(a,{label:"IP",value:"ip"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"识别码",name:"identifier"},{default:o(()=>[e(m,{modelValue:l(n).identifier,"onUpdate:modelValue":t[1]||(t[1]=s=>l(n).identifier=s)},null,8,["modelValue"])]),_:1})],64)):j("",!0),e(r,{label:"原因",name:"reason"},{default:o(()=>[e(m,{modelValue:l(n).reason,"onUpdate:modelValue":t[2]||(t[2]=s=>l(n).reason=s)},null,8,["modelValue"])]),_:1}),e(r,{label:"到期时间",name:"expires_at"},{default:o(()=>[e(b,{modelValue:l(n).expires_at,"onUpdate:modelValue":t[3]||(t[3]=s=>l(n).expires_at=s),"enable-time-picker":"","allow-input":"",clearable:"",format:"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue"])]),_:1}),e(r,{label:"选中的账号"},{default:o(()=>[e(m,{value:JSON.stringify(l(n).id),disabled:""},null,8,["value"])]),_:1}),e(r,null,{default:o(()=>[e(v,{size:"small"},{default:o(()=>[e(_,{theme:"default",onClick:l(i).hideUpdateDialog},{default:o(()=>t[5]||(t[5]=[k(" 取消 ")])),_:1},8,["onClick"]),e(_,{theme:"primary",type:"submit"},{default:o(()=>t[6]||(t[6]=[k(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ne=q({__name:"AddBlackList",setup(p){const i=F(),{isAddBlackList:c,addBlackListReq:n}=R(i),u={type:[{required:!0,message:"请选择类型"}],identifier:[{required:!0,message:"请输入识别码"}],reason:[{required:!0,message:"请输入原因"}],ban_days:[{required:!0,message:"请输入封禁天数"}]},y=async({validateResult:f})=>{f===!0&&await i.addBlackList()};return(f,t)=>{const a=A,d=I,r=N,m=P,b=Q,_=x,v=Y,g=z,B=T;return S(),K(B,{visible:l(c),"onUpdate:visible":t[4]||(t[4]=s=>M(c)?c.value=s:null),header:"添加黑名单",footer:!1},{default:o(()=>[e(g,{data:l(n),rules:u,onSubmit:y,labelWidth:130},{default:o(()=>[e(r,{label:"类型",name:"type"},{default:o(()=>[e(d,{modelValue:l(n).type,"onUpdate:modelValue":t[0]||(t[0]=s=>l(n).type=s)},{default:o(()=>[e(a,{label:"指纹",value:"fingerprint"}),e(a,{label:"IP",value:"ip"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"识别码",name:"identifier"},{default:o(()=>[e(m,{modelValue:l(n).identifier,"onUpdate:modelValue":t[1]||(t[1]=s=>l(n).identifier=s)},null,8,["modelValue"])]),_:1}),e(r,{label:"原因",name:"reason"},{default:o(()=>[e(m,{modelValue:l(n).reason,"onUpdate:modelValue":t[2]||(t[2]=s=>l(n).reason=s)},null,8,["modelValue"])]),_:1}),e(r,{label:"封禁天数",name:"ban_days"},{default:o(()=>[e(b,{min:0,modelValue:l(n).ban_days,"onUpdate:modelValue":t[3]||(t[3]=s=>l(n).ban_days=s)},null,8,["modelValue"])]),_:1}),e(r,null,{default:o(()=>[e(v,{size:"small"},{default:o(()=>[e(_,{theme:"default",onClick:l(i).hideAddBlackList},{default:o(()=>t[5]||(t[5]=[k(" 取消 ")])),_:1},8,["onClick"]),e(_,{theme:"primary",type:"submit"},{default:o(()=>t[6]||(t[6]=[k(" 提交 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),se={class:"buttons"},we=q({__name:"index",setup(p){const i=F(),{blackList:c,pagination:n,selectReq:u,selectedRowKeys:y}=R(i);E(i.getBlackLists);const f=V([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID",ellipsis:!0},{colKey:"type",title:"类型",ellipsis:!0},{colKey:"identifier",title:"识别码",ellipsis:!0},{colKey:"reason",title:"原因",ellipsis:!0},{colKey:"expires_at",title:"到期时间",cell:(t,{row:a})=>e(C,null,[L(a.expires_at)]),width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",cell:(t,{row:a})=>e(C,null,[L(a.created_at)]),width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",cell:(t,{row:a})=>e(C,null,[L(a.updated_at)]),width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(t,{row:a})=>e(x,{theme:"primary",onClick:d=>i.showUpdateDialog(d,a.id)},{default:()=>[k("编辑")]}),width:90,fixed:"right"}]);return(t,a)=>{const d=A,r=I,m=x,b=Y,_=Z,v=X;return S(),K(v,null,{default:o(()=>[J("div",se,[e(b,{size:"small"},{default:o(()=>[e(r,{modelValue:l(u).column,"onUpdate:modelValue":a[0]||(a[0]=g=>l(u).column=g),onChange:l(i).getBlackLists},{default:o(()=>[e(d,{label:"按 id 排序",value:"id"}),e(d,{label:"按 type 排序",value:"type"}),e(d,{label:"按 identifier 排序",value:"identifier"}),e(d,{label:"按 reason 排序",value:"reason"}),e(d,{label:"按 expires_at 排序",value:"expires_at"}),e(d,{label:"按 created_at 排序",value:"created_at"}),e(d,{label:"按 updated_at 排序",value:"updated_at"})]),_:1},8,["modelValue","onChange"]),e(r,{modelValue:l(u).direction,"onUpdate:modelValue":a[1]||(a[1]=g=>l(u).direction=g),onChange:l(i).getBlackLists},{default:o(()=>[e(d,{label:"正序",value:"asc"}),e(d,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(m,{theme:"primary",onClick:l(i).getBlackLists},{default:o(()=>a[2]||(a[2]=[k(" 刷新列表 ")])),_:1},8,["onClick"]),e(m,{theme:"primary",onClick:l(i).showAddBlackList},{default:o(()=>a[3]||(a[3]=[k(" 添加黑名单 ")])),_:1},8,["onClick"]),e(m,{theme:"danger",onClick:l(i).deleteSelection},{default:o(()=>a[4]||(a[4]=[k(" 删除选中黑名单 ")])),_:1},8,["onClick"]),e(m,{theme:"primary",onClick:l(i).showUpdateDialog},{default:o(()=>a[5]||(a[5]=[k(" 更新黑名单 ")])),_:1},8,["onClick"])]),_:1})]),e(ne),e(oe),e(_,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(c),pagination:l(n),columns:f.value,"select-on-row-click":!0,selectedRowKeys:l(y),onSelectChange:l(i).handleSelectChange},null,8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{we as default};
