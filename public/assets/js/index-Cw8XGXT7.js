import{d as I,u as H,s as T,f as t,o as x,a as K,b as s,j as z,k as U,l as le,r as w,m as se,n as ae,M as R,p as oe,q as ne,v as ie,e,g as C,t as A,h as E,F as D,w as re,i as ue}from"./index-BJG0daiy.js";import{C as N,S as Y,I as de}from"./index-BPK6-h4c.js";import{f as j,a as ce}from"./format-BzjOGG12.js";import{g as me}from"./getUrlId-C6EUnTTr.js";import{A as Z,u as _e,_ as pe}from"./Aria2Dialog.vue_vue_type_script_setup_true_lang-gzIijayE.js";import{F as fe,a as ge}from"./index-CCIP6nLH.js";import{B as q}from"./useResizeObserver-0RpJxoo1.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{T as ee}from"./index-GqER3ZmS.js";import{c as J,L as we,a as ke}from"./copy-DBcvyuL6.js";import{l as O}from"./link-C-D9N9rK.js";import{L as Q}from"./index-DpPndZpL.js";import{T as Le}from"./index-whK4VmrQ.js";import"./index-B4NdQgZe.js";import"./index-BqruQDy7.js";import"./dep-b315df3e-BFpF7-WL.js";import"./fake-arrow-DEmpAYC7.js";import"./dep-0df090f8-DxuMY6jG.js";import"./index-DKWQq3kl.js";import"./add-B8TB7DIr.js";import"./useVirtualScrollNew-Y4TXHHfO.js";import"./helper-BEUpluEh.js";import"./index-DWIrkCbH.js";const ye=["innerHTML"],he=I({__name:"Announce",setup(k){const u=H(),{config:_}=T(u);return(f,o)=>{const F=N;return t(_).show_announce?(x(),K(F,{key:0,title:"公告"},{default:s(()=>[z("div",{innerHTML:t(_).announce},null,8,ye)]),_:1})):U("",!0)}}}),X=H(),W=le("fileList",()=>{const k=w({url:"",surl:"",pwd:"",dir:"/",parse_password:""}),u=w(),_=()=>{const r=k.value.dir.split("/");r.pop();const h=r.join("/");return h===""?"/":h},f=async()=>{i.value=[];const r=await se(k.value);u.value=r.data,k.value.dir!=="/"&&u.value.list.unshift({category:-1,fs_id:0,is_dir:!0,local_ctime:0,local_mtime:0,server_ctime:0,server_mtime:0,size:0,md5:"",path:_(),server_filename:"返回上一层",dlink:""})},o=w({token:"guest"}),F=w({count:0,size:0,expires_at:"1970-01-01 08:00:00"}),L=w(""),m=async()=>{var r,h;try{const d=await ae(o.value);F.value=d.data,L.value=""}catch(d){const a=(h=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:h.message;a&&(L.value=a)}},i=w([]),y=w([]),g=(r,h)=>{i.value=r,y.value=h.selectedRowData},l=w({hit_captcha:!1,vcode_str:"",vcode_img:"",vcode_input:""}),c=w(!1),V=w([]);return{GetFileListReq:k,GetFileListRes:u,getFileList:f,GetLimitReq:o,GetLimitRes:F,GetLimitError:L,getLimit:m,selectedRowKeys:i,handleSelectChange:g,getDownloadLinks:async(r,h)=>{var G,B,P;if(c.value)return R.error("正在解析中,请稍后再试"),!1;const{config:d}=X;r&&typeof r!="number"&&h&&(r.stopPropagation(),y.value=[h]);const a=y.value.filter(n=>n&&!n.is_dir);a.length!==y.value.length&&R.warning("文件夹不会进行解析,已忽略");const b=a.filter(n=>n.size>d.min_single_filesize);b.length!==a.length&&R.warning("文件过小不会被解析");const S=b.filter(n=>n.size<d.max_single_filesize);S.length!==b.length&&R.warning("文件过大不会被解析");const p=S;if(p.reduce((n,M)=>n+M.size,0)>d.max_all_filesize){R.error(`单次最多解析${j(d.max_all_filesize)}的文件`);return}if(p.length>d.max_once){R.error(`单次最多解析${d.max_once}个文件`);return}if(p.length===0){R.error("满足要求的文件数量为0");return}try{c.value=!0;const n=await oe({randsk:u.value.randsk,uk:u.value.uk,shareid:u.value.shareid,fs_id:typeof r=="number"?[r]:p.map(M=>M.fs_id),surl:k.value.surl,dir:k.value.dir,pwd:k.value.pwd,token:o.value.token,parse_password:k.value.parse_password,...l.value.hit_captcha?{vcode_str:l.value.vcode_str,vcode_input:l.value.vcode_input}:{}});if(typeof r=="number")return R.success("重新解析成功"),n.data;R.success("解析成功,下滑查看解析结果"),V.value=n.data,l.value.hit_captcha=!1}catch(n){const M=n;if((P=(B=(G=M==null?void 0:M.response)==null?void 0:G.data)==null?void 0:B.message)!=null&&P.includes("-20")){const te=await ne({parse_password:k.value.parse_password});l.value={hit_captcha:!0,...te.data,vcode_input:""}}else R.error("解析可能失败或超时了,请稍后前往历史记录中尝试查询是否成功")}finally{c.value=!1,await m(),await X.getConfig()}},GetDownLoadLinksRes:V,vcode:l}}),Ce={key:1},be=["src"],Re=I({__name:"Form",setup(k){const u=H(),{config:_}=T(u),f=W(),{GetFileListReq:o,GetLimitReq:F,GetLimitRes:L,GetLimitError:m,GetFileListRes:i,GetDownLoadLinksRes:y,vcode:g}=T(f),l=()=>{const d=me(o.value.url);if(!d)return;const{surl:a,pwd:b,url:S}=d;o.value.surl=a,o.value.url=S,o.value.dir="/",b&&(o.value.pwd=b,R.success("已自动填写密码~"))},c=()=>{o.value.dir="",i.value=void 0,y.value=[]},V={url:[{required:!0,message:"链接不能为空"}],parse_password:[{required:!0,message:"解析密码不能为空"}],vcode_input:[{required:!0,message:"验证码不能为空"}]};ie(()=>{f.getLimit(),u.getConfig()});const $=async({validateResult:d})=>{d===!0&&(o.value.dir="/",await f.getFileList(),R.success("获取成功"))},r=w(Date.now()),h=()=>{r.value=Date.now()};return(d,a)=>{const b=Z,S=Y,p=de,v=fe,G=q,B=ge,P=N;return x(),K(P,null,{default:s(()=>[e(S,{direction:"vertical",class:"space"},{default:s(()=>[e(b,{theme:t(_).have_account?"success":"error"},{default:s(()=>[C(A(t(_).have_account?"当前中转账号充足":"当前中转账号不足"),1)]),_:1},8,["theme"]),t(_).debug?(x(),K(b,{key:0,theme:"error"},{default:s(()=>a[6]||(a[6]=[C(" 当前网站开启了DEBUG模式,非调试请关闭!!!! ")])),_:1})):U("",!0),e(b,{theme:t(m).length===0?"success":"error"},{default:s(()=>[t(m).length===0?(x(),K(S,{key:0},{default:s(()=>[z("span",null,"剩余可解析文件数: "+A(t(L).count),1),z("span",null,"剩余可解析大小: "+A(t(j)(t(L).size)),1),z("span",null,"到期时间: "+A(t(L).expires_at),1)]),_:1})):(x(),E("span",Ce,A(t(m)),1))]),_:1},8,["theme"]),e(B,{data:t(o),rules:V,labelWidth:120,onSubmit:$},{default:s(()=>[e(v,{name:"url",label:"链接"},{default:s(()=>[e(p,{modelValue:t(o).url,"onUpdate:modelValue":a[0]||(a[0]=n=>t(o).url=n),modelModifiers:{trim:!0},onBlur:l,onChange:c},null,8,["modelValue"])]),_:1}),e(v,{name:"surl",label:"提取到的链接"},{default:s(()=>[e(p,{value:t(o).surl,disabled:""},null,8,["value"])]),_:1}),e(v,{name:"pwd",label:"提取码"},{default:s(()=>[e(p,{modelValue:t(o).pwd,"onUpdate:modelValue":a[1]||(a[1]=n=>t(o).pwd=n),modelModifiers:{trim:!0},onChange:c},null,8,["modelValue"])]),_:1}),t(_).need_password?(x(),K(v,{key:0,name:"parse_password",label:"解析密码"},{default:s(()=>[e(p,{modelValue:t(o).parse_password,"onUpdate:modelValue":a[2]||(a[2]=n=>t(o).parse_password=n),modelModifiers:{trim:!0}},null,8,["modelValue"])]),_:1})):U("",!0),e(v,{name:"token",label:"卡密"},{default:s(()=>[e(p,{modelValue:t(F).token,"onUpdate:modelValue":a[3]||(a[3]=n=>t(F).token=n),modelModifiers:{trim:!0},onBlur:t(f).getLimit},null,8,["modelValue","onBlur"])]),_:1}),e(v,{name:"dir",label:"路径"},{default:s(()=>[e(p,{modelValue:t(o).dir,"onUpdate:modelValue":a[4]||(a[4]=n=>t(o).dir=n),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),_:1}),t(g).hit_captcha?(x(),E(D,{key:1},[e(v,{label:"验证码图片",name:"vcode_img"},{default:s(()=>[z("img",{src:`${t(g).vcode_img}&t=${r.value}`,onClick:h},null,8,be)]),_:1}),e(v,{label:"验证码字符",name:"vcode_input"},{default:s(()=>[e(p,{modelValue:t(g).vcode_input,"onUpdate:modelValue":a[5]||(a[5]=n=>t(g).vcode_input=n)},null,8,["modelValue"])]),_:1})],64)):U("",!0),e(v,null,{default:s(()=>[e(S,{size:"small"},{default:s(()=>[e(G,{type:"submit"},{default:s(()=>a[7]||(a[7]=[C(" 获取文件列表 ")])),_:1}),e(G,{onClick:t(f).getDownloadLinks},{default:s(()=>a[8]||(a[8]=[C(" 批量解析 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})}}}),xe=ve(Re,[["__scopeId","data-v-64272d66"]]),Fe=I({__name:"FilesList",setup(k){const u=W(),{GetFileListReq:_,GetFileListRes:f,selectedRowKeys:o}=T(u),F=w([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"server_filename",title:"文件名",cell:(m,{row:i})=>e(D,null,[e("div",{class:"filename"},[e("img",{class:"ico",src:i.is_dir?"/images/folder.png":"/images/file.png"},null),e("span",null,[i.server_filename])])]),ellipsis:!0},{colKey:"server_mtime",title:"修改时间",cell:(m,{row:i})=>e(D,null,[ce(i.server_mtime)]),ellipsis:!0},{colKey:"size",title:"文件大小",cell:(m,{row:i})=>e(D,null,[j(i.size)]),ellipsis:!0},{colKey:"operation",title:"操作",cell:(m,{row:i})=>i.is_dir?e(D,null,[e(q,{theme:"primary",onClick:y=>L(y,i.path)},{default:()=>[C("打开文件夹")]})]):e(D,null,[e(q,{theme:"primary",onClick:y=>u.getDownloadLinks(y,i)},{default:()=>[C("解析")]})]),width:130,align:"center",fixed:"right"}]),L=async(m,i)=>{m.stopPropagation(),_.value.dir=i,await u.getFileList()};return(m,i)=>{const y=ee,g=N;return t(f)?(x(),K(g,{key:0},{default:s(()=>[e(y,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:t(f).list,maxHeight:500,columns:F.value,"select-on-row-click":!0,selectedRowKeys:t(o),onSelectChange:t(u).handleSelectChange},null,8,["data","columns","selectedRowKeys","onSelectChange"])]),_:1})):U("",!0)}}}),Se=I({__name:"LinksList",setup(k){const u=W(),{GetDownLoadLinksRes:_}=T(u),f=_e(),o=w([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"message",title:"状态"},{colKey:"filename",title:"文件名"},{colKey:"ua",title:"UA",cell:(g,{row:l})=>e(Q,{onClick:()=>J(l.ua)},{default:()=>[e(O,null,null),l.ua]})},{colKey:"fs_id",title:"文件ID"},{colKey:"operation",title:"操作",cell:(g,{row:l,rowIndex:c})=>e(D,null,[e(q,{onClick:()=>F(l,c)},{default:()=>[C("重新解析")]})])}]),F=async(g,l)=>{const c=await u.getDownloadLinks(g.fs_id);c&&(_.value[l]=c[0])},L=w([]),m=w([]),i=(g,l)=>{L.value=g,m.value=l.selectedRowData.filter(c=>c.urls).map(c=>({filename:c.filename,urls:c.urls,ua:c.ua}))};re(_,()=>{L.value=[],m.value=[]});const y=()=>{L.value=[],m.value=[]};return(g,l)=>{const c=Q,V=q,$=Y,r=Z,h=Le,d=ke,a=we,b=ee,S=N;return t(_).length>0?(x(),K(S,{key:0},{default:s(()=>[e($,{direction:"vertical"},{default:s(()=>[e(r,null,{default:s(()=>[l[4]||(l[4]=C(" 下载请推荐使用Aria2下载器,如 ")),e(c,{href:"https://motrix.app/",target:"_blank"},{"prefix-icon":s(()=>[e(t(O))]),default:s(()=>[l[1]||(l[1]=C(" Motrix "))]),_:1}),l[5]||(l[5]=z("p",null,"IDM下载需要手动指定UA,点击即可复制",-1)),l[6]||(l[6]=z("p",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可重新解析该文件",-1)),l[7]||(l[7]=z("br",null,null,-1)),e($,null,{default:s(()=>[e(V,{onClick:t(f).showAria2Config},{default:s(()=>l[2]||(l[2]=[C(" 修改Aria2配置 ")])),_:1},8,["onClick"]),e(V,{onClick:l[0]||(l[0]=p=>t(f).downloadLinks(m.value))},{default:s(()=>l[3]||(l[3]=[C("批量发送")])),_:1})]),_:1})]),_:1}),e(b,{"row-key":"fs_id",resizable:"","lazy-load":"",bordered:!0,data:t(_),columns:o.value,"select-on-row-click":!0,selectedRowKeys:L.value,onSelectChange:i,onPageChange:y},{expandedRow:s(({row:p})=>[e(a,{split:"",size:"large"},{default:s(()=>[(x(!0),E(D,null,ue(p.urls,(v,G)=>(x(),K(d,{key:v},{default:s(()=>[e($,{direction:"vertical"},{default:s(()=>[e($,null,{default:s(()=>[e(h,{size:"large"},{default:s(()=>[C(" 第 "+A(G+1)+" 条 ",1)]),_:2},1024),e(V,{onClick:B=>t(J)(v)},{default:s(()=>l[8]||(l[8]=[C("复制")])),_:2},1032,["onClick"]),e(V,{onClick:B=>t(f).addAria2Url(v,p.filename,p.ua,16)},{default:s(()=>l[9]||(l[9]=[C("发送到Aria2下载器")])),_:2},1032,["onClick"])]),_:2},1024),z("p",null,A(v),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","columns","selectedRowKeys"])]),_:1})]),_:1})):U("",!0)}}}),Ye=I({__name:"index",setup(k){return(u,_)=>(x(),E(D,null,[e(he),e(xe),e(Fe),e(Se),e(pe)],64))}});export{Ye as default};
